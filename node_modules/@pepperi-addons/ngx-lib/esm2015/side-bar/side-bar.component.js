import { Component, Injectable, Input, Output, EventEmitter, ViewChild, ElementRef, Renderer2, } from '@angular/core';
import { PepLayoutService, PepScreenSizeType, } from '@pepperi-addons/ngx-lib';
import { pepIconArrowLeft, pepIconArrowRight } from '@pepperi-addons/ngx-lib/icon';
export class PepSideBarComponent {
    constructor(hostElement, renderer, layoutService) {
        this.hostElement = hostElement;
        this.renderer = renderer;
        this.layoutService = layoutService;
        this.ignoreResize = false;
        this.showHeader = true;
        this.showFooter = false;
        this._useAsWebComponent = false;
        this._animationTime = 350; // milliseconds.
        this.state = 'open';
        this.toggleButtonArrowName = pepIconArrowRight.name;
        this.isLargeScreen = true;
        this.stateChange = new EventEmitter();
        this.isMouseIn = false;
        this.sideBarHeight = '100%';
        this.PepScreenSizeType = PepScreenSizeType;
        this.layoutService.onResize$.subscribe((size) => {
            this.screenSize = size;
            this.isLargeScreen = size < PepScreenSizeType.MD;
        });
    }
    set useAsWebComponent(value) {
        if (value) {
            this.exportFunctionsOnHostElement();
        }
    }
    get useAsWebComponent() {
        return this._useAsWebComponent;
    }
    exportFunctionsOnHostElement() {
        // This is for web component usage for use those functions.
        this.hostElement.nativeElement.open = this.open.bind(this);
        this.hostElement.nativeElement.close = this.close.bind(this);
    }
    setState(state) {
        this.state = state;
        this.toggleButtonArrowName =
            // state === 'open' ?
            // (this.layoutService.isRtl() ? pepIconArrowRight.name : pepIconArrowLeft.name) :
            (this.layoutService.isRtl() ? pepIconArrowLeft.name : pepIconArrowRight.name);
    }
    toggleState() {
        this.setState(this.state === 'close' ? 'open' : 'close');
    }
    ngOnInit() {
        document.documentElement.style.setProperty(PepSideBarComponent.ONE_MULTI_BY_DIR_KEY, this.layoutService.isRtl() ? '1' : '-1');
        this.setState(this.isLargeScreen ? 'open' : 'close');
    }
    setSideBarHeight(event) {
        // const from = event.relatedTarget
        //     ? event.relatedTarget
        //     : event.fromElement;
        // const to = event.target ? event.target : event.toElement;
        // if (typeof from === 'undefined' || typeof to === 'undefined') {
        //     return;
        // }
        // this.isMouseIn = true;
        // this.sideBarHeight = window.innerHeight - to.offsetTop + 'px';
    }
    mouseLeaveSideBar(event) {
        // const from = event.relatedTarget
        //     ? event.relatedTarget
        //     : event.fromElement;
        // const to = event.target ? event.target : event.toElement;
        // if (typeof from === 'undefined' || typeof to === 'undefined') {
        //     return;
        // }
        // this.sideBarHeight = '100%';
        // this.isMouseIn = false;
    }
    open() {
        if (this.sidenav) {
            this.sidenav.open();
        }
        this.state = 'open';
    }
    close() {
        if (this.sidenav) {
            this.sidenav.close();
        }
        this.state = 'close';
    }
    toggle() {
        if (this.sidenav) {
            // const isOpen = this.sidenav.opened;
            this.sidenav.toggle();
        }
        this.toggleState();
    }
    toggleSideWrapper() {
        this.toggleState();
        // Raise event after animation finish.
        setTimeout(() => {
            this.stateChange.emit({ state: this.state });
        }, this._animationTime);
    }
    toggleSidenav(isOpen) {
        this.setState(isOpen ? 'open' : 'close');
        // Raise event after animation finish.
        setTimeout(() => {
            this.stateChange.emit({ state: this.state });
        }, this._animationTime);
    }
}
PepSideBarComponent.ONE_MULTI_BY_DIR_KEY = '--pep-one-multi-by-dir';
PepSideBarComponent.decorators = [
    { type: Component, args: [{
                selector: 'pep-side-bar',
                template: "<div class=\"pep-side-bar-container\">\n    <ng-container *ngIf=\"isLargeScreen || ignoreResize; then largeScreensBlock; else notLargeScreensBlock\">\n    </ng-container>\n    <ng-template #largeScreensBlock>\n        <div class=\"toggle-side-bar-container\" [ngClass]=\"{ 'is-open-state': state === 'open'}\">\n            <ng-container *ngTemplateOutlet=\"sideLayoutTemplate\"></ng-container>\n            <div class=\"toggle-button-border\"></div>\n            <button mat-button class=\"toggle-button pep-button xs regular icon-button \" (click)=\"toggleSideWrapper()\">\n                <mat-icon>\n                    <pep-icon [name]=\"toggleButtonArrowName\">\n                    </pep-icon>\n                </mat-icon>\n            </button>\n        </div>\n    </ng-template>\n    <ng-template #notLargeScreensBlock>\n        <mat-sidenav-container [hasBackdrop]=\"true\">\n            <mat-sidenav #sidenav mode=\"over\" autoFocus=\"false\" fixedInViewport=\"false\"\n                (openedChange)=\"toggleSidenav($event)\">\n                <ng-container *ngTemplateOutlet=\"sideLayoutTemplate\"></ng-container>\n            </mat-sidenav>\n        </mat-sidenav-container>\n    </ng-template>\n</div>\n\n<ng-template #sideLayoutTemplate>\n    <div class=\"side-layout\">\n        <div *ngIf=\"showHeader\" class=\"header-content\">\n            <div class=\"content pep-border-bottom body-lg ellipsis\">\n                <ng-container *ngTemplateOutlet=\"headerTemplate\"></ng-container>\n            </div>\n        </div>\n        <div class=\"main-content\">\n            <div class=\"content\">\n                <ng-container *ngTemplateOutlet=\"startContentTemplate\"></ng-container>\n                <ng-container *ngTemplateOutlet=\"filtersTemplate\"></ng-container>\n                <ng-container *ngTemplateOutlet=\"smartFiltersTemplate\"></ng-container>\n                <ng-container *ngTemplateOutlet=\"contentTemplate\"></ng-container>\n                <ng-container *ngTemplateOutlet=\"endContentTemplate\"></ng-container>\n            </div>\n        </div>\n        <div *ngIf=\"showFooter\" class=\"footer-content\">\n            <div class=\"content pep-border-top body-lg ellipsis\">\n                <ng-container *ngTemplateOutlet=\"footerTemplate\"></ng-container>\n            </div>\n        </div>\n    </div>\n</ng-template>\n\n\n<ng-template #headerTemplate>\n    <ng-content select=\"[header-content]\"></ng-content>\n</ng-template>\n\n<ng-template #startContentTemplate>\n    <ng-content select=\"[start-content]\"></ng-content>\n</ng-template>\n\n<ng-template #contentTemplate>\n    <ng-content></ng-content>\n</ng-template>\n\n<ng-template #endContentTemplate>\n    <ng-content select=\"[end-content]\"></ng-content>\n</ng-template>\n\n<ng-template #filtersTemplate>\n\n</ng-template>\n\n<ng-template #smartFiltersTemplate>\n    <ng-content select=\"pep-smart-filters\"></ng-content>\n</ng-template>\n\n<ng-template #footerTemplate>\n    <ng-content select=\"[footer-content]\"></ng-content>\n</ng-template>",
                styles: [".pep-side-bar-container{height:100%}.pep-side-bar-container .toggle-side-bar-container{height:inherit;display:grid;grid-auto-flow:column;transition:transform .35s ease-out,width .35s ease-out;transform:translateX(calc(var(--pep-one-multi-by-dir) * 16rem));transform:translateX(calc(var(--pep-one-multi-by-dir) * var(--pep-side-bar-width, 16rem)));width:calc((1rem * 2) + 1px);width:calc((var(--pep-spacing-lg, 1rem) * 2) + 1px)}.pep-side-bar-container .toggle-side-bar-container.is-open-state{transition:transform .35s ease-out,width .35s ease-out;transform:unset;width:16rem;width:var(--pep-side-bar-width,16rem)}.pep-side-bar-container .toggle-side-bar-container.is-open-state .toggle-button{transition:margin-inline .35s ease-out,transform .35s ease-out;transform:rotate(180deg);margin-inline:-3rem .25rem}.pep-side-bar-container .toggle-side-bar-container.is-open-state .toggle-button-border{transition:opacity calc(calc(.35s / 3) * 2) ease-out,margin-inline .35s ease-out;opacity:0;margin-inline:-3rem .25rem}.pep-side-bar-container .toggle-side-bar-container .toggle-button{z-index:2;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-top:calc(calc(1.5rem + .5rem + 2.5rem) - .75rem);margin-top:calc(calc(var(--pep-top-bar-spacing-top, 1.5rem) + var(--pep-top-bar-spacing-bottom, .5rem) + var(--pep-top-bar-field-height, 2.5rem)) - .75rem);transition:margin-inline .35s ease-out,transform .35s ease-out;transform:rotate(0deg);margin-inline:calc(-1 * .75rem) .25rem}.pep-side-bar-container .toggle-side-bar-container .toggle-button-border{transition:opacity calc(calc(.35s / 3) * 2) calc(.35s / 3) ease-out,margin-inline .35s ease-out;opacity:1;margin-inline:unset;width:1px;-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-start:var(--pep-spacing-lg,1rem);padding-inline-start:var(--pep-spacing-lg,1rem);margin-top:1.5rem;margin-top:var(--pep-top-bar-spacing-top,1.5rem)}.pep-side-bar-container .mat-sidenav-container{position:absolute;bottom:0;left:0;right:0;z-index:999;height:calc(100vh - 4rem);height:calc(100vh - var(--pep-header-height, 4rem));visibility:hidden}.pep-side-bar-container .mat-sidenav-container.mat-drawer-opened{visibility:unset}.pep-side-bar-container .mat-sidenav-container .mat-sidenav{max-width:calc(calc(16rem + 2rem) + calc(1rem * 2));max-width:calc(calc(var(--pep-side-bar-width, 16rem) + var(--pep-spacing-2xl, 2rem)) + calc(var(--pep-spacing-lg, 1rem) * 2));padding-inline:1rem;padding-inline:var(--pep-spacing-lg,1rem)}@media (max-width:599px){.pep-side-bar-container .mat-sidenav-container .mat-sidenav{padding-inline:0}}.pep-side-bar-container .mat-sidenav-container .mat-sidenav .side-layout{max-width:calc(16rem + 2rem);max-width:calc(var(--pep-side-bar-width, 16rem) + var(--pep-spacing-2xl, 2rem));width:calc(16rem + 2rem);width:calc(var(--pep-side-bar-width, 16rem) + var(--pep-spacing-2xl, 2rem))}.pep-side-bar-container .side-layout{display:block;max-width:16rem;max-width:var(--pep-side-bar-width,16rem);width:16rem;width:var(--pep-side-bar-width,16rem);padding:0 1rem;padding:0 var(--pep-spacing-lg,1rem);overflow:auto}.pep-side-bar-container .side-layout .header-content{height:calc(1.5rem + .5rem + 2.5rem);height:calc(var(--pep-top-bar-spacing-top, 1.5rem) + var(--pep-top-bar-spacing-bottom, .5rem) + var(--pep-top-bar-field-height, 2.5rem));padding-top:1.5rem;padding-top:var(--pep-top-bar-spacing-top,1.5rem);z-index:2;position:sticky;top:0}.pep-side-bar-container .side-layout .header-content .content{height:calc(.5rem + 2.5rem);height:calc(var(--pep-top-bar-spacing-bottom, .5rem) + var(--pep-top-bar-field-height, 2.5rem));display:flex;overflow:unset}.pep-side-bar-container .side-layout .footer-content{height:calc(1.5rem + .5rem + 2.5rem);height:calc(var(--pep-top-bar-spacing-top, 1.5rem) + var(--pep-top-bar-spacing-bottom, .5rem) + var(--pep-top-bar-field-height, 2.5rem))}.pep-side-bar-container .side-layout .main-content{display:block;height:inherit;max-width:16rem;max-width:var(--pep-side-bar-width,16rem)}.pep-side-bar-container .side-layout .main-content .content{height:inherit}"]
            },] },
    { type: Injectable }
];
PepSideBarComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: PepLayoutService }
];
PepSideBarComponent.propDecorators = {
    ignoreResize: [{ type: Input }],
    showHeader: [{ type: Input }],
    showFooter: [{ type: Input }],
    useAsWebComponent: [{ type: Input }],
    stateChange: [{ type: Output }],
    sidenav: [{ type: ViewChild, args: ['sidenav',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lkZS1iYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWxpYi9zaWRlLWJhci9zaWRlLWJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILFNBQVMsRUFFVCxVQUFVLEVBQ1YsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ1osU0FBUyxFQUNULFVBQVUsRUFDVixTQUFTLEdBQ1osTUFBTSxlQUFlLENBQUM7QUFTdkIsT0FBTyxFQUVILGdCQUFnQixFQUNoQixpQkFBaUIsR0FDcEIsTUFBTSx5QkFBeUIsQ0FBQztBQUVqQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQVFuRixNQUFNLE9BQU8sbUJBQW1CO0lBbUM1QixZQUNZLFdBQXVCLEVBQ3ZCLFFBQW1CLEVBQ3BCLGFBQStCO1FBRjlCLGdCQUFXLEdBQVgsV0FBVyxDQUFZO1FBQ3ZCLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDcEIsa0JBQWEsR0FBYixhQUFhLENBQWtCO1FBbkNqQyxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUNyQixlQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFFcEIsdUJBQWtCLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLG1CQUFjLEdBQUcsR0FBRyxDQUFDLENBQUMsZ0JBQWdCO1FBRXZELFVBQUssR0FBd0IsTUFBTSxDQUFDO1FBQ3BDLDBCQUFxQixHQUFXLGlCQUFpQixDQUFDLElBQUksQ0FBQztRQUN2RCxrQkFBYSxHQUFHLElBQUksQ0FBQztRQWFyQixnQkFBVyxHQUE4QyxJQUFJLFlBQVksRUFBK0IsQ0FBQztRQUl6RyxjQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLGtCQUFhLEdBQUcsTUFBTSxDQUFDO1FBR3ZCLHNCQUFpQixHQUFHLGlCQUFpQixDQUFDO1FBT2xDLElB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Q0FBQyxNQUFNLEVBQUUsQ0FBQztTQUN6QjtRQUVELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBRUQsaUJBQWlCO1FBQ2IsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ25CLHNDQUFzQztRQUN0QyxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ1osSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDakQsQ0FBQyxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRUQsYUFBYSxDQUFDLE1BQWU7UUFDekIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDekMsc0NBQXNDO1FBQ3RDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDWixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNqRCxDQUFDLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzVCLENBQUM7O0FBdElNLHdDQUFvQixHQUFHLHdCQUF3QixDQUFDOztZQVAxRCxTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLDIvRkFBd0M7O2FBRTNDO1lBQ0EsVUFBVTs7O1lBeEJQLFVBQVU7WUFDVixTQUFTO1lBWVQsZ0JBQWdCOzs7MkJBZWYsS0FBSzt5QkFDTCxLQUFLO3lCQUNMLEtBQUs7Z0NBU0wsS0FBSzswQkFVTCxNQUFNO3NCQUdOLFNBQVMsU0FBQyxTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgT25Jbml0LFxuICAgIEluamVjdGFibGUsXG4gICAgSW5wdXQsXG4gICAgT3V0cHV0LFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBWaWV3Q2hpbGQsXG4gICAgRWxlbWVudFJlZixcbiAgICBSZW5kZXJlcjIsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0U2lkZW5hdiB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NpZGVuYXYnO1xuaW1wb3J0IHtcbiAgICB0cmlnZ2VyLFxuICAgIHN0YXRlLFxuICAgIHN0eWxlLFxuICAgIHRyYW5zaXRpb24sXG4gICAgYW5pbWF0ZSxcbn0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQge1xuICAgIFBlcEN1c3RvbWl6YXRpb25TZXJ2aWNlLFxuICAgIFBlcExheW91dFNlcnZpY2UsXG4gICAgUGVwU2NyZWVuU2l6ZVR5cGUsXG59IGZyb20gJ0BwZXBwZXJpLWFkZG9ucy9uZ3gtbGliJztcbmltcG9ydCB7IElQZXBTaWRlQmFyU3RhdGVDaGFuZ2VFdmVudCwgUGVwU2lkZUJhclN0YXRlVHlwZSB9IGZyb20gJy4vc2lkZS1iYXIubW9kZWwnO1xuaW1wb3J0IHsgcGVwSWNvbkFycm93TGVmdCwgcGVwSWNvbkFycm93UmlnaHQgfSBmcm9tICdAcGVwcGVyaS1hZGRvbnMvbmd4LWxpYi9pY29uJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdwZXAtc2lkZS1iYXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zaWRlLWJhci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vc2lkZS1iYXIuY29tcG9uZW50LnNjc3MnXVxufSlcbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBQZXBTaWRlQmFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBzdGF0aWMgT05FX01VTFRJX0JZX0RJUl9LRVkgPSAnLS1wZXAtb25lLW11bHRpLWJ5LWRpcic7XG5cbiAgICBASW5wdXQoKSBpZ25vcmVSZXNpemUgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBzaG93SGVhZGVyID0gdHJ1ZTtcbiAgICBASW5wdXQoKSBzaG93Rm9vdGVyID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIF91c2VBc1dlYkNvbXBvbmVudCA9IGZhbHNlO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2FuaW1hdGlvblRpbWUgPSAzNTA7IC8vIG1pbGxpc2Vjb25kcy5cblxuICAgIHN0YXRlOiBQZXBTaWRlQmFyU3RhdGVUeXBlID0gJ29wZW4nO1xuICAgIHRvZ2dsZUJ1dHRvbkFycm93TmFtZTogc3RyaW5nID0gcGVwSWNvbkFycm93UmlnaHQubmFtZTtcbiAgICBpc0xhcmdlU2NyZWVuID0gdHJ1ZTtcblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHVzZUFzV2ViQ29tcG9uZW50KHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5leHBvcnRGdW5jdGlvbnNPbkhvc3RFbGVtZW50KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHVzZUFzV2ViQ29tcG9uZW50KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fdXNlQXNXZWJDb21wb25lbnQ7XG4gICAgfVxuXG4gICAgQE91dHB1dCgpXG4gICAgc3RhdGVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxJUGVwU2lkZUJhclN0YXRlQ2hhbmdlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxJUGVwU2lkZUJhclN0YXRlQ2hhbmdlRXZlbnQ+KCk7XG5cbiAgICBAVmlld0NoaWxkKCdzaWRlbmF2Jykgc2lkZW5hdjogTWF0U2lkZW5hdjtcblxuICAgIGlzTW91c2VJbiA9IGZhbHNlO1xuICAgIHNpZGVCYXJIZWlnaHQgPSAnMTAwJSc7XG5cbiAgICBzY3JlZW5TaXplOiBQZXBTY3JlZW5TaXplVHlwZTtcbiAgICBQZXBTY3JlZW5TaXplVHlwZSA9IFBlcFNjcmVlblNpemVUeXBlO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgaG9zdEVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gICAgICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICAgICAgcHVibGljIGxheW91dFNlcnZpY2U6IFBlcExheW91dFNlcnZpY2VcbiAgICApIHtcbiAgICAgICAgdGhpcy5sYXlvdXRTZXJ2aWNlLm9uUmVzaXplJC5zdWJzY3JpYmUoKHNpemU6IFBlcFNjcmVlblNpemVUeXBlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNjcmVlblNpemUgPSBzaXplO1xuICAgICAgICAgICAgdGhpcy5pc0xhcmdlU2NyZWVuID0gc2l6ZSA8IFBlcFNjcmVlblNpemVUeXBlLk1EO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGV4cG9ydEZ1bmN0aW9uc09uSG9zdEVsZW1lbnQoKSB7XG4gICAgICAgIC8vIFRoaXMgaXMgZm9yIHdlYiBjb21wb25lbnQgdXNhZ2UgZm9yIHVzZSB0aG9zZSBmdW5jdGlvbnMuXG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5vcGVuID0gdGhpcy5vcGVuLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5jbG9zZSA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFN0YXRlKHN0YXRlOiBQZXBTaWRlQmFyU3RhdGVUeXBlKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgdGhpcy50b2dnbGVCdXR0b25BcnJvd05hbWUgPVxuICAgICAgICAgICAgLy8gc3RhdGUgPT09ICdvcGVuJyA/XG4gICAgICAgICAgICAvLyAodGhpcy5sYXlvdXRTZXJ2aWNlLmlzUnRsKCkgPyBwZXBJY29uQXJyb3dSaWdodC5uYW1lIDogcGVwSWNvbkFycm93TGVmdC5uYW1lKSA6XG4gICAgICAgICAgICAodGhpcy5sYXlvdXRTZXJ2aWNlLmlzUnRsKCkgPyBwZXBJY29uQXJyb3dMZWZ0Lm5hbWUgOiBwZXBJY29uQXJyb3dSaWdodC5uYW1lKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRvZ2dsZVN0YXRlKCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHRoaXMuc3RhdGUgPT09ICdjbG9zZScgPyAnb3BlbicgOiAnY2xvc2UnKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KFBlcFNpZGVCYXJDb21wb25lbnQuT05FX01VTFRJX0JZX0RJUl9LRVksIHRoaXMubGF5b3V0U2VydmljZS5pc1J0bCgpID8gJzEnIDogJy0xJyk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUodGhpcy5pc0xhcmdlU2NyZWVuID8gJ29wZW4nIDogJ2Nsb3NlJyk7XG4gICAgfVxuXG4gICAgc2V0U2lkZUJhckhlaWdodChldmVudCkge1xuICAgICAgICAvLyBjb25zdCBmcm9tID0gZXZlbnQucmVsYXRlZFRhcmdldFxuICAgICAgICAvLyAgICAgPyBldmVudC5yZWxhdGVkVGFyZ2V0XG4gICAgICAgIC8vICAgICA6IGV2ZW50LmZyb21FbGVtZW50O1xuICAgICAgICAvLyBjb25zdCB0byA9IGV2ZW50LnRhcmdldCA/IGV2ZW50LnRhcmdldCA6IGV2ZW50LnRvRWxlbWVudDtcblxuICAgICAgICAvLyBpZiAodHlwZW9mIGZyb20gPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiB0byA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgLy8gICAgIHJldHVybjtcbiAgICAgICAgLy8gfVxuICAgICAgICAvLyB0aGlzLmlzTW91c2VJbiA9IHRydWU7XG5cbiAgICAgICAgLy8gdGhpcy5zaWRlQmFySGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IC0gdG8ub2Zmc2V0VG9wICsgJ3B4JztcbiAgICB9XG5cbiAgICBtb3VzZUxlYXZlU2lkZUJhcihldmVudCkge1xuICAgICAgICAvLyBjb25zdCBmcm9tID0gZXZlbnQucmVsYXRlZFRhcmdldFxuICAgICAgICAvLyAgICAgPyBldmVudC5yZWxhdGVkVGFyZ2V0XG4gICAgICAgIC8vICAgICA6IGV2ZW50LmZyb21FbGVtZW50O1xuICAgICAgICAvLyBjb25zdCB0byA9IGV2ZW50LnRhcmdldCA/IGV2ZW50LnRhcmdldCA6IGV2ZW50LnRvRWxlbWVudDtcblxuICAgICAgICAvLyBpZiAodHlwZW9mIGZyb20gPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiB0byA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgLy8gICAgIHJldHVybjtcbiAgICAgICAgLy8gfVxuICAgICAgICAvLyB0aGlzLnNpZGVCYXJIZWlnaHQgPSAnMTAwJSc7XG4gICAgICAgIC8vIHRoaXMuaXNNb3VzZUluID0gZmFsc2U7XG4gICAgfVxuXG4gICAgb3BlbigpIHtcbiAgICAgICAgaWYgKHRoaXMuc2lkZW5hdikge1xuICAgICAgICAgICAgdGhpcy5zaWRlbmF2Lm9wZW4oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc3RhdGUgPSAnb3Blbic7XG4gICAgfVxuXG4gICAgY2xvc2UoKSB7XG4gICAgICAgIGlmICh0aGlzLnNpZGVuYXYpIHtcbiAgICAgICAgICAgIHRoaXMuc2lkZW5hdi5jbG9zZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9ICdjbG9zZSc7XG4gICAgfVxuXG4gICAgdG9nZ2xlKCkge1xuICAgICAgICBpZiAodGhpcy5zaWRlbmF2KSB7XG4gICAgICAgICAgICAvLyBjb25zdCBpc09wZW4gPSB0aGlzLnNpZGVuYXYub3BlbmVkO1xuICAgICAgICAgICAgdGhpcy5zaWRlbmF2LnRvZ2dsZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50b2dnbGVTdGF0ZSgpO1xuICAgIH1cblxuICAgIHRvZ2dsZVNpZGVXcmFwcGVyKCkge1xuICAgICAgICB0aGlzLnRvZ2dsZVN0YXRlKCk7XG4gICAgICAgIC8vIFJhaXNlIGV2ZW50IGFmdGVyIGFuaW1hdGlvbiBmaW5pc2guXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZS5lbWl0KHsgc3RhdGU6IHRoaXMuc3RhdGUgfSk7XG4gICAgICAgIH0sIHRoaXMuX2FuaW1hdGlvblRpbWUpO1xuICAgIH1cblxuICAgIHRvZ2dsZVNpZGVuYXYoaXNPcGVuOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoaXNPcGVuID8gJ29wZW4nIDogJ2Nsb3NlJyk7XG4gICAgICAgIC8vIFJhaXNlIGV2ZW50IGFmdGVyIGFuaW1hdGlvbiBmaW5pc2guXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZS5lbWl0KHsgc3RhdGU6IHRoaXMuc3RhdGUgfSk7XG4gICAgICAgIH0sIHRoaXMuX2FuaW1hdGlvblRpbWUpO1xuICAgIH1cbn1cbiJdfQ==
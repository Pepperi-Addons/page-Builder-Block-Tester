import { Component, Input, Output, EventEmitter, Renderer2, ViewChild, ElementRef, ChangeDetectorRef, NgZone, } from '@angular/core';
import { PepLayoutService, PepScreenSizeType, PepSessionService, FIELD_TYPE, } from '@pepperi-addons/ngx-lib';
import { VirtualScrollerComponent } from './virtual-scroller';
import { PepSelectionData, DEFAULT_PAGE_SIZE, } from './list.model';
import * as tween from '@tweenjs/tween.js';
export class PepListComponent {
    constructor(hostElement, layoutService, sessionService, cd, renderer, zone) {
        this.hostElement = hostElement;
        this.layoutService = layoutService;
        this.sessionService = sessionService;
        this.cd = cd;
        this.renderer = renderer;
        this.zone = zone;
        this.noDataFoundMsg = null;
        this.selectionTypeForActions = 'multi';
        this.showCardSelection = false;
        this.hideAllSelectionInMulti = false;
        this.cardSize = 'md';
        this._viewType = '';
        this.firstFieldAsLink = false;
        this.supportSorting = true;
        this.supportResizing = true;
        this._parentScroll = null;
        this.disabled = false;
        this._lockEvents = false;
        this.lockItemInnerEvents = false;
        this.printMode = false;
        this.isReport = false;
        this.totalsRow = [];
        this.pagerType = 'scroll';
        this.pageSize = DEFAULT_PAGE_SIZE;
        this.pageIndex = 0;
        // @Input() startIndex = 0;
        this.scrollAnimationTime = 500;
        this.scrollDebounceTime = 0;
        this.scrollThrottlingTime = 0;
        this._useAsWebComponent = false;
        this.itemClick = new EventEmitter();
        this.fieldClick = new EventEmitter();
        this.valueChange = new EventEmitter();
        this.sortingChange = new EventEmitter();
        this.selectedItemsChange = new EventEmitter();
        this.selectedItemChange = new EventEmitter();
        this.selectAllClick = new EventEmitter();
        // @Output()
        // singleActionClick: EventEmitter<any> = new EventEmitter<any>();
        this.listLoad = new EventEmitter();
        this.loadItems = new EventEmitter();
        this.loadPage = new EventEmitter();
        this.startIndexChange = new EventEmitter();
        this._layout = null;
        this.totalRows = -1;
        this.isTable = false;
        this.hasColumnWidthOfTypePercentage = true;
        this._items = null;
        this.itemsCounter = 0;
        this.SEPARATOR = ',';
        this.isAllSelected = false;
        this.selectedItems = new Map();
        this.unSelectedItems = new Map();
        this.selectedItemId = '';
        this.hoveredItemId = '';
        this.containerWidth = 0;
        this.tableScrollWidth = 0;
        this._loadingItemsFromApi = false;
        this.deviceHasMouse = false;
        // For resize
        this.pressedColumn = '';
        this.startX = 0;
        this.startWidth = 0;
        this.tableStartWidth = 0;
        // For sorting
        this.isAsc = true;
        this.sortBy = '';
        this.isUserSelected = false;
        this.checkForChanges = null;
        // this.nativeWindow = window;
        this.layoutService.onResize$.subscribe((size) => {
            this.screenSize = size;
        });
        this.layoutService.onMouseOver$.subscribe((deviceHasMouse) => {
            this.deviceHasMouse = deviceHasMouse;
        });
    }
    set viewType(value) {
        this._viewType = value;
        this.isTable = value === 'table';
    }
    get viewType() {
        return this._viewType;
    }
    set parentScroll(value) {
        this._parentScroll = value;
    }
    get parentScroll() {
        return this._parentScroll;
    }
    set lockEvents(value) {
        this._lockEvents = value;
        if (this._lockEvents) {
            this.renderer.addClass(this.hostElement.nativeElement, 'lock-events');
        }
        else {
            this.renderer.removeClass(this.hostElement.nativeElement, 'lock-events');
        }
    }
    get lockEvents() {
        return this._lockEvents;
    }
    set useAsWebComponent(value) {
        this._useAsWebComponent = value;
        if (value) {
            this.exportFunctionsOnHostElement();
        }
    }
    get useAsWebComponent() {
        return this._useAsWebComponent;
    }
    get layout() {
        return this._layout;
    }
    get items() {
        return this._items;
    }
    get loadingItemsFromApi() {
        return this._loadingItemsFromApi;
    }
    ngOnInit() {
        this.containerWidth = 0;
        this.deviceHasMouse = this.layoutService.getDeviceHasMouse();
    }
    ngOnChanges(changes) {
        if (this.containerWidth <= 0) {
            this.setContainerWidth();
        }
    }
    ngOnDestroy() {
        // if (this.valueChange) {
        //     this.valueChange.unsubscribe();
        // }
        // if (this.loadItems) {
        //     this.loadItems.unsubscribe();
        // }
        // if (this.loadPage) {
        //     this.loadPage.unsubscribe();
        // }
        // if (this.sortingChange) {
        //     this.sortingChange.unsubscribe();
        // }
        // if (this.fieldClick) {
        //     this.fieldClick.unsubscribe();
        // }
        // if (this.itemClick) {
        //     this.itemClick.unsubscribe();
        // }
        // if (this.listLoad) {
        //     this.listLoad.unsubscribe();
        // }
        this.saveSortingToSession();
    }
    getScrollingElement() {
        var _a;
        return this.parentScroll ? this.parentScroll : (_a = this.virtualScroller) === null || _a === void 0 ? void 0 : _a.contentElementRef.nativeElement.parentElement;
    }
    scrollToTop(animate = true) {
        const scrollingElement = this.getScrollingElement();
        if (scrollingElement) {
            const scrollTop = 0;
            // totally disable animate
            if (!animate || this.scrollAnimationTime === 0) {
                if (scrollingElement instanceof Window) {
                    window.scrollTo(0, scrollTop);
                }
                else {
                    scrollingElement.scrollTop = scrollTop;
                }
            }
            else {
                let animationRequest;
                const isWindow = scrollingElement instanceof Window;
                const currentScrollTop = scrollingElement instanceof Window
                    ? window.pageYOffset
                    : scrollingElement.scrollTop;
                if (this.currentTween !== undefined) {
                    this.currentTween.stop();
                }
                this.currentTween = new tween.Tween({ scrollTop: currentScrollTop })
                    .to({ scrollTop }, this.scrollAnimationTime)
                    .easing(tween.Easing.Quadratic.Out)
                    .onUpdate((data) => {
                    if (isNaN(data.scrollTop)) {
                        return;
                    }
                    if (isWindow) {
                        window.scrollTo(0, data.scrollTop);
                    }
                    else {
                        this.renderer.setProperty(scrollingElement, 'scrollTop', data.scrollTop);
                    }
                })
                    .onStop(() => {
                    cancelAnimationFrame(animationRequest);
                })
                    .start();
                const animate = (time) => {
                    this.currentTween.update(time);
                    if (this.currentTween._object.scrollTop !== scrollTop) {
                        this.zone.runOutsideAngular(() => {
                            animationRequest = requestAnimationFrame(animate);
                        });
                    }
                };
                animate();
            }
        }
    }
    setContainerWidth() {
        const selectionCheckBoxWidth = this.selectionTypeForActions === 'multi' ? 44 : 0;
        const rowHeight = 40; // the table row height (2.5rem * 16font-size).
        const style = window.getComputedStyle(this.hostElement.nativeElement.parentElement);
        // The container-fluid class padding left + right + border
        const containerFluidSpacing = parseInt(style.paddingLeft, 10) + parseInt(style.paddingRight, 10);
        const parentContainer = this.hostElement.nativeElement.parentElement.parentElement > 0
            ? this.hostElement.nativeElement.parentElement.parentElement
            : this.hostElement.nativeElement.parentElement;
        // Calculate if vertical scroll should appear, if so set the scroll width. (this.totalRows + 1) + 1 is for the header row.
        this.tableScrollWidth = parentContainer.clientHeight < rowHeight * (this.totalRows + 1)
            ? this.layoutService.getScrollbarWidth()
            : 0;
        // The selectionCheckBoxWidth width + containerFluidSpacing + this.tableScrollWidth.
        const rowHeaderWidthToSub = containerFluidSpacing + selectionCheckBoxWidth + this.tableScrollWidth;
        this.containerWidth = parentContainer.offsetWidth - rowHeaderWidthToSub;
    }
    saveSortingToSession() {
        this.sessionService.setObject(PepListComponent.SORT_BY_STATE_KEY, this.sortBy);
        this.sessionService.setObject(PepListComponent.ASCENDING_STATE_KEY, this.isAsc);
    }
    getTopItems() {
        return this.isTable
            ? PepListComponent.TOP_ITEMS_TABLE
            : PepListComponent.TOP_ITEMS_THUMBNAILS;
    }
    // private disableScroll(disable: boolean) {
    //     if (disable) {
    //         this.renderer.addClass(this.getParentContainer(), 'lock-events');
    //     } else {
    //         this.renderer.removeClass(this.getParentContainer(), 'lock-events');
    //     }
    // }
    toggleLoadingItemsFropApi(loadingItemsFromApi) {
        this._loadingItemsFromApi = loadingItemsFromApi;
        // this.disableScroll(loadingItemsFromApi);
    }
    updateCurrentPageItems(startIndex, endIndex) {
        this.currentPageItems = this.items.slice(startIndex, endIndex);
    }
    setSelectionItems(itemId, uniqItemId, isChecked) {
        // Set selected item checkbox
        if (this.isAllSelected) {
            if (isChecked) {
                this.unSelectedItems.delete(itemId);
                this.selectedItems.set(itemId, uniqItemId);
            }
            else {
                this.selectedItems.delete(itemId);
                this.unSelectedItems.set(itemId, uniqItemId);
            }
        }
        else {
            if (isChecked) {
                this.unSelectedItems.delete(itemId);
                this.selectedItems.set(itemId, uniqItemId);
            }
            else {
                this.selectedItems.delete(itemId);
                this.unSelectedItems.set(itemId, uniqItemId);
            }
        }
    }
    getUniqItemId(itemId, itemType = '') {
        return itemId + this.SEPARATOR + itemType;
    }
    setLayout() {
        if (this.totalRows === 0 ||
            !this._layout ||
            !this._layout.ControlFields ||
            this._layout.ControlFields.length === 0) {
            return;
        }
        this._layout.ControlFields.forEach((cf) => {
            if (cf.ColumnWidth === 0) {
                cf.ColumnWidth = 10;
            }
            if (this.isTable &&
                (cf.FieldType === FIELD_TYPE.Image ||
                    // cf.FieldType === FIELD_TYPE.Indicators || ???
                    cf.FieldType === FIELD_TYPE.Signature ||
                    cf.FieldType === FIELD_TYPE.NumberIntegerQuantitySelector ||
                    cf.FieldType === FIELD_TYPE.NumberRealQuantitySelector ||
                    cf.FieldType === FIELD_TYPE.NumberIntegerForMatrix ||
                    cf.FieldType === FIELD_TYPE.NumberRealForMatrix ||
                    cf.FieldType === FIELD_TYPE.Package ||
                    cf.ApiName === 'UnitsQuantity' ||
                    cf.ApiName === 'QuantitySelector')) {
                cf.Layout.XAlignment = 3;
            }
        });
        if (!this.cd['destroyed']) {
            this.cd.detectChanges();
        }
        // Set the columns width.
        if (this.containerWidth <= 0) {
            this.setContainerWidth();
        }
        this.calcColumnsWidth();
        this.checkForChanges = new Date().getTime();
    }
    calcColumnsWidth() {
        const fixedMultiple = 3.78; // for converting em to pixel.
        const length = this._layout.ControlFields.length;
        const selectionCheckBoxWidth = this.selectionTypeForActions === 'multi' ? 44 : 0;
        // Is table AND there is at least one column of width type of percentage.
        if (this.isTable) {
            if (this._layout && this._layout.ControlFields) {
                this.hasColumnWidthOfTypePercentage =
                    this._layout.ControlFields.filter((cf) => cf.ColumnWidthType === 1).length === 0;
            }
        }
        // If the columns size is fixed and the total is small then the container change it to percentage.
        if (!this.hasColumnWidthOfTypePercentage) {
            const totalFixedColsWidth = this._layout.ControlFields.map((cf) => cf.ColumnWidth * fixedMultiple).reduce((sum, current) => sum + current);
            if (window.innerWidth > totalFixedColsWidth) {
                this.hasColumnWidthOfTypePercentage = true;
            }
        }
        let totalCalcColsWidth = 0;
        // Calc by percentage
        if (this.hasColumnWidthOfTypePercentage) {
            const totalColsWidth = this._layout.ControlFields.map((cf) => cf.ColumnWidth).reduce((sum, current) => sum + current);
            for (let index = 0; index < length; index++) {
                const uiControlField = this._layout.ControlFields[index];
                const calcColumnWidthPercentage = (100 / totalColsWidth) * uiControlField.ColumnWidth;
                uiControlField.calcColumnWidth = Math.floor((this.containerWidth * calcColumnWidthPercentage) / 100);
                if (index === length - 1) {
                    uiControlField.calcTitleColumnWidthString = uiControlField.calcColumnWidthString = 'calc(100% - ' + totalCalcColsWidth + 'px)'; // For 100%
                }
                else {
                    uiControlField.calcTitleColumnWidthString = uiControlField.calcColumnWidthString = uiControlField.calcColumnWidth + 'px';
                    totalCalcColsWidth += uiControlField.calcColumnWidth;
                }
            }
            this.renderer.setStyle(this.hostElement.nativeElement, 'width', 'inherit');
        }
        else {
            for (let index = 0; index < length; index++) {
                const uiControlField = this._layout
                    .ControlFields[index];
                const currentFixedWidth = Math.floor(uiControlField.ColumnWidth * fixedMultiple);
                if (index === length - 1) {
                    uiControlField.calcTitleColumnWidthString = currentFixedWidth + 'px';
                    uiControlField.calcColumnWidthString = currentFixedWidth + 'px';
                }
                else {
                    uiControlField.calcTitleColumnWidthString = uiControlField.calcColumnWidthString = currentFixedWidth + 'px';
                }
                totalCalcColsWidth += currentFixedWidth;
            }
            this.renderer.setStyle(this.hostElement.nativeElement, 'width', totalCalcColsWidth + selectionCheckBoxWidth + 'px');
        }
    }
    initResizeData() {
        this.startX = 0;
        this.startWidth = 0;
        this.tableStartWidth = 0;
        this.pressedColumn = '';
    }
    getParent(el, parentSelector) {
        // If no parentSelector defined will bubble up all the way to *document*
        if (parentSelector === undefined) {
            parentSelector = document;
        }
        const parent = [];
        let p = el.parentNode;
        while (p &&
            p.className !== '' &&
            p.className.indexOf(parentSelector) === -1 &&
            parentSelector !== document) {
            const o = p;
            p = o.parentNode;
        }
        if (p.className.indexOf(parentSelector) > -1) {
            parent.push(p); // Push that parentSelector you wanted to stop at
        }
        return parent;
    }
    cleanItems() {
        this.itemsCounter = 0;
        this._items =
            this.totalRows > 0 ? Array(this.totalRows) : [];
        this.currentPageItems = [];
        this.calculatedObjectHeight = '';
    }
    initVariablesFromSession(items) {
        const selectedItemsObject = this.sessionService.getObject(PepListComponent.SELECTED_ITEMS_STATE_KEY);
        const selectedItemsFromMap = selectedItemsObject && selectedItemsObject.length > 0
            ? new Map(selectedItemsObject)
            : null;
        if (selectedItemsFromMap != null &&
            typeof selectedItemsFromMap.size !== 'undefined' &&
            selectedItemsFromMap.size > 0) {
            this.selectedItems = selectedItemsFromMap;
            this.sessionService.removeObject(PepListComponent.SELECTED_ITEMS_STATE_KEY);
        }
        else {
            this.selectedItems.clear();
        }
        const unSelectedItemsObject = this.sessionService.getObject(PepListComponent.UN_SELECTED_ITEMS_STATE_KEY);
        const unSelectedItemsMap = unSelectedItemsObject && unSelectedItemsObject.length > 0
            ? new Map(unSelectedItemsObject)
            : null;
        if (unSelectedItemsMap != null &&
            typeof unSelectedItemsMap.size !== 'undefined' &&
            unSelectedItemsMap.size > 0) {
            this.unSelectedItems = unSelectedItemsMap;
            this.sessionService.removeObject(PepListComponent.UN_SELECTED_ITEMS_STATE_KEY);
        }
        else {
            this.unSelectedItems.clear();
        }
        const isAllSelected = this.sessionService.getObject(PepListComponent.ALL_SELECTED_STATE_KEY);
        if (isAllSelected != null) {
            this.isAllSelected = isAllSelected && this.getIsAllSelected(items);
            this.sessionService.removeObject(PepListComponent.ALL_SELECTED_STATE_KEY);
        }
        else {
            this.isAllSelected = false;
        }
        const sortBy = this.sessionService.getObject(PepListComponent.SORT_BY_STATE_KEY);
        if (sortBy && sortBy !== '') {
            this.sortBy = sortBy;
            this.sessionService.removeObject(PepListComponent.SORT_BY_STATE_KEY);
        }
        else {
            this.sortBy = '';
        }
        const isAsc = this.sessionService.getObject(PepListComponent.ASCENDING_STATE_KEY);
        if (isAsc != null) {
            this.isAsc = isAsc;
            this.sessionService.removeObject(PepListComponent.ASCENDING_STATE_KEY);
        }
        else {
            this.isAsc = true;
        }
    }
    getIsAllSelected(items) {
        var _a;
        let result = true;
        if (((_a = this.selectedItems) === null || _a === void 0 ? void 0 : _a.size) > 0 && (items === null || items === void 0 ? void 0 : items.length) > 0) {
            for (const item of items) {
                if (!(item && this.selectedItems.has(item === null || item === void 0 ? void 0 : item.UID.toString()))) {
                    result = false;
                    break;
                }
            }
        }
        else {
            result = false;
        }
        return result;
    }
    getNumberOfStartItems() {
        let numberOfStartItems = 20;
        if (this.screenSize === PepScreenSizeType.XL ||
            this.screenSize === PepScreenSizeType.LG) {
            numberOfStartItems = this.isTable ? 50 : 40;
        }
        else if (this.screenSize === PepScreenSizeType.MD) {
            numberOfStartItems = this.isTable ? 30 : 20;
        }
        else if (this.screenSize === PepScreenSizeType.SM) {
            numberOfStartItems = this.isTable ? 20 : 10;
        }
        else if (this.screenSize === PepScreenSizeType.XS) {
            numberOfStartItems = this.isTable ? 15 : 5;
        }
        return numberOfStartItems;
    }
    setItemClicked(itemId, isSelectableForActions, itemType, isChecked) {
        const uniqItemId = this.getUniqItemId(itemId, itemType);
        // select the selected item.
        if (isChecked) {
            // Set seleted item
            this.selectedItemId = uniqItemId;
        }
        else {
            if (this.selectedItemId === uniqItemId) {
                this.selectedItemId = '';
            }
        }
        if (this.selectionTypeForActions === 'single') {
            this.selectedItemsChange.emit(this.selectedItemId.length === 0 ? 0 : 1);
        }
        else if (this.selectionTypeForActions === 'multi') {
            if (isSelectableForActions) {
                this.setSelectionItems(itemId, uniqItemId, isChecked);
                const currentList = this.isAllSelected
                    ? this.unSelectedItems
                    : this.selectedItems;
                const currentListCount = this.isAllSelected
                    ? this.totalRows - currentList.size
                    : currentList.size;
                this.selectedItemsChange.emit(currentListCount);
            }
        }
        // Raise selected item change event
        if (this.selectionTypeForActions !== 'none') {
            this.selectedItemChange.emit({
                id: itemId,
                selected: isChecked,
            });
        }
    }
    exportFunctionsOnHostElement() {
        // This is for web component usage for use those functions.
        this.hostElement.nativeElement.clear = this.clear.bind(this);
        this.hostElement.nativeElement.initListData = this.initListData.bind(this);
        this.hostElement.nativeElement.updateItems = this.updateItems.bind(this);
        this.hostElement.nativeElement.updatePage = this.updatePage.bind(this);
        this.hostElement.nativeElement.updateItem = this.updateItem.bind(this);
    }
    // getIsDisabled(item: ObjectsDataRow): boolean {
    //     return (
    //         this.lockItemInnerEvents || (item && !item.IsSelectableForActions)
    //     );
    // }
    getIsAllSelectedForActions() {
        var _a;
        let res = false;
        if (this.isAllSelected) {
            if (this.unSelectedItems.size === 0) {
                res = true;
            }
        }
        else {
            if ((_a = this.virtualScroller) === null || _a === void 0 ? void 0 : _a.viewPortItems) {
                if (this.selectedItems.size === this.totalRows) {
                    res = this.getIsAllSelected(this.virtualScroller.viewPortItems);
                }
                else if (this.selectedItems.size < this.totalRows) {
                    for (const item of this.virtualScroller.viewPortItems) {
                        res =
                            item && this.selectedItems.has(item === null || item === void 0 ? void 0 : item.UID.toString());
                        if (!res) {
                            break;
                        }
                    }
                }
            }
        }
        return res;
    }
    setIsAllSelected(isChecked) {
        if (this.selectionTypeForActions === 'multi') {
            this.selectAllCB.checked = isChecked;
            this.isAllSelected = isChecked;
        }
    }
    selectAllItemsForActions(e) {
        // For material checkbox || radio.
        const isChecked = e.source.checked;
        // Indeterminate mode
        let isIndeterminate = false;
        const currentList = this.isAllSelected
            ? this.unSelectedItems
            : this.selectedItems;
        if (currentList.size > 0) {
            isIndeterminate = true;
            this.isAllSelected = false;
            this.selectedItemsChange.emit(0);
            e.source.checked = false;
        }
        this.selectedItems.clear();
        this.unSelectedItems.clear();
        if (!isIndeterminate) {
            this.isAllSelected = isChecked;
            this.selectAllClick.emit(isChecked);
            if (this.selectionTypeForActions === 'multi') {
                if (!isChecked) {
                    this.selectedItemsChange.emit(0);
                    this.selectedItemId = '';
                }
                else {
                    const filteredItems = this.items.filter((item) => item && item.IsSelectableForActions);
                    this.selectedItemsChange.emit(filteredItems.length);
                }
            }
        }
        else {
            // Remove all
            if (this.selectionTypeForActions === 'multi') {
                this.selectAllClick.emit(false);
            }
        }
    }
    raiseStartIndexChange(startIndex = 0) {
        // this.startIndex = startIndex;
        this.startIndexChange.emit({ startIndex });
    }
    getIsItemSelected(item) {
        let isSelected = false;
        if (item) {
            if (this.selectionTypeForActions === 'single') {
                isSelected = this.selectedItemId === this.getUniqItemId(item.UID, item.Type.toString());
            }
            else if (this.selectionTypeForActions === 'multi') {
                if (item.IsSelectableForActions) {
                    isSelected = (this.isAllSelected && !this.unSelectedItems.has(item.UID)) || this.selectedItems.has(item.UID);
                }
            }
        }
        return isSelected;
    }
    selectItemForActions(e, itemId, isSelectableForActions, itemType = '') {
        // For material checkbox || radio.
        const isChecked = e.source.checked;
        this.setItemClicked(itemId, isSelectableForActions, itemType, isChecked);
    }
    itemClicked(e, item) {
        // Set seleted item
        const itemId = item === null || item === void 0 ? void 0 : item.UID.toString();
        const itemType = item === null || item === void 0 ? void 0 : item.Type.toString();
        let isChecked = false;
        if (item && item.IsSelectableForActions) {
            this.selectedItemId = this.getUniqItemId(itemId, itemType);
            isChecked = true;
        }
        if (this.isTable) {
            if (this.selectionTypeForActions === 'single') {
                this.setItemClicked(itemId, item.IsSelectableForActions, itemType, isChecked);
            }
            else if (this.selectionTypeForActions === 'none') {
                // Just mark the row as highlighted
                this.setItemClicked(itemId, item.IsSelectableForActions, itemType, true);
            }
        }
        else {
            if (this.disabled) {
                return;
            }
        }
        this.itemClick.emit({ source: item, viewType: this.viewType });
    }
    onTableRowMouseEnter(event, itemId, itemType) {
        if (!this.deviceHasMouse) {
            return;
        }
        const uniqItemId = this.getUniqItemId(itemId, itemType);
        this.hoveredItemId = uniqItemId;
    }
    onTableRowMouseLeave(event, itemId, itemType) {
        this.hoveredItemId = '';
    }
    onCardMouseEnter(event, itemId, itemType) {
        if (!this.deviceHasMouse) {
            return;
        }
        const uniqItemId = this.getUniqItemId(itemId, itemType);
        this.hoveredItemId = uniqItemId;
    }
    onCardMouseLeave(event, itemId, itemType) {
        this.hoveredItemId = '';
    }
    // trackByFunc(index: number, item: ObjectsDataRow): any {
    //     return item && item?.UID ? item?.UID : index;
    //     // let res: string = "";
    //     // if (item && item?.UID) {
    //     //    res = item?.UID + "_" + this.listType + "_" + (this.isTable ? "Table" : "Thumbnails");
    //     // }
    //     // else {
    //     //    res = index + "_" + this.listType + "_" + (this.isTable ? "Table" : "Thumbnails");
    //     // }
    //     // return res;
    // }
    clear() {
        this.cleanItems();
        this._layout = null;
    }
    setSelectedIds(selectedIds, items = null) {
        var _a;
        this.selectedItems.clear();
        this.isAllSelected = false;
        if (selectedIds) {
            // for (let i = 0; i < selected.length; i++) {
            for (const selectedId of selectedIds) {
                const tmp = selectedId.split(this.SEPARATOR);
                if (tmp && tmp.length > 0) {
                    const itemId = tmp[0];
                    const itemType = tmp.length > 1 ? tmp[1] : '';
                    this.selectedItems.set(itemId, this.getUniqItemId(itemId, itemType));
                }
            }
            this.isAllSelected = this.getIsAllSelected(items ? items : (_a = this.virtualScroller) === null || _a === void 0 ? void 0 : _a.viewPortItems);
            this.setSelectionDataInSession();
        }
        this.refresh();
    }
    setSelectionDataInSession() {
        if (this.selectedItems.size > 0) {
            this.sessionService.setObject(PepListComponent.SELECTED_ITEMS_STATE_KEY, JSON.stringify([...this.selectedItems]));
        }
        if (this.unSelectedItems.size > 0) {
            this.sessionService.setObject(PepListComponent.UN_SELECTED_ITEMS_STATE_KEY, JSON.stringify([...this.unSelectedItems]));
        }
        this.sessionService.setObject(PepListComponent.ALL_SELECTED_STATE_KEY, this.isAllSelected);
    }
    initListData(layout, totalRows, items) {
        this.initVariablesFromSession(items);
        const currentList = this.isAllSelected
            ? this.unSelectedItems
            : this.selectedItems;
        const currentListCount = this.isAllSelected
            ? this.totalRows - currentList.size
            : currentList.size;
        this.selectedItemsChange.emit(currentListCount);
        this._layout = layout;
        this.selectedItemId = '';
        this.totalRows = totalRows;
        this.scrollToTop(false);
        this.cleanItems();
        if (items) {
            if (this.pagerType === 'pages') {
                // If page index out of bounds - init to 0.
                const numberOfPages = Math.ceil(totalRows / this.pageSize);
                if (this.pageIndex >= numberOfPages) {
                    this.pageIndex = 0;
                }
                this.updatePage(items, {
                    pageIndex: this.pageIndex,
                    pageSize: this.pageSize,
                });
            }
            else {
                const numberOfStartItems = this.getNumberOfStartItems();
                const event = {
                    fromIndex: 0,
                    toIndex: numberOfStartItems,
                };
                this.updateItems(items, event);
                this.refresh();
            }
        }
        this.setLayout();
        this.onListLoad();
    }
    updateItems(items, event = null) {
        var _a;
        if (!event) {
            return; // Event isn't supplied.
        }
        // Clean array
        if (this.itemsCounter + items.length > PepListComponent.TOP_ITEMS_ARRAY) {
            this.cleanItems();
        }
        const startIndex = (_a = event.fromIndex) !== null && _a !== void 0 ? _a : 0;
        for (let i = 0; i < items.length; i++) {
            if (!this.items[i + startIndex]) {
                this.items[i + startIndex] = items[i];
                this.itemsCounter += 1;
            }
        }
        this.toggleLoadingItemsFropApi(false);
    }
    updatePage(items, event) {
        if (!event) {
            return; // Event isn't supplied.
        }
        // Clean array
        if (this.itemsCounter + items.length > PepListComponent.TOP_ITEMS_ARRAY) {
            this.cleanItems();
        }
        // const loadInChunks = this.itemsCounter === 0;
        const startIndex = Math.min(event.pageIndex * event.pageSize, this.totalRows);
        const endIndex = Math.min(startIndex + event.pageSize, this.totalRows);
        for (let i = 0; i < items.length; i++) {
            if (!this.items[i + startIndex]) {
                this.items[i + startIndex] = items[i];
                this.itemsCounter += 1;
            }
        }
        this.updateCurrentPageItems(startIndex, endIndex);
        this.toggleLoadingItemsFropApi(false);
    }
    updateItem(data) {
        const index = this.items.findIndex((i) => i && (i === null || i === void 0 ? void 0 : i.UID) === (data === null || data === void 0 ? void 0 : data.UID));
        if (index >= 0 && index < this.items.length) {
            this.updateItemProperties(this.items[index], data);
        }
    }
    scrollToIndex(index, alignToBeginning = true, additionalOffset = 0, animationMilliseconds = undefined, animationCompletedCallback = undefined) {
        var _a;
        (_a = this.virtualScroller) === null || _a === void 0 ? void 0 : _a.scrollToIndex(index, alignToBeginning, additionalOffset, animationMilliseconds, animationCompletedCallback);
    }
    updateItemProperties(itemToUpdate, data) {
        Object.assign(itemToUpdate, data);
    }
    getSelectedItemsData(isForEdit = false) {
        const res = new PepSelectionData();
        if (this.selectionTypeForActions === 'single') {
            const tmp = this.selectedItemId.split(this.SEPARATOR);
            res.selectionType = 1;
            res.rows = [tmp[0]];
            res.rowTypes = [tmp[1]];
        }
        else if (this.selectionTypeForActions === 'multi') {
            const items = [];
            const itemTypes = [];
            let selectionType = 1;
            let currentList = [];
            // For edit - only the selected items.
            if (isForEdit) {
                if (!this.isAllSelected) {
                    currentList = Array.from(this.selectedItems.values());
                }
                else {
                    // Get the id's of the items that not founded in unSelectedItems.
                    this.items.forEach((item) => {
                        if (item &&
                            !this.unSelectedItems.has(item === null || item === void 0 ? void 0 : item.UID.toString())) {
                            currentList.push(this.getUniqItemId(item === null || item === void 0 ? void 0 : item.UID.toString(), item === null || item === void 0 ? void 0 : item.Type.toString()));
                        }
                    });
                }
            }
            else {
                // For delete - can be the unselected with select_all functionality.
                currentList = Array.from(this.isAllSelected
                    ? this.unSelectedItems.values()
                    : this.selectedItems.values());
                selectionType = this.isAllSelected ? 0 : 1;
            }
            currentList.forEach((item) => {
                const tmp = item.split(this.SEPARATOR);
                if (tmp.length === 2) {
                    items.push(tmp[0]);
                    itemTypes.push(tmp[1]);
                }
            });
            res.selectionType = selectionType;
            res.rows = items;
            res.rowTypes = itemTypes;
        }
        return res;
    }
    getIsItemEditable(uid) {
        const item = this.items.filter((x) => (x === null || x === void 0 ? void 0 : x.UID.toString()) === uid);
        if (item.length > 0) {
            return item[0].IsEditable;
        }
        else {
            return false;
        }
    }
    getItemDataByID(uid) {
        return this.items.find((item) => (item === null || item === void 0 ? void 0 : item.UID.toString()) === uid);
    }
    refresh() {
        var _a;
        (_a = this.virtualScroller) === null || _a === void 0 ? void 0 : _a.refresh();
    }
    // ---------------------------------------------------------------
    //              Events handlers.
    // ---------------------------------------------------------------
    onWinResize(e) {
        this.refresh();
        this.containerWidth = 0;
        this.setLayout();
    }
    onListResizeStart(event, columnKey) {
        var _a;
        this.pressedColumn = columnKey;
        this.startX = event.x;
        this.startWidth = event.target.closest('.header-column').offsetWidth;
        this.tableStartWidth = (_a = this.virtualScroller) === null || _a === void 0 ? void 0 : _a.contentElementRef.nativeElement.offsetWidth;
    }
    onListResize(event) {
        if (this.pressedColumn.length > 0) {
            let widthToAdd = this.layoutService.isRtl() ? this.startX - event.x : event.x - this.startX;
            // Set the width of the column and the container of the whole columns.
            if (this.startWidth + widthToAdd >= PepListComponent.MINIMUM_COLUMN_WIDTH || widthToAdd > 0) {
                const length = this._layout.ControlFields.length;
                let totalCalcColsWidth = 0;
                for (let index = 0; index < length; index++) {
                    const uiControlField = this._layout
                        .ControlFields[index];
                    if (index === length - 1) {
                        // Calc the last column only in percentage type.
                        if (this.hasColumnWidthOfTypePercentage) {
                            const scrollWidth = this.layoutService.getScrollbarWidth();
                            widthToAdd += scrollWidth;
                            uiControlField.calcTitleColumnWidthString = uiControlField.calcColumnWidthString = 'calc(100% - ' + (totalCalcColsWidth + scrollWidth) + 'px)'; // For 100%
                        }
                        else {
                            if (uiControlField.ApiName === this.pressedColumn) {
                                uiControlField.calcColumnWidth = this.startWidth + widthToAdd;
                                uiControlField.calcTitleColumnWidthString = uiControlField.calcColumnWidth + 'px';
                                uiControlField.calcColumnWidthString = uiControlField.calcColumnWidth + 'px';
                            }
                        }
                    }
                    else if (uiControlField.ApiName === this.pressedColumn) {
                        uiControlField.calcColumnWidth = this.startWidth + widthToAdd;
                        uiControlField.calcTitleColumnWidthString = uiControlField.calcColumnWidthString = uiControlField.calcColumnWidth + 'px';
                    }
                    totalCalcColsWidth += uiControlField.calcColumnWidth;
                }
                this.renderer.setStyle(this.hostElement.nativeElement, 'width', this.tableStartWidth + widthToAdd + 'px');
            }
            this.checkForChanges = new Date().getTime();
        }
    }
    onListResizeEnd(event) {
        if (this.pressedColumn.length > 0) {
            if (event &&
                this.getParent(event.srcElement, 'resize-box').length > 0) {
                this.initResizeData();
            }
            else {
                // Set timeout 0 for onListSortingChange will have the pressedColumn.
                setTimeout(() => {
                    this.initResizeData();
                }, 0);
            }
            event.stopPropagation();
        }
    }
    onListSortingChange(sortBy, isAsc, event = null) {
        if (this.pressedColumn.length > 0 ||
            (event && this.getParent(event.srcElement, 'resize-box').length > 0)) {
            return;
        }
        if (this.sortBy !== sortBy || this.isAsc !== isAsc) {
            this.sortBy = sortBy;
            this.isAsc = isAsc;
            this.saveSortingToSession();
            this.sortingChange.emit({ sortBy, isAsc });
        }
    }
    onListHeaderMouseEnter(event) {
        // this.headerIsInFocus = true;
    }
    onListHeaderMouseLeave(event) {
        // this.headerIsInFocus = false;
        this.onListResizeEnd(event);
        this.initResizeData();
    }
    onPagerChange(event) {
        this.pageIndex = event.pageIndex;
        // Scroll to top.
        this.scrollToTop();
        const startIndex = event.pageIndex * event.pageSize;
        const endIndex = Math.min(startIndex + event.pageSize, this.totalRows);
        let shouldGetItemsFromApi = false;
        let index = startIndex;
        while (!shouldGetItemsFromApi && index < endIndex) {
            if (!this.items[index]) {
                shouldGetItemsFromApi = true;
            }
            index++;
        }
        // Get bulk from api.
        if (shouldGetItemsFromApi) {
            if (!this.loadingItemsFromApi) {
                this.toggleLoadingItemsFropApi(true);
                this.loadPage.emit({
                    pageIndex: event.pageIndex,
                    pageSize: event.pageSize,
                });
            }
        }
        else {
            setTimeout(() => {
                this.updateCurrentPageItems(startIndex, endIndex);
            }, this.scrollAnimationTime);
        }
    }
    onVirtualScrollerChange(event) {
        this.raiseStartIndexChange(event.startIndex);
        if (this.pagerType === 'scroll') {
            // For other events do nothing.
            if (typeof event.startIndex === 'undefined' || event.startIndex < 0 ||
                typeof event.endIndex === 'undefined' || event.endIndex < 0) {
                return;
            }
            const addAtStart = event.scrollDirection === 'backward';
            let shouldGetItemsFromApi = false;
            let indexOfMissingItem;
            if (addAtStart) {
                indexOfMissingItem = event.endIndex;
                while (!shouldGetItemsFromApi && indexOfMissingItem >= event.startIndex) {
                    if (!this.items[indexOfMissingItem]) {
                        shouldGetItemsFromApi = true;
                    }
                    if (!shouldGetItemsFromApi) {
                        indexOfMissingItem--;
                    }
                }
            }
            else {
                indexOfMissingItem = event.startIndex;
                while (!shouldGetItemsFromApi && indexOfMissingItem <= event.endIndex) {
                    if (!this.items[indexOfMissingItem]) {
                        shouldGetItemsFromApi = true;
                    }
                    if (!shouldGetItemsFromApi) {
                        indexOfMissingItem++;
                    }
                }
            }
            // Get bulk from api.
            if (shouldGetItemsFromApi) {
                if (!this.loadingItemsFromApi) {
                    this.toggleLoadingItemsFropApi(true);
                    const top = this.getTopItems() - 1;
                    const fromIndex = addAtStart ? Math.max(indexOfMissingItem - top, 0) : indexOfMissingItem;
                    const toIndex = addAtStart ? indexOfMissingItem : Math.min(indexOfMissingItem + top, this.totalRows);
                    this.loadItems.emit({
                        fromIndex,
                        toIndex,
                    });
                }
            }
        }
    }
    onListLoad() {
        setTimeout(() => {
            this.listLoad.emit();
        }, 0);
    }
    onChildRectChange(event) {
        setTimeout(() => {
            this.calculatedObjectHeight = (event === null || event === void 0 ? void 0 : event.height) + 'px';
        }, 0);
    }
    onValueChanged(valueChange) {
        if (this.disabled) {
            return;
        }
        this.valueChange.emit(valueChange);
    }
    onCustomizeFieldClick(customizeFieldClickedData) {
        if (this.disabled) {
            return;
        }
        this.fieldClick.emit(customizeFieldClickedData);
    }
}
PepListComponent.TOP_ITEMS_DEFAULT = 100;
PepListComponent.TOP_ITEMS_TABLE = 100;
PepListComponent.TOP_ITEMS_THUMBNAILS = 100;
PepListComponent.TOP_ITEMS_ARRAY = 2500;
PepListComponent.SELECTED_ITEMS_STATE_KEY = 'SelectedItems';
PepListComponent.UN_SELECTED_ITEMS_STATE_KEY = 'UnSelectedItems';
PepListComponent.ALL_SELECTED_STATE_KEY = 'AllSelected';
PepListComponent.SORT_BY_STATE_KEY = 'SortBy';
PepListComponent.ASCENDING_STATE_KEY = 'IsAscending';
PepListComponent.MINIMUM_COLUMN_WIDTH = 48;
PepListComponent.decorators = [
    { type: Component, args: [{
                selector: 'pep-list',
                template: "<ng-container *ngIf=\"totalRows == 0\">\n    <ng-container *ngIf=\"noDataFoundMsg; then noDataMsgInputBlock; else noDataMsgDefaultBlock\"></ng-container>\n    <ng-template #noDataMsgInputBlock>\n        <div class=\"pep-border-bottom\">\n            <p class=\"title-xl no-data\">\n                {{ noDataFoundMsg }}\n            </p>\n        </div>\n    </ng-template>\n    <ng-template #noDataMsgDefaultBlock>\n        <div class=\"pep-border-bottom\">\n            <p class=\"title-xl no-data\">\n                {{ 'LIST.NO_DATA_FOUND' | translate}}\n            </p>\n        </div>\n        <div class=\"no-data-suggestions\">\n            <p class=\"suggestions-title title-lg\">\n                {{ 'LIST.NO_DATA_FOUND_SUGGESTIONS_TITLE' | translate}}\n            </p>\n            <ul class=\"suggestions-list body-lg\" [innerHtml]=\"'LIST.NO_DATA_FOUND_SUGGESTIONS_LIST' | translate\"></ul>\n        </div>\n    </ng-template>\n</ng-container>\n<ng-container *ngIf=\"totalRows > 0\">\n    <ng-container *ngTemplateOutlet=\"tableHeader\"></ng-container>\n\n    <virtual-scroller #scroller [items]=\"pagerType === 'pages' ? currentPageItems : items\"\n        [scrollDebounceTime]=\"scrollDebounceTime\" [scrollThrottlingTime]=\"scrollThrottlingTime\"\n        [bufferAmount]=\"printMode ? totalRows : -1\" [parentScroll]=\"parentScroll\" [disable]=\"loadingItemsFromApi\"\n        class=\"virtual-scroller\" [ngClass]=\"{ 'table-body': isTable, 'cards-body': !isTable }\"\n        (vsChange)=\"onVirtualScrollerChange($event)\" (vsChildRectChange)=\"onChildRectChange($event)\">\n        <ng-container *ngFor=\"let item of scroller.viewPortItems; let index; let isFirst = first;\">\n            <ng-container *ngTemplateOutlet=\"listData; context: {item: item}\"></ng-container>\n        </ng-container>\n    </virtual-scroller>\n\n    <pep-list-pager *ngIf=\"pagerType === 'pages'\" class=\" list-pager\" [disabled]=\"loadingItemsFromApi\"\n        [length]=\"totalRows\" [pageSize]=\"pageSize\" [pageIndex]=\"pageIndex\" (pagerChange)=\"onPagerChange($event)\">\n    </pep-list-pager>\n\n    <ng-container *ngTemplateOutlet=\"tableTotal\"></ng-container>\n</ng-container>\n\n<ng-template #listData let-item=\"item\">\n    <ng-container *ngIf=\"isTable\">\n        <!-- getIsItemSelected(item) -> item | isItemSelected: selectionTypeForActions : selectedItemId : isAllSelected : selectedItems : unSelectedItems -->\n        <div class=\"table-row\" (mouseenter)=\"onTableRowMouseEnter($event, item?.UID, item?.Type)\"\n            (mouseleave)=\"onTableRowMouseLeave($event, item?.UID, item?.Type)\" [ngClass]=\"{\n                    selected: getIsItemSelected(item),\n                    highlighted: item?.UID + SEPARATOR + item?.Type === selectedItemId\n                }\" [ngStyle]=\"{ visibility: !loadingItemsFromApi || item ? 'visible' : 'hidden' }\">\n            <fieldset class=\"table-row-fieldset\" [ngStyle]=\"{ 'background-color': item?.BackgroundColor }\">\n                <mat-checkbox *ngIf=\"selectionTypeForActions == 'multi'\" type=\"checkbox\"\n                    class=\"pull-left flip row-selection\"\n                    [disabled]=\"item | isItemDisabled: lockItemInnerEvents : printMode\" [ngStyle]=\"{\n                            visibility: !deviceHasMouse ||\n                            item?.UID + SEPARATOR + item?.Type === hoveredItemId || isAllSelected || selectedItems.size > 0 ? 'visible' : 'hidden'\n                        }\" [checked]=\"getIsItemSelected(item)\"\n                    (change)=\"selectItemForActions($event, item?.UID, item?.IsSelectableForActions, item?.Type)\">\n                </mat-checkbox>\n                <mat-radio-button *ngIf=\"selectionTypeForActions == 'single'\" name=\"selection\"\n                    class=\"pull-left flip row-selection pep-radio-button\"\n                    [disabled]=\"item | isItemDisabled: lockItemInnerEvents : printMode\"\n                    [checked]=\"getIsItemSelected(item)\"\n                    (change)=\"selectItemForActions($event, item?.UID, item?.IsSelectableForActions, item?.Type)\">\n                </mat-radio-button>\n                <pep-form [layoutType]=\"'table'\" [checkForChanges]=\"checkForChanges\" [layout]=\"layout\"\n                    [firstFieldAsLink]=\"firstFieldAsLink\" [data]=\"item\" [canEditObject]=\"!disabled\"\n                    [lockEvents]=\"lockItemInnerEvents || printMode\" [isReport]=\"isReport\" [isActive]=\"\n                            (item?.UID + SEPARATOR + item?.Type === selectedItemId ||\n                            item?.UID + SEPARATOR + item?.Type === hoveredItemId) && deviceHasMouse\n                        \" (valueChange)=\"onValueChanged($event)\" (fieldClick)=\"onCustomizeFieldClick($event)\"\n                    (click)=\"itemClicked($event, item)\">\n                </pep-form>\n            </fieldset>\n        </div>\n    </ng-container>\n\n    <ng-container *ngIf=\"!isTable\">\n        <div (mouseenter)=\"onCardMouseEnter($event, item?.UID, item?.Type)\"\n            (mouseleave)=\"onCardMouseLeave($event, item?.UID, item?.Type)\" [ngClass]=\"{\n                    selected: getIsItemSelected(item),\n                    highlighted: item?.UID + SEPARATOR + item?.Type === selectedItemId,\n                    'line-view': viewType === 'lines',\n                    'card-view': viewType === 'cards',\n                    'small-card': cardSize === 'sm'\n                }\" class=\"pull-left flip\"\n            [ngStyle]=\"{ height: calculatedObjectHeight, visibility: !loadingItemsFromApi || item ? 'visible' : 'hidden' }\">\n            <mat-checkbox *ngIf=\"showCardSelection\" class=\"pull-left flip card-selection\"\n                [disabled]=\"item | isItemDisabled: lockItemInnerEvents : printMode\" [checked]=\"getIsItemSelected(item)\"\n                (change)=\"selectItemForActions($event, item?.UID, item?.IsSelectableForActions, item?.Type)\">\n            </mat-checkbox>\n            <pep-form [layoutType]=\"'card'\" [firstFieldAsLink]=\"firstFieldAsLink\" [checkForChanges]=\"checkForChanges\"\n                [layout]=\"layout\" [data]=\"item\" [canEditObject]=\"!disabled\"\n                [lockEvents]=\"lockItemInnerEvents || printMode\" [isActive]=\"\n                        (item?.UID + SEPARATOR + item?.Type === selectedItemId ||\n                        item?.UID + SEPARATOR + item?.Type === hoveredItemId) && deviceHasMouse\n                    \" (valueChange)=\"onValueChanged($event)\" (fieldClick)=\"onCustomizeFieldClick($event)\"\n                (click)=\"itemClicked($event, item)\">\n            </pep-form>\n        </div>\n    </ng-container>\n</ng-template>\n\n<ng-template #tableHeader>\n    <div *ngIf=\"isTable\" class=\"table-header\" (mouseup)=\"onListResizeEnd($event)\"\n        (mouseenter)=\"onListHeaderMouseEnter($event)\" (mouseleave)=\"onListHeaderMouseLeave($event)\"\n        (mousemove)=\"onListResize($event)\">\n\n        <div class=\"table-header-padding-top\"></div>\n        <fieldset class=\"table-header-fieldset\">\n            <mat-checkbox *ngIf=\"selectionTypeForActions !== 'none'\" #selectAllCB class=\"pull-left flip row-selection\"\n                type=\"checkbox\" [ngStyle]=\"{\n                        visibility:\n                            selectionTypeForActions == 'single' || \n                            (selectionTypeForActions == 'multi' && hideAllSelectionInMulti) ? 'hidden' : 'visible'\n                    }\"\n                [indeterminate]=\"isAllSelected ? unSelectedItems.size > 0 && unSelectedItems.size < totalRows : (selectedItems.size > 0 && !getIsAllSelectedForActions())\"\n                [disabled]=\"disabled || selectionTypeForActions === 'single'\" [checked]=\"getIsAllSelectedForActions()\"\n                (change)=\"selectAllItemsForActions($event)\"></mat-checkbox>\n            <fieldset>\n                <div *ngFor=\"let field of layout?.ControlFields; let j = index\" class=\"header-column pull-left flip\"\n                    [ngStyle]=\"{ width: field.calcTitleColumnWidthString }\" [ngClass]=\"{\n                            'support-sorting': supportSorting,\n                            'has-sorting': field.ApiName === sortBy,\n                            'is-resizing': field.ApiName === pressedColumn,\n                            'is-first': j === 0 && selectionTypeForActions !== 'multi',\n                            'is-last': j === layout?.ControlFields?.length - 1\n                        }\"\n                    (click)=\"supportSorting ? (onListSortingChange(field.ApiName, sortBy !== null && sortBy != field.ApiName ? true : !isAsc, $event)) : false\">\n\n                    <label id=\"{{ field.ApiName }}\"\n                        class=\"header-label body-sm pull-left flip text-align-{{ field.Layout.XAlignment }}\"\n                        title=\"{{ field.Title }}\">\n                        <span *ngIf=\"field.Mandatory\" class=\"mandatory\">\n                            <pep-icon name=\"system_must\"></pep-icon>\n                        </span>\n                        {{ field.Title != '' ? field.Title : ' '}}\n                    </label>\n\n                    <div *ngIf=\"supportResizing\" class=\"resize-box pull-right flip\"\n                        (mousedown)=\"onListResizeStart($event, field.ApiName)\">\n                        <div class=\"splitter\"></div>\n                    </div>\n\n                    <div *ngIf=\"supportSorting\" class=\"sorting-box pull-left flip\"\n                        [ngClass]=\"{ 'has-sorting': field.ApiName === sortBy }\">\n                        <mat-icon *ngIf=\"field.ApiName !== sortBy\">\n                            <pep-icon name=\"arrow_either\" class=\"asc\"></pep-icon>\n                        </mat-icon>\n                        <ng-container *ngIf=\"field.ApiName === sortBy\">\n                            <mat-icon *ngIf=\"!isAsc\" [ngClass]=\"{ 'sort-by': field.ApiName === sortBy && isAsc }\"\n                                title=\"{{ 'LIST.SORT_ASC' | translate }}\">\n                                <pep-icon name=\"arrow_up\" class=\"asc\"></pep-icon>\n                            </mat-icon>\n                            <mat-icon *ngIf=\"isAsc\" [ngClass]=\"{ 'sort-by': field.ApiName === sortBy && !isAsc }\"\n                                title=\"{{ 'LIST.SORT_DESC' | translate }}\">\n                                <pep-icon name=\"arrow_down\" class=\"desc\"></pep-icon>\n                            </mat-icon>\n                        </ng-container>\n                    </div>\n                </div>\n            </fieldset>\n        </fieldset>\n    </div>\n</ng-template>\n\n<ng-template #tableTotal>\n    <div *ngIf=\"isTable && totalsRow?.length > 0 && totalsRow.length <= layout?.ControlFields.length\"\n        class=\"table-total\">\n        <fieldset class=\"table-header-fieldset\">\n            <div *ngFor=\"let field of layout?.ControlFields; let j = index\" class=\"total-column pull-left flip\"\n                [ngStyle]=\"{ width: field.calcTitleColumnWidthString }\">\n                <label class=\"total-label body-sm text-align-{{ field.Layout.XAlignment }}\">\n                    {{ totalsRow[j] }}\n                </label>\n            </div>\n        </fieldset>\n    </div>\n</ng-template>",
                host: {
                    '(window:resize)': 'onWinResize($event)',
                },
                styles: [":host{height:inherit;display:flex;flex-direction:column}.no-data{margin:2rem 0;margin:var(--pep-spacing-2xl,2rem) 0}.no-data-suggestions .suggestions-title{margin:1rem 0 .5rem;margin:var(--pep-spacing-lg,1rem) 0 var(--pep-spacing-sm,.5rem)}.no-data-suggestions .suggestions-list{margin:0;padding:0;-webkit-padding-start:2rem;padding-inline-start:2rem;-webkit-padding-start:var(--pep-spacing-2xl,2rem);padding-inline-start:var(--pep-spacing-2xl,2rem)}.virtual-scroller{min-height:5rem;height:inherit}"]
            },] }
];
PepListComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: PepLayoutService },
    { type: PepSessionService },
    { type: ChangeDetectorRef },
    { type: Renderer2 },
    { type: NgZone }
];
PepListComponent.propDecorators = {
    noDataFoundMsg: [{ type: Input }],
    selectionTypeForActions: [{ type: Input }],
    showCardSelection: [{ type: Input }],
    hideAllSelectionInMulti: [{ type: Input }],
    cardSize: [{ type: Input }],
    viewType: [{ type: Input }],
    firstFieldAsLink: [{ type: Input }],
    supportSorting: [{ type: Input }],
    supportResizing: [{ type: Input }],
    parentScroll: [{ type: Input }],
    disabled: [{ type: Input }],
    lockEvents: [{ type: Input }],
    lockItemInnerEvents: [{ type: Input }],
    printMode: [{ type: Input }],
    isReport: [{ type: Input }],
    totalsRow: [{ type: Input }],
    pagerType: [{ type: Input }],
    pageSize: [{ type: Input }],
    pageIndex: [{ type: Input }],
    scrollAnimationTime: [{ type: Input }],
    scrollDebounceTime: [{ type: Input }],
    scrollThrottlingTime: [{ type: Input }],
    useAsWebComponent: [{ type: Input }],
    itemClick: [{ type: Output }],
    fieldClick: [{ type: Output }],
    valueChange: [{ type: Output }],
    sortingChange: [{ type: Output }],
    selectedItemsChange: [{ type: Output }],
    selectedItemChange: [{ type: Output }],
    selectAllClick: [{ type: Output }],
    listLoad: [{ type: Output }],
    loadItems: [{ type: Output }],
    loadPage: [{ type: Output }],
    startIndexChange: [{ type: Output }],
    virtualScroller: [{ type: ViewChild, args: [VirtualScrollerComponent,] }],
    selectAllCB: [{ type: ViewChild, args: ['selectAllCB',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtbGliL2xpc3QvbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFFWixTQUFTLEVBQ1QsU0FBUyxFQUNULFVBQVUsRUFDVixpQkFBaUIsRUFHakIsTUFBTSxHQUNULE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFDSCxnQkFBZ0IsRUFDaEIsaUJBQWlCLEVBQ2pCLGlCQUFpQixFQUdqQixVQUFVLEdBRWIsTUFBTSx5QkFBeUIsQ0FBQztBQU1qQyxPQUFPLEVBQUUsd0JBQXdCLEVBQWEsTUFBTSxvQkFBb0IsQ0FBQztBQUV6RSxPQUFPLEVBTUgsZ0JBQWdCLEVBR2hCLGlCQUFpQixHQUdwQixNQUFNLGNBQWMsQ0FBQztBQU10QixPQUFPLEtBQUssS0FBSyxNQUFNLG1CQUFtQixDQUFDO0FBVzNDLE1BQU0sT0FBTyxnQkFBZ0I7SUFnTHpCLFlBQ1ksV0FBdUIsRUFDdkIsYUFBK0IsRUFDL0IsY0FBaUMsRUFDakMsRUFBcUIsRUFDckIsUUFBbUIsRUFDbkIsSUFBWTtRQUxaLGdCQUFXLEdBQVgsV0FBVyxDQUFZO1FBQ3ZCLGtCQUFhLEdBQWIsYUFBYSxDQUFrQjtRQUMvQixtQkFBYyxHQUFkLGNBQWMsQ0FBbUI7UUFDakMsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFDckIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUNuQixTQUFJLEdBQUosSUFBSSxDQUFRO1FBeEtmLG1CQUFjLEdBQVcsSUFBSSxDQUFDO1FBQzlCLDRCQUF1QixHQUF5QixPQUFPLENBQUM7UUFDeEQsc0JBQWlCLEdBQUcsS0FBSyxDQUFDO1FBQzFCLDRCQUF1QixHQUFHLEtBQUssQ0FBQztRQUVoQyxhQUFRLEdBQXdCLElBQUksQ0FBQztRQUN0QyxjQUFT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O1lBTVQsTUFBTTs7OzZCQThETCxLQUFLO3NDQUNMLEtBQUs7Z0NBQ0wsS0FBSztzQ0FDTCxLQUFLO3VCQUVMLEtBQUs7dUJBRUwsS0FBSzsrQkFTTCxLQUFLOzZCQUNMLEtBQUs7OEJBQ0wsS0FBSzsyQkFHTCxLQUFLO3VCQVFMLEtBQUs7eUJBR0wsS0FBSztrQ0FjTCxLQUFLO3dCQUNMLEtBQUs7dUJBQ0wsS0FBSzt3QkFDTCxLQUFLO3dCQUNMLEtBQUs7dUJBQ0wsS0FBSzt3QkFDTCxLQUFLO2tDQUdMLEtBQUs7aUNBQ0wsS0FBSzttQ0FDTCxLQUFLO2dDQUdMLEtBQUs7d0JBV0wsTUFBTTt5QkFHTixNQUFNOzBCQUdOLE1BQU07NEJBR04sTUFBTTtrQ0FHTixNQUFNO2lDQUdOLE1BQU07NkJBR04sTUFBTTt1QkFNTixNQUFNO3dCQUdOLE1BQU07dUJBR04sTUFBTTsrQkFHTixNQUFNOzhCQUdOLFNBQVMsU0FBQyx3QkFBd0I7MEJBQ2xDLFNBQVMsU0FBQyxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgSW5wdXQsXG4gICAgT3V0cHV0LFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBPbkluaXQsXG4gICAgUmVuZGVyZXIyLFxuICAgIFZpZXdDaGlsZCxcbiAgICBFbGVtZW50UmVmLFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIE9uRGVzdHJveSxcbiAgICBPbkNoYW5nZXMsXG4gICAgTmdab25lLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGRlbGF5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtcbiAgICBQZXBMYXlvdXRTZXJ2aWNlLFxuICAgIFBlcFNjcmVlblNpemVUeXBlLFxuICAgIFBlcFNlc3Npb25TZXJ2aWNlLFxuICAgIFVJQ29udHJvbCxcbiAgICBVSUNvbnRyb2xGaWVsZCxcbiAgICBGSUVMRF9UWVBFLFxuICAgIE9iamVjdHNEYXRhUm93LFxufSBmcm9tICdAcGVwcGVyaS1hZGRvbnMvbmd4LWxpYic7XG5pbXBvcnQge1xuICAgIElQZXBGb3JtRmllbGRWYWx1ZUNoYW5nZUV2ZW50LFxuICAgIElQZXBGb3JtRmllbGRDbGlja0V2ZW50LFxufSBmcm9tICdAcGVwcGVyaS1hZGRvbnMvbmd4LWxpYi9mb3JtJztcblxuaW1wb3J0IHsgVmlydHVhbFNjcm9sbGVyQ29tcG9uZW50LCBJUGFnZUluZm8gfSBmcm9tICcuL3ZpcnR1YWwtc2Nyb2xsZXInO1xuXG5pbXBvcnQge1xuICAgIElQZXBMaXN0TG9hZEl0ZW1zRXZlbnQsXG4gICAgSVBlcExpc3RTb3J0aW5nQ2hhbmdlRXZlbnQsXG4gICAgSVBlcExpc3RJdGVtQ2xpY2tFdmVudCxcbiAgICBQZXBMaXN0U2VsZWN0aW9uVHlwZSxcbiAgICBQZXBMaXN0Vmlld1R5cGUsXG4gICAgUGVwU2VsZWN0aW9uRGF0YSxcbiAgICBQZXBMaXN0UGFnZXJUeXBlLFxuICAgIElQZXBMaXN0TG9hZFBhZ2VFdmVudCxcbiAgICBERUZBVUxUX1BBR0VfU0laRSxcbiAgICBJUGVwTGlzdFN0YXJ0SW5kZXhDaGFuZ2VFdmVudCxcbiAgICBQZXBMaXN0Q2FyZFNpemVUeXBlLFxufSBmcm9tICcuL2xpc3QubW9kZWwnO1xuaW1wb3J0IHtcbiAgICBJUGVwTGlzdFBhZ2VyQ2hhbmdlRXZlbnQsXG4gICAgUGVwTGlzdFBhZ2VyQ29tcG9uZW50LFxufSBmcm9tICcuL2xpc3QtcGFnZXIuY29tcG9uZW50JztcblxuaW1wb3J0ICogYXMgdHdlZW4gZnJvbSAnQHR3ZWVuanMvdHdlZW4uanMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3BlcC1saXN0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vbGlzdC5jb21wb25lbnQuc2NzcyddLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgJyh3aW5kb3c6cmVzaXplKSc6ICdvbldpblJlc2l6ZSgkZXZlbnQpJyxcbiAgICB9LFxuICAgIC8vIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFBlcExpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgICBzdGF0aWMgVE9QX0lURU1TX0RFRkFVTFQgPSAxMDA7XG4gICAgc3RhdGljIFRPUF9JVEVNU19UQUJMRSA9IDEwMDtcbiAgICBzdGF0aWMgVE9QX0lURU1TX1RIVU1CTkFJTFMgPSAxMDA7XG4gICAgc3RhdGljIFRPUF9JVEVNU19BUlJBWSA9IDI1MDA7XG5cbiAgICBzdGF0aWMgU0VMRUNURURfSVRFTVNfU1RBVEVfS0VZID0gJ1NlbGVjdGVkSXRlbXMnO1xuICAgIHN0YXRpYyBVTl9TRUxFQ1RFRF9JVEVNU19TVEFURV9LRVkgPSAnVW5TZWxlY3RlZEl0ZW1zJztcbiAgICBzdGF0aWMgQUxMX1NFTEVDVEVEX1NUQVRFX0tFWSA9ICdBbGxTZWxlY3RlZCc7XG4gICAgc3RhdGljIFNPUlRfQllfU1RBVEVfS0VZID0gJ1NvcnRCeSc7XG4gICAgc3RhdGljIEFTQ0VORElOR19TVEFURV9LRVkgPSAnSXNBc2NlbmRpbmcnO1xuXG4gICAgc3RhdGljIE1JTklNVU1fQ09MVU1OX1dJRFRIID0gNDg7XG5cbiAgICBASW5wdXQoKSBub0RhdGFGb3VuZE1zZzogc3RyaW5nID0gbnVsbDtcbiAgICBASW5wdXQoKSBzZWxlY3Rpb25UeXBlRm9yQWN0aW9uczogUGVwTGlzdFNlbGVjdGlvblR5cGUgPSAnbXVsdGknO1xuICAgIEBJbnB1dCgpIHNob3dDYXJkU2VsZWN0aW9uID0gZmFsc2U7XG4gICAgQElucHV0KCkgaGlkZUFsbFNlbGVjdGlvbkluTXVsdGkgPSBmYWxzZTtcblxuICAgIEBJbnB1dCgpIGNhcmRTaXplOiBQZXBMaXN0Q2FyZFNpemVUeXBlID0gJ21kJztcbiAgICBwcml2YXRlIF92aWV3VHlwZTogUGVwTGlzdFZpZXdUeXBlID0gJyc7XG4gICAgQElucHV0KClcbiAgICBzZXQgdmlld1R5cGUodmFsdWU6IFBlcExpc3RWaWV3VHlwZSkge1xuICAgICAgICB0aGlzLl92aWV3VHlwZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmlzVGFibGUgPSB2YWx1ZSA9PT0gJ3RhYmxlJztcbiAgICB9XG4gICAgZ2V0IHZpZXdUeXBlKCk6IFBlcExpc3RWaWV3VHlwZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl92aWV3VHlwZTtcbiAgICB9XG5cbiAgICBASW5wdXQoKSBmaXJzdEZpZWxkQXNMaW5rID0gZmFsc2U7XG4gICAgQElucHV0KCkgc3VwcG9ydFNvcnRpbmcgPSB0cnVlO1xuICAgIEBJbnB1dCgpIHN1cHBvcnRSZXNpemluZyA9IHRydWU7XG5cbiAgICBwcml2YXRlIF9wYXJlbnRTY3JvbGw6IEVsZW1lbnQgfCBXaW5kb3cgPSBudWxsO1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IHBhcmVudFNjcm9sbCh2YWx1ZTogRWxlbWVudCB8IFdpbmRvdykge1xuICAgICAgICB0aGlzLl9wYXJlbnRTY3JvbGwgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHBhcmVudFNjcm9sbCgpOiBFbGVtZW50IHwgV2luZG93IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudFNjcm9sbDtcbiAgICB9XG5cbiAgICBASW5wdXQoKSBkaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBfbG9ja0V2ZW50cyA9IGZhbHNlO1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IGxvY2tFdmVudHModmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5fbG9ja0V2ZW50cyA9IHZhbHVlO1xuXG4gICAgICAgIGlmICh0aGlzLl9sb2NrRXZlbnRzKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudCwgJ2xvY2stZXZlbnRzJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudCwgJ2xvY2stZXZlbnRzJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGxvY2tFdmVudHMoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb2NrRXZlbnRzO1xuICAgIH1cblxuICAgIEBJbnB1dCgpIGxvY2tJdGVtSW5uZXJFdmVudHMgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwcmludE1vZGUgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBpc1JlcG9ydCA9IGZhbHNlO1xuICAgIEBJbnB1dCgpIHRvdGFsc1JvdyA9IFtdO1xuICAgIEBJbnB1dCgpIHBhZ2VyVHlwZTogUGVwTGlzdFBhZ2VyVHlwZSA9ICdzY3JvbGwnO1xuICAgIEBJbnB1dCgpIHBhZ2VTaXplOiBudW1iZXIgPSBERUZBVUxUX1BBR0VfU0laRTtcbiAgICBASW5wdXQoKSBwYWdlSW5kZXggPSAwO1xuICAgIC8vIEBJbnB1dCgpIHN0YXJ0SW5kZXggPSAwO1xuXG4gICAgQElucHV0KCkgc2Nyb2xsQW5pbWF0aW9uVGltZSA9IDUwMDtcbiAgICBASW5wdXQoKSBzY3JvbGxEZWJvdW5jZVRpbWUgPSAwO1xuICAgIEBJbnB1dCgpIHNjcm9sbFRocm90dGxpbmdUaW1lID0gMDtcblxuICAgIHByaXZhdGUgX3VzZUFzV2ViQ29tcG9uZW50ID0gZmFsc2U7XG4gICAgQElucHV0KClcbiAgICBzZXQgdXNlQXNXZWJDb21wb25lbnQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5fdXNlQXNXZWJDb21wb25lbnQgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmV4cG9ydEZ1bmN0aW9uc09uSG9zdEVsZW1lbnQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdXNlQXNXZWJDb21wb25lbnQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl91c2VBc1dlYkNvbXBvbmVudDtcbiAgICB9XG5cbiAgICBAT3V0cHV0KClcbiAgICBpdGVtQ2xpY2s6IEV2ZW50RW1pdHRlcjxJUGVwTGlzdEl0ZW1DbGlja0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8SVBlcExpc3RJdGVtQ2xpY2tFdmVudD4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGZpZWxkQ2xpY2s6IEV2ZW50RW1pdHRlcjxJUGVwRm9ybUZpZWxkQ2xpY2tFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPElQZXBGb3JtRmllbGRDbGlja0V2ZW50PigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgdmFsdWVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxJUGVwRm9ybUZpZWxkVmFsdWVDaGFuZ2VFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPElQZXBGb3JtRmllbGRWYWx1ZUNoYW5nZUV2ZW50PigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgc29ydGluZ0NoYW5nZTogRXZlbnRFbWl0dGVyPElQZXBMaXN0U29ydGluZ0NoYW5nZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8SVBlcExpc3RTb3J0aW5nQ2hhbmdlRXZlbnQ+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBzZWxlY3RlZEl0ZW1zQ2hhbmdlOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgc2VsZWN0ZWRJdGVtQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgc2VsZWN0QWxsQ2xpY2s6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICAvLyBAT3V0cHV0KClcbiAgICAvLyBzaW5nbGVBY3Rpb25DbGljazogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGxpc3RMb2FkOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBsb2FkSXRlbXM6IEV2ZW50RW1pdHRlcjxJUGVwTGlzdExvYWRJdGVtc0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8SVBlcExpc3RMb2FkSXRlbXNFdmVudD4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGxvYWRQYWdlOiBFdmVudEVtaXR0ZXI8SVBlcExpc3RMb2FkUGFnZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8SVBlcExpc3RMb2FkUGFnZUV2ZW50PigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgc3RhcnRJbmRleENoYW5nZTogRXZlbnRFbWl0dGVyPElQZXBMaXN0U3RhcnRJbmRleENoYW5nZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8SVBlcExpc3RTdGFydEluZGV4Q2hhbmdlRXZlbnQ+KCk7XG5cbiAgICBAVmlld0NoaWxkKFZpcnR1YWxTY3JvbGxlckNvbXBvbmVudCkgcHJpdmF0ZSB2aXJ0dWFsU2Nyb2xsZXI6IFZpcnR1YWxTY3JvbGxlckNvbXBvbmVudDtcbiAgICBAVmlld0NoaWxkKCdzZWxlY3RBbGxDQicpIHNlbGVjdEFsbENCOiBhbnk7XG5cbiAgICBwcml2YXRlIF9sYXlvdXQ6IFVJQ29udHJvbCA9IG51bGw7XG4gICAgZ2V0IGxheW91dCgpOiBVSUNvbnRyb2wge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGF5b3V0O1xuICAgIH1cblxuICAgIHRvdGFsUm93cyA9IC0xO1xuICAgIGlzVGFibGUgPSBmYWxzZTtcbiAgICBwcml2YXRlIGhhc0NvbHVtbldpZHRoT2ZUeXBlUGVyY2VudGFnZSA9IHRydWU7XG5cbiAgICBwcml2YXRlIF9pdGVtczogQXJyYXk8T2JqZWN0c0RhdGFSb3c+ID0gbnVsbDtcbiAgICBnZXQgaXRlbXMoKTogQXJyYXk8T2JqZWN0c0RhdGFSb3c+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXRlbXNDb3VudGVyID0gMDtcblxuICAgIGN1cnJlbnRQYWdlSXRlbXM6IEFycmF5PE9iamVjdHNEYXRhUm93PjtcblxuICAgIFNFUEFSQVRPUiA9ICcsJztcbiAgICBpc0FsbFNlbGVjdGVkID0gZmFsc2U7XG4gICAgc2VsZWN0ZWRJdGVtcyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG4gICAgdW5TZWxlY3RlZEl0ZW1zID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcblxuICAgIHByaXZhdGUgY3VycmVudFR3ZWVuOiBhbnk7XG5cbiAgICBzZWxlY3RlZEl0ZW1JZCA9ICcnO1xuICAgIGhvdmVyZWRJdGVtSWQgPSAnJztcblxuICAgIHByaXZhdGUgY29udGFpbmVyV2lkdGggPSAwO1xuICAgIHByaXZhdGUgdGFibGVTY3JvbGxXaWR0aCA9IDA7XG5cbiAgICBwcml2YXRlIF9sb2FkaW5nSXRlbXNGcm9tQXBpID0gZmFsc2U7XG4gICAgZ2V0IGxvYWRpbmdJdGVtc0Zyb21BcGkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb2FkaW5nSXRlbXNGcm9tQXBpO1xuICAgIH1cblxuICAgIHNjcmVlblNpemU6IFBlcFNjcmVlblNpemVUeXBlO1xuICAgIGRldmljZUhhc01vdXNlID0gZmFsc2U7XG5cbiAgICAvLyBGb3IgcmVzaXplXG4gICAgcHJlc3NlZENvbHVtbiA9ICcnO1xuICAgIHN0YXJ0WCA9IDA7XG4gICAgc3RhcnRXaWR0aCA9IDA7XG4gICAgdGFibGVTdGFydFdpZHRoID0gMDtcblxuICAgIC8vIEZvciBzb3J0aW5nXG4gICAgaXNBc2MgPSB0cnVlO1xuICAgIHNvcnRCeSA9ICcnO1xuICAgIGlzVXNlclNlbGVjdGVkID0gZmFsc2U7XG4gICAgY2hlY2tGb3JDaGFuZ2VzOiBhbnkgPSBudWxsO1xuICAgIGNhbGN1bGF0ZWRPYmplY3RIZWlnaHQ6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGhvc3RFbGVtZW50OiBFbGVtZW50UmVmLFxuICAgICAgICBwcml2YXRlIGxheW91dFNlcnZpY2U6IFBlcExheW91dFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgc2Vzc2lvblNlcnZpY2U6IFBlcFNlc3Npb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgICAgICBwcml2YXRlIHpvbmU6IE5nWm9uZVxuICAgICkge1xuICAgICAgICAvLyB0aGlzLm5hdGl2ZVdpbmRvdyA9IHdpbmRvdztcbiAgICAgICAgdGhpcy5sYXlvdXRTZXJ2aWNlLm9uUmVzaXplJC5zdWJzY3JpYmUoKHNpemU6IFBlcFNjcmVlblNpemVUeXBlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNjcmVlblNpemUgPSBzaXplO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmxheW91dFNlcnZpY2Uub25Nb3VzZU92ZXIkLnN1YnNjcmliZSgoZGV2aWNlSGFzTW91c2U6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGV2aWNlSGFzTW91c2UgPSBkZXZpY2VIYXNNb3VzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyV2lkdGggPSAwO1xuICAgICAgICB0aGlzLmRldmljZUhhc01vdXNlID0gdGhpcy5sYXlvdXRTZXJ2aWNlLmdldERldmljZUhhc01vdXNlKCk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcyk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5jb250YWluZXJXaWR0aCA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnNldENvbnRhaW5lcldpZHRoKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgLy8gaWYgKHRoaXMudmFsdWVDaGFuZ2UpIHtcbiAgICAgICAgLy8gICAgIHRoaXMudmFsdWVDaGFuZ2UudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIC8vIGlmICh0aGlzLmxvYWRJdGVtcykge1xuICAgICAgICAvLyAgICAgdGhpcy5sb2FkSXRlbXMudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIC8vIGlmICh0aGlzLmxvYWRQYWdlKSB7XG4gICAgICAgIC8vICAgICB0aGlzLmxvYWRQYWdlLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIC8vIH1cblxuICAgICAgICAvLyBpZiAodGhpcy5zb3J0aW5nQ2hhbmdlKSB7XG4gICAgICAgIC8vICAgICB0aGlzLnNvcnRpbmdDaGFuZ2UudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIC8vIGlmICh0aGlzLmZpZWxkQ2xpY2spIHtcbiAgICAgICAgLy8gICAgIHRoaXMuZmllbGRDbGljay51bnN1YnNjcmliZSgpO1xuICAgICAgICAvLyB9XG5cbiAgICAgICAgLy8gaWYgKHRoaXMuaXRlbUNsaWNrKSB7XG4gICAgICAgIC8vICAgICB0aGlzLml0ZW1DbGljay51bnN1YnNjcmliZSgpO1xuICAgICAgICAvLyB9XG5cbiAgICAgICAgLy8gaWYgKHRoaXMubGlzdExvYWQpIHtcbiAgICAgICAgLy8gICAgIHRoaXMubGlzdExvYWQudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIHRoaXMuc2F2ZVNvcnRpbmdUb1Nlc3Npb24oKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFNjcm9sbGluZ0VsZW1lbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudFNjcm9sbCA/IHRoaXMucGFyZW50U2Nyb2xsIDogdGhpcy52aXJ0dWFsU2Nyb2xsZXI/LmNvbnRlbnRFbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNjcm9sbFRvVG9wKGFuaW1hdGUgPSB0cnVlKSB7XG4gICAgICAgIGNvbnN0IHNjcm9sbGluZ0VsZW1lbnQgPSB0aGlzLmdldFNjcm9sbGluZ0VsZW1lbnQoKTtcbiAgICAgICAgaWYgKHNjcm9sbGluZ0VsZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9IDA7XG5cbiAgICAgICAgICAgIC8vIHRvdGFsbHkgZGlzYWJsZSBhbmltYXRlXG4gICAgICAgICAgICBpZiAoIWFuaW1hdGUgfHwgdGhpcy5zY3JvbGxBbmltYXRpb25UaW1lID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjcm9sbGluZ0VsZW1lbnQgaW5zdGFuY2VvZiBXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHNjcm9sbFRvcCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsaW5nRWxlbWVudC5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgYW5pbWF0aW9uUmVxdWVzdDtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1dpbmRvdyA9IHNjcm9sbGluZ0VsZW1lbnQgaW5zdGFuY2VvZiBXaW5kb3c7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFNjcm9sbFRvcCA9XG4gICAgICAgICAgICAgICAgICAgIHNjcm9sbGluZ0VsZW1lbnQgaW5zdGFuY2VvZiBXaW5kb3dcbiAgICAgICAgICAgICAgICAgICAgICAgID8gd2luZG93LnBhZ2VZT2Zmc2V0XG4gICAgICAgICAgICAgICAgICAgICAgICA6IHNjcm9sbGluZ0VsZW1lbnQuc2Nyb2xsVG9wO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudFR3ZWVuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VHdlZW4uc3RvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRUd2VlbiA9IG5ldyB0d2Vlbi5Ud2Vlbih7IHNjcm9sbFRvcDogY3VycmVudFNjcm9sbFRvcCB9KVxuICAgICAgICAgICAgICAgICAgICAudG8oeyBzY3JvbGxUb3AgfSwgdGhpcy5zY3JvbGxBbmltYXRpb25UaW1lKVxuICAgICAgICAgICAgICAgICAgICAuZWFzaW5nKHR3ZWVuLkVhc2luZy5RdWFkcmF0aWMuT3V0KVxuICAgICAgICAgICAgICAgICAgICAub25VcGRhdGUoKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihkYXRhLnNjcm9sbFRvcCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1dpbmRvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBkYXRhLnNjcm9sbFRvcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGluZ0VsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzY3JvbGxUb3AnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNjcm9sbFRvcFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5vblN0b3AoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uUmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5zdGFydCgpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYW5pbWF0ZSA9ICh0aW1lPykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRUd2Vlbi51cGRhdGUodGltZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRUd2Vlbi5fb2JqZWN0LnNjcm9sbFRvcCAhPT0gc2Nyb2xsVG9wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvblJlcXVlc3QgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBhbmltYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldENvbnRhaW5lcldpZHRoKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25DaGVja0JveFdpZHRoID1cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uVHlwZUZvckFjdGlvbnMgPT09ICdtdWx0aScgPyA0NCA6IDA7XG5cbiAgICAgICAgY29uc3Qgcm93SGVpZ2h0ID0gNDA7IC8vIHRoZSB0YWJsZSByb3cgaGVpZ2h0ICgyLjVyZW0gKiAxNmZvbnQtc2l6ZSkuXG4gICAgICAgIGNvbnN0IHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoXG4gICAgICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudFxuICAgICAgICApO1xuICAgICAgICAvLyBUaGUgY29udGFpbmVyLWZsdWlkIGNsYXNzIHBhZGRpbmcgbGVmdCArIHJpZ2h0ICsgYm9yZGVyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lckZsdWlkU3BhY2luZyA9XG4gICAgICAgICAgICBwYXJzZUludChzdHlsZS5wYWRkaW5nTGVmdCwgMTApICsgcGFyc2VJbnQoc3R5bGUucGFkZGluZ1JpZ2h0LCAxMCk7XG5cbiAgICAgICAgY29uc3QgcGFyZW50Q29udGFpbmVyID1cbiAgICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQgPiAwXG4gICAgICAgICAgICAgICAgPyB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50XG4gICAgICAgICAgICAgICAgOiB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudDtcblxuICAgICAgICAvLyBDYWxjdWxhdGUgaWYgdmVydGljYWwgc2Nyb2xsIHNob3VsZCBhcHBlYXIsIGlmIHNvIHNldCB0aGUgc2Nyb2xsIHdpZHRoLiAodGhpcy50b3RhbFJvd3MgKyAxKSArIDEgaXMgZm9yIHRoZSBoZWFkZXIgcm93LlxuICAgICAgICB0aGlzLnRhYmxlU2Nyb2xsV2lkdGggPSBwYXJlbnRDb250YWluZXIuY2xpZW50SGVpZ2h0IDwgcm93SGVpZ2h0ICogKHRoaXMudG90YWxSb3dzICsgMSlcbiAgICAgICAgICAgID8gdGhpcy5sYXlvdXRTZXJ2aWNlLmdldFNjcm9sbGJhcldpZHRoKClcbiAgICAgICAgICAgIDogMDtcblxuICAgICAgICAvLyBUaGUgc2VsZWN0aW9uQ2hlY2tCb3hXaWR0aCB3aWR0aCArIGNvbnRhaW5lckZsdWlkU3BhY2luZyArIHRoaXMudGFibGVTY3JvbGxXaWR0aC5cbiAgICAgICAgY29uc3Qgcm93SGVhZGVyV2lkdGhUb1N1YiA9XG4gICAgICAgICAgICBjb250YWluZXJGbHVpZFNwYWNpbmcgKyBzZWxlY3Rpb25DaGVja0JveFdpZHRoICsgdGhpcy50YWJsZVNjcm9sbFdpZHRoO1xuICAgICAgICB0aGlzLmNvbnRhaW5lcldpZHRoID0gcGFyZW50Q29udGFpbmVyLm9mZnNldFdpZHRoIC0gcm93SGVhZGVyV2lkdGhUb1N1YjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNhdmVTb3J0aW5nVG9TZXNzaW9uKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNlc3Npb25TZXJ2aWNlLnNldE9iamVjdChcbiAgICAgICAgICAgIFBlcExpc3RDb21wb25lbnQuU09SVF9CWV9TVEFURV9LRVksXG4gICAgICAgICAgICB0aGlzLnNvcnRCeVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnNlc3Npb25TZXJ2aWNlLnNldE9iamVjdChcbiAgICAgICAgICAgIFBlcExpc3RDb21wb25lbnQuQVNDRU5ESU5HX1NUQVRFX0tFWSxcbiAgICAgICAgICAgIHRoaXMuaXNBc2NcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFRvcEl0ZW1zKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzVGFibGVcbiAgICAgICAgICAgID8gUGVwTGlzdENvbXBvbmVudC5UT1BfSVRFTVNfVEFCTEVcbiAgICAgICAgICAgIDogUGVwTGlzdENvbXBvbmVudC5UT1BfSVRFTVNfVEhVTUJOQUlMUztcbiAgICB9XG5cbiAgICAvLyBwcml2YXRlIGRpc2FibGVTY3JvbGwoZGlzYWJsZTogYm9vbGVhbikge1xuICAgIC8vICAgICBpZiAoZGlzYWJsZSkge1xuICAgIC8vICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmdldFBhcmVudENvbnRhaW5lcigpLCAnbG9jay1ldmVudHMnKTtcbiAgICAvLyAgICAgfSBlbHNlIHtcbiAgICAvLyAgICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5nZXRQYXJlbnRDb250YWluZXIoKSwgJ2xvY2stZXZlbnRzJyk7XG4gICAgLy8gICAgIH1cbiAgICAvLyB9XG5cbiAgICBwcml2YXRlIHRvZ2dsZUxvYWRpbmdJdGVtc0Zyb3BBcGkobG9hZGluZ0l0ZW1zRnJvbUFwaTogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICB0aGlzLl9sb2FkaW5nSXRlbXNGcm9tQXBpID0gbG9hZGluZ0l0ZW1zRnJvbUFwaTtcblxuICAgICAgICAvLyB0aGlzLmRpc2FibGVTY3JvbGwobG9hZGluZ0l0ZW1zRnJvbUFwaSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVDdXJyZW50UGFnZUl0ZW1zKHN0YXJ0SW5kZXg6IG51bWJlciwgZW5kSW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLmN1cnJlbnRQYWdlSXRlbXMgPSB0aGlzLml0ZW1zLnNsaWNlKHN0YXJ0SW5kZXgsIGVuZEluZGV4KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFNlbGVjdGlvbkl0ZW1zKFxuICAgICAgICBpdGVtSWQ6IHN0cmluZyxcbiAgICAgICAgdW5pcUl0ZW1JZDogc3RyaW5nLFxuICAgICAgICBpc0NoZWNrZWQ6IGJvb2xlYW5cbiAgICApOiB2b2lkIHtcbiAgICAgICAgLy8gU2V0IHNlbGVjdGVkIGl0ZW0gY2hlY2tib3hcbiAgICAgICAgaWYgKHRoaXMuaXNBbGxTZWxlY3RlZCkge1xuICAgICAgICAgICAgaWYgKGlzQ2hlY2tlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudW5TZWxlY3RlZEl0ZW1zLmRlbGV0ZShpdGVtSWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5zZXQoaXRlbUlkLCB1bmlxSXRlbUlkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLmRlbGV0ZShpdGVtSWQpO1xuICAgICAgICAgICAgICAgIHRoaXMudW5TZWxlY3RlZEl0ZW1zLnNldChpdGVtSWQsIHVuaXFJdGVtSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGlzQ2hlY2tlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudW5TZWxlY3RlZEl0ZW1zLmRlbGV0ZShpdGVtSWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5zZXQoaXRlbUlkLCB1bmlxSXRlbUlkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLmRlbGV0ZShpdGVtSWQpO1xuICAgICAgICAgICAgICAgIHRoaXMudW5TZWxlY3RlZEl0ZW1zLnNldChpdGVtSWQsIHVuaXFJdGVtSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRVbmlxSXRlbUlkKGl0ZW1JZDogc3RyaW5nLCBpdGVtVHlwZSA9ICcnKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGl0ZW1JZCArIHRoaXMuU0VQQVJBVE9SICsgaXRlbVR5cGU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRMYXlvdXQoKTogdm9pZCB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHRoaXMudG90YWxSb3dzID09PSAwIHx8XG4gICAgICAgICAgICAhdGhpcy5fbGF5b3V0IHx8XG4gICAgICAgICAgICAhdGhpcy5fbGF5b3V0LkNvbnRyb2xGaWVsZHMgfHxcbiAgICAgICAgICAgIHRoaXMuX2xheW91dC5Db250cm9sRmllbGRzLmxlbmd0aCA9PT0gMFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2xheW91dC5Db250cm9sRmllbGRzLmZvckVhY2goKGNmKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2YuQ29sdW1uV2lkdGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjZi5Db2x1bW5XaWR0aCA9IDEwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgdGhpcy5pc1RhYmxlICYmXG4gICAgICAgICAgICAgICAgKGNmLkZpZWxkVHlwZSA9PT0gRklFTERfVFlQRS5JbWFnZSB8fFxuICAgICAgICAgICAgICAgICAgICAvLyBjZi5GaWVsZFR5cGUgPT09IEZJRUxEX1RZUEUuSW5kaWNhdG9ycyB8fCA/Pz9cbiAgICAgICAgICAgICAgICAgICAgY2YuRmllbGRUeXBlID09PSBGSUVMRF9UWVBFLlNpZ25hdHVyZSB8fFxuICAgICAgICAgICAgICAgICAgICBjZi5GaWVsZFR5cGUgPT09IEZJRUxEX1RZUEUuTnVtYmVySW50ZWdlclF1YW50aXR5U2VsZWN0b3IgfHxcbiAgICAgICAgICAgICAgICAgICAgY2YuRmllbGRUeXBlID09PSBGSUVMRF9UWVBFLk51bWJlclJlYWxRdWFudGl0eVNlbGVjdG9yIHx8XG4gICAgICAgICAgICAgICAgICAgIGNmLkZpZWxkVHlwZSA9PT0gRklFTERfVFlQRS5OdW1iZXJJbnRlZ2VyRm9yTWF0cml4IHx8XG4gICAgICAgICAgICAgICAgICAgIGNmLkZpZWxkVHlwZSA9PT0gRklFTERfVFlQRS5OdW1iZXJSZWFsRm9yTWF0cml4IHx8XG4gICAgICAgICAgICAgICAgICAgIGNmLkZpZWxkVHlwZSA9PT0gRklFTERfVFlQRS5QYWNrYWdlIHx8XG4gICAgICAgICAgICAgICAgICAgIGNmLkFwaU5hbWUgPT09ICdVbml0c1F1YW50aXR5JyB8fFxuICAgICAgICAgICAgICAgICAgICBjZi5BcGlOYW1lID09PSAnUXVhbnRpdHlTZWxlY3RvcicpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBjZi5MYXlvdXQuWEFsaWdubWVudCA9IDM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghdGhpcy5jZFsnZGVzdHJveWVkJ10pIHtcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IHRoZSBjb2x1bW5zIHdpZHRoLlxuICAgICAgICBpZiAodGhpcy5jb250YWluZXJXaWR0aCA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnNldENvbnRhaW5lcldpZHRoKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNhbGNDb2x1bW5zV2lkdGgoKTtcbiAgICAgICAgdGhpcy5jaGVja0ZvckNoYW5nZXMgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGNDb2x1bW5zV2lkdGgoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGZpeGVkTXVsdGlwbGUgPSAzLjc4OyAvLyBmb3IgY29udmVydGluZyBlbSB0byBwaXhlbC5cbiAgICAgICAgY29uc3QgbGVuZ3RoID0gdGhpcy5fbGF5b3V0LkNvbnRyb2xGaWVsZHMubGVuZ3RoO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25DaGVja0JveFdpZHRoID1cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uVHlwZUZvckFjdGlvbnMgPT09ICdtdWx0aScgPyA0NCA6IDA7XG5cbiAgICAgICAgLy8gSXMgdGFibGUgQU5EIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSBjb2x1bW4gb2Ygd2lkdGggdHlwZSBvZiBwZXJjZW50YWdlLlxuICAgICAgICBpZiAodGhpcy5pc1RhYmxlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fbGF5b3V0ICYmIHRoaXMuX2xheW91dC5Db250cm9sRmllbGRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYXNDb2x1bW5XaWR0aE9mVHlwZVBlcmNlbnRhZ2UgPVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXlvdXQuQ29udHJvbEZpZWxkcy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAoY2YpID0+IGNmLkNvbHVtbldpZHRoVHlwZSA9PT0gMVxuICAgICAgICAgICAgICAgICAgICApLmxlbmd0aCA9PT0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIHRoZSBjb2x1bW5zIHNpemUgaXMgZml4ZWQgYW5kIHRoZSB0b3RhbCBpcyBzbWFsbCB0aGVuIHRoZSBjb250YWluZXIgY2hhbmdlIGl0IHRvIHBlcmNlbnRhZ2UuXG4gICAgICAgIGlmICghdGhpcy5oYXNDb2x1bW5XaWR0aE9mVHlwZVBlcmNlbnRhZ2UpIHtcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsRml4ZWRDb2xzV2lkdGggPSB0aGlzLl9sYXlvdXQuQ29udHJvbEZpZWxkcy5tYXAoXG4gICAgICAgICAgICAgICAgKGNmKSA9PiBjZi5Db2x1bW5XaWR0aCAqIGZpeGVkTXVsdGlwbGVcbiAgICAgICAgICAgICkucmVkdWNlKChzdW0sIGN1cnJlbnQpID0+IHN1bSArIGN1cnJlbnQpO1xuXG4gICAgICAgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggPiB0b3RhbEZpeGVkQ29sc1dpZHRoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYXNDb2x1bW5XaWR0aE9mVHlwZVBlcmNlbnRhZ2UgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRvdGFsQ2FsY0NvbHNXaWR0aCA9IDA7XG5cbiAgICAgICAgLy8gQ2FsYyBieSBwZXJjZW50YWdlXG4gICAgICAgIGlmICh0aGlzLmhhc0NvbHVtbldpZHRoT2ZUeXBlUGVyY2VudGFnZSkge1xuICAgICAgICAgICAgY29uc3QgdG90YWxDb2xzV2lkdGg6IG51bWJlciA9IHRoaXMuX2xheW91dC5Db250cm9sRmllbGRzLm1hcChcbiAgICAgICAgICAgICAgICAoY2YpID0+IGNmLkNvbHVtbldpZHRoXG4gICAgICAgICAgICApLnJlZHVjZSgoc3VtLCBjdXJyZW50KSA9PiBzdW0gKyBjdXJyZW50KTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVpQ29udHJvbEZpZWxkOiBVSUNvbnRyb2xGaWVsZCA9IHRoaXMuX2xheW91dC5Db250cm9sRmllbGRzW2luZGV4XTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYWxjQ29sdW1uV2lkdGhQZXJjZW50YWdlID0gKDEwMCAvIHRvdGFsQ29sc1dpZHRoKSAqIHVpQ29udHJvbEZpZWxkLkNvbHVtbldpZHRoO1xuXG4gICAgICAgICAgICAgICAgdWlDb250cm9sRmllbGQuY2FsY0NvbHVtbldpZHRoID0gTWF0aC5mbG9vcigodGhpcy5jb250YWluZXJXaWR0aCAqIGNhbGNDb2x1bW5XaWR0aFBlcmNlbnRhZ2UpIC8gMTAwKTtcblxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gbGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICB1aUNvbnRyb2xGaWVsZC5jYWxjVGl0bGVDb2x1bW5XaWR0aFN0cmluZyA9IHVpQ29udHJvbEZpZWxkLmNhbGNDb2x1bW5XaWR0aFN0cmluZyA9ICdjYWxjKDEwMCUgLSAnICsgdG90YWxDYWxjQ29sc1dpZHRoICsgJ3B4KSc7IC8vIEZvciAxMDAlXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdWlDb250cm9sRmllbGQuY2FsY1RpdGxlQ29sdW1uV2lkdGhTdHJpbmcgPSB1aUNvbnRyb2xGaWVsZC5jYWxjQ29sdW1uV2lkdGhTdHJpbmcgPSB1aUNvbnRyb2xGaWVsZC5jYWxjQ29sdW1uV2lkdGggKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICB0b3RhbENhbGNDb2xzV2lkdGggKz0gdWlDb250cm9sRmllbGQuY2FsY0NvbHVtbldpZHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShcbiAgICAgICAgICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQsXG4gICAgICAgICAgICAgICAgJ3dpZHRoJyxcbiAgICAgICAgICAgICAgICAnaW5oZXJpdCdcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdWlDb250cm9sRmllbGQ6IFVJQ29udHJvbEZpZWxkID0gdGhpcy5fbGF5b3V0XG4gICAgICAgICAgICAgICAgICAgIC5Db250cm9sRmllbGRzW2luZGV4XTtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50Rml4ZWRXaWR0aCA9IE1hdGguZmxvb3IoXG4gICAgICAgICAgICAgICAgICAgIHVpQ29udHJvbEZpZWxkLkNvbHVtbldpZHRoICogZml4ZWRNdWx0aXBsZVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IGxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdWlDb250cm9sRmllbGQuY2FsY1RpdGxlQ29sdW1uV2lkdGhTdHJpbmcgPSBjdXJyZW50Rml4ZWRXaWR0aCArICdweCc7XG4gICAgICAgICAgICAgICAgICAgIHVpQ29udHJvbEZpZWxkLmNhbGNDb2x1bW5XaWR0aFN0cmluZyA9IGN1cnJlbnRGaXhlZFdpZHRoICsgJ3B4JztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB1aUNvbnRyb2xGaWVsZC5jYWxjVGl0bGVDb2x1bW5XaWR0aFN0cmluZyA9IHVpQ29udHJvbEZpZWxkLmNhbGNDb2x1bW5XaWR0aFN0cmluZyA9IGN1cnJlbnRGaXhlZFdpZHRoICsgJ3B4JztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0b3RhbENhbGNDb2xzV2lkdGggKz0gY3VycmVudEZpeGVkV2lkdGg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoXG4gICAgICAgICAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LFxuICAgICAgICAgICAgICAgICd3aWR0aCcsXG4gICAgICAgICAgICAgICAgdG90YWxDYWxjQ29sc1dpZHRoICsgc2VsZWN0aW9uQ2hlY2tCb3hXaWR0aCArICdweCdcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRSZXNpemVEYXRhKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXJ0WCA9IDA7XG4gICAgICAgIHRoaXMuc3RhcnRXaWR0aCA9IDA7XG4gICAgICAgIHRoaXMudGFibGVTdGFydFdpZHRoID0gMDtcbiAgICAgICAgdGhpcy5wcmVzc2VkQ29sdW1uID0gJyc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQYXJlbnQoZWwsIHBhcmVudFNlbGVjdG9yKTogYW55IHtcbiAgICAgICAgLy8gSWYgbm8gcGFyZW50U2VsZWN0b3IgZGVmaW5lZCB3aWxsIGJ1YmJsZSB1cCBhbGwgdGhlIHdheSB0byAqZG9jdW1lbnQqXG4gICAgICAgIGlmIChwYXJlbnRTZWxlY3RvciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBwYXJlbnRTZWxlY3RvciA9IGRvY3VtZW50O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IFtdO1xuICAgICAgICBsZXQgcCA9IGVsLnBhcmVudE5vZGU7XG5cbiAgICAgICAgd2hpbGUgKFxuICAgICAgICAgICAgcCAmJlxuICAgICAgICAgICAgcC5jbGFzc05hbWUgIT09ICcnICYmXG4gICAgICAgICAgICBwLmNsYXNzTmFtZS5pbmRleE9mKHBhcmVudFNlbGVjdG9yKSA9PT0gLTEgJiZcbiAgICAgICAgICAgIHBhcmVudFNlbGVjdG9yICE9PSBkb2N1bWVudFxuICAgICAgICApIHtcbiAgICAgICAgICAgIGNvbnN0IG8gPSBwO1xuICAgICAgICAgICAgcCA9IG8ucGFyZW50Tm9kZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocC5jbGFzc05hbWUuaW5kZXhPZihwYXJlbnRTZWxlY3RvcikgPiAtMSkge1xuICAgICAgICAgICAgcGFyZW50LnB1c2gocCk7IC8vIFB1c2ggdGhhdCBwYXJlbnRTZWxlY3RvciB5b3Ugd2FudGVkIHRvIHN0b3AgYXRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyZW50O1xuICAgIH1cblxuICAgIHByaXZhdGUgY2xlYW5JdGVtcygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pdGVtc0NvdW50ZXIgPSAwO1xuICAgICAgICB0aGlzLl9pdGVtcyA9XG4gICAgICAgICAgICB0aGlzLnRvdGFsUm93cyA+IDAgPyBBcnJheTxPYmplY3RzRGF0YVJvdz4odGhpcy50b3RhbFJvd3MpIDogW107XG4gICAgICAgIHRoaXMuY3VycmVudFBhZ2VJdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZWRPYmplY3RIZWlnaHQgPSAnJztcbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRWYXJpYWJsZXNGcm9tU2Vzc2lvbihpdGVtczogT2JqZWN0c0RhdGFSb3dbXSk6IHZvaWQge1xuICAgICAgICBjb25zdCBzZWxlY3RlZEl0ZW1zT2JqZWN0OiBBcnJheTxhbnk+ID0gdGhpcy5zZXNzaW9uU2VydmljZS5nZXRPYmplY3Q8XG4gICAgICAgICAgICBBcnJheTxhbnk+XG4gICAgICAgID4oUGVwTGlzdENvbXBvbmVudC5TRUxFQ1RFRF9JVEVNU19TVEFURV9LRVkpO1xuICAgICAgICBjb25zdCBzZWxlY3RlZEl0ZW1zRnJvbU1hcDogTWFwPHN0cmluZywgc3RyaW5nPiA9XG4gICAgICAgICAgICBzZWxlY3RlZEl0ZW1zT2JqZWN0ICYmIHNlbGVjdGVkSXRlbXNPYmplY3QubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgID8gbmV3IE1hcChzZWxlY3RlZEl0ZW1zT2JqZWN0KVxuICAgICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtc0Zyb21NYXAgIT0gbnVsbCAmJlxuICAgICAgICAgICAgdHlwZW9mIHNlbGVjdGVkSXRlbXNGcm9tTWFwLnNpemUgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgICAgICBzZWxlY3RlZEl0ZW1zRnJvbU1hcC5zaXplID4gMFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IHNlbGVjdGVkSXRlbXNGcm9tTWFwO1xuICAgICAgICAgICAgdGhpcy5zZXNzaW9uU2VydmljZS5yZW1vdmVPYmplY3QoXG4gICAgICAgICAgICAgICAgUGVwTGlzdENvbXBvbmVudC5TRUxFQ1RFRF9JVEVNU19TVEFURV9LRVlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMuY2xlYXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVuU2VsZWN0ZWRJdGVtc09iamVjdDogQXJyYXk8YW55PiA9IHRoaXMuc2Vzc2lvblNlcnZpY2UuZ2V0T2JqZWN0PFxuICAgICAgICAgICAgQXJyYXk8YW55PlxuICAgICAgICA+KFBlcExpc3RDb21wb25lbnQuVU5fU0VMRUNURURfSVRFTVNfU1RBVEVfS0VZKTtcbiAgICAgICAgY29uc3QgdW5TZWxlY3RlZEl0ZW1zTWFwOiBNYXA8c3RyaW5nLCBzdHJpbmc+ID1cbiAgICAgICAgICAgIHVuU2VsZWN0ZWRJdGVtc09iamVjdCAmJiB1blNlbGVjdGVkSXRlbXNPYmplY3QubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgID8gbmV3IE1hcCh1blNlbGVjdGVkSXRlbXNPYmplY3QpXG4gICAgICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICB1blNlbGVjdGVkSXRlbXNNYXAgIT0gbnVsbCAmJlxuICAgICAgICAgICAgdHlwZW9mIHVuU2VsZWN0ZWRJdGVtc01hcC5zaXplICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICAgdW5TZWxlY3RlZEl0ZW1zTWFwLnNpemUgPiAwXG4gICAgICAgICkge1xuICAgICAgICAgICAgdGhpcy51blNlbGVjdGVkSXRlbXMgPSB1blNlbGVjdGVkSXRlbXNNYXA7XG4gICAgICAgICAgICB0aGlzLnNlc3Npb25TZXJ2aWNlLnJlbW92ZU9iamVjdChcbiAgICAgICAgICAgICAgICBQZXBMaXN0Q29tcG9uZW50LlVOX1NFTEVDVEVEX0lURU1TX1NUQVRFX0tFWVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudW5TZWxlY3RlZEl0ZW1zLmNsZWFyKCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpc0FsbFNlbGVjdGVkID0gdGhpcy5zZXNzaW9uU2VydmljZS5nZXRPYmplY3QoXG4gICAgICAgICAgICBQZXBMaXN0Q29tcG9uZW50LkFMTF9TRUxFQ1RFRF9TVEFURV9LRVlcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGlzQWxsU2VsZWN0ZWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5pc0FsbFNlbGVjdGVkID0gaXNBbGxTZWxlY3RlZCAmJiB0aGlzLmdldElzQWxsU2VsZWN0ZWQoaXRlbXMpO1xuICAgICAgICAgICAgdGhpcy5zZXNzaW9uU2VydmljZS5yZW1vdmVPYmplY3QoXG4gICAgICAgICAgICAgICAgUGVwTGlzdENvbXBvbmVudC5BTExfU0VMRUNURURfU1RBVEVfS0VZXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc0FsbFNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzb3J0QnkgPSB0aGlzLnNlc3Npb25TZXJ2aWNlLmdldE9iamVjdChcbiAgICAgICAgICAgIFBlcExpc3RDb21wb25lbnQuU09SVF9CWV9TVEFURV9LRVlcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHNvcnRCeSAmJiBzb3J0QnkgIT09ICcnKSB7XG4gICAgICAgICAgICB0aGlzLnNvcnRCeSA9IHNvcnRCeTtcbiAgICAgICAgICAgIHRoaXMuc2Vzc2lvblNlcnZpY2UucmVtb3ZlT2JqZWN0KFxuICAgICAgICAgICAgICAgIFBlcExpc3RDb21wb25lbnQuU09SVF9CWV9TVEFURV9LRVlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNvcnRCeSA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNBc2MgPSB0aGlzLnNlc3Npb25TZXJ2aWNlLmdldE9iamVjdChcbiAgICAgICAgICAgIFBlcExpc3RDb21wb25lbnQuQVNDRU5ESU5HX1NUQVRFX0tFWVxuICAgICAgICApO1xuICAgICAgICBpZiAoaXNBc2MgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5pc0FzYyA9IGlzQXNjO1xuICAgICAgICAgICAgdGhpcy5zZXNzaW9uU2VydmljZS5yZW1vdmVPYmplY3QoXG4gICAgICAgICAgICAgICAgUGVwTGlzdENvbXBvbmVudC5BU0NFTkRJTkdfU1RBVEVfS0VZXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc0FzYyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldElzQWxsU2VsZWN0ZWQoaXRlbXM6IEFycmF5PE9iamVjdHNEYXRhUm93Pik6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgcmVzdWx0ID0gdHJ1ZTtcblxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEl0ZW1zPy5zaXplID4gMCAmJiBpdGVtcz8ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoaXRlbSAmJiB0aGlzLnNlbGVjdGVkSXRlbXMuaGFzKGl0ZW0/LlVJRC50b1N0cmluZygpKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldE51bWJlck9mU3RhcnRJdGVtcygpOiBudW1iZXIge1xuICAgICAgICBsZXQgbnVtYmVyT2ZTdGFydEl0ZW1zID0gMjA7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhpcy5zY3JlZW5TaXplID09PSBQZXBTY3JlZW5TaXplVHlwZS5YTCB8fFxuICAgICAgICAgICAgdGhpcy5zY3JlZW5TaXplID09PSBQZXBTY3JlZW5TaXplVHlwZS5MR1xuICAgICAgICApIHtcbiAgICAgICAgICAgIG51bWJlck9mU3RhcnRJdGVtcyA9IHRoaXMuaXNUYWJsZSA/IDUwIDogNDA7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zY3JlZW5TaXplID09PSBQZXBTY3JlZW5TaXplVHlwZS5NRCkge1xuICAgICAgICAgICAgbnVtYmVyT2ZTdGFydEl0ZW1zID0gdGhpcy5pc1RhYmxlID8gMzAgOiAyMDtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNjcmVlblNpemUgPT09IFBlcFNjcmVlblNpemVUeXBlLlNNKSB7XG4gICAgICAgICAgICBudW1iZXJPZlN0YXJ0SXRlbXMgPSB0aGlzLmlzVGFibGUgPyAyMCA6IDEwO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2NyZWVuU2l6ZSA9PT0gUGVwU2NyZWVuU2l6ZVR5cGUuWFMpIHtcbiAgICAgICAgICAgIG51bWJlck9mU3RhcnRJdGVtcyA9IHRoaXMuaXNUYWJsZSA/IDE1IDogNTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudW1iZXJPZlN0YXJ0SXRlbXM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRJdGVtQ2xpY2tlZChcbiAgICAgICAgaXRlbUlkLFxuICAgICAgICBpc1NlbGVjdGFibGVGb3JBY3Rpb25zOiBib29sZWFuLFxuICAgICAgICBpdGVtVHlwZTogc3RyaW5nLFxuICAgICAgICBpc0NoZWNrZWQ6IGJvb2xlYW5cbiAgICApOiB2b2lkIHtcbiAgICAgICAgY29uc3QgdW5pcUl0ZW1JZCA9IHRoaXMuZ2V0VW5pcUl0ZW1JZChpdGVtSWQsIGl0ZW1UeXBlKTtcblxuICAgICAgICAvLyBzZWxlY3QgdGhlIHNlbGVjdGVkIGl0ZW0uXG4gICAgICAgIGlmIChpc0NoZWNrZWQpIHtcbiAgICAgICAgICAgIC8vIFNldCBzZWxldGVkIGl0ZW1cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtSWQgPSB1bmlxSXRlbUlkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtSWQgPT09IHVuaXFJdGVtSWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbUlkID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25UeXBlRm9yQWN0aW9ucyA9PT0gJ3NpbmdsZScpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtc0NoYW5nZS5lbWl0KFxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtSWQubGVuZ3RoID09PSAwID8gMCA6IDFcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWxlY3Rpb25UeXBlRm9yQWN0aW9ucyA9PT0gJ211bHRpJykge1xuICAgICAgICAgICAgaWYgKGlzU2VsZWN0YWJsZUZvckFjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFNlbGVjdGlvbkl0ZW1zKGl0ZW1JZCwgdW5pcUl0ZW1JZCwgaXNDaGVja2VkKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ID0gdGhpcy5pc0FsbFNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICAgID8gdGhpcy51blNlbGVjdGVkSXRlbXNcbiAgICAgICAgICAgICAgICAgICAgOiB0aGlzLnNlbGVjdGVkSXRlbXM7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudExpc3RDb3VudCA9IHRoaXMuaXNBbGxTZWxlY3RlZFxuICAgICAgICAgICAgICAgICAgICA/IHRoaXMudG90YWxSb3dzIC0gY3VycmVudExpc3Quc2l6ZVxuICAgICAgICAgICAgICAgICAgICA6IGN1cnJlbnRMaXN0LnNpemU7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zQ2hhbmdlLmVtaXQoY3VycmVudExpc3RDb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSYWlzZSBzZWxlY3RlZCBpdGVtIGNoYW5nZSBldmVudFxuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25UeXBlRm9yQWN0aW9ucyAhPT0gJ25vbmUnKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbUNoYW5nZS5lbWl0KHtcbiAgICAgICAgICAgICAgICBpZDogaXRlbUlkLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBpc0NoZWNrZWQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZXhwb3J0RnVuY3Rpb25zT25Ib3N0RWxlbWVudCgpIHtcbiAgICAgICAgLy8gVGhpcyBpcyBmb3Igd2ViIGNvbXBvbmVudCB1c2FnZSBmb3IgdXNlIHRob3NlIGZ1bmN0aW9ucy5cbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LmNsZWFyID0gdGhpcy5jbGVhci5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuaW5pdExpc3REYXRhID0gdGhpcy5pbml0TGlzdERhdGEuYmluZChcbiAgICAgICAgICAgIHRoaXNcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnVwZGF0ZUl0ZW1zID0gdGhpcy51cGRhdGVJdGVtcy5iaW5kKFxuICAgICAgICAgICAgdGhpc1xuICAgICAgICApO1xuICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudXBkYXRlUGFnZSA9IHRoaXMudXBkYXRlUGFnZS5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudXBkYXRlSXRlbSA9IHRoaXMudXBkYXRlSXRlbS5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIC8vIGdldElzRGlzYWJsZWQoaXRlbTogT2JqZWN0c0RhdGFSb3cpOiBib29sZWFuIHtcbiAgICAvLyAgICAgcmV0dXJuIChcbiAgICAvLyAgICAgICAgIHRoaXMubG9ja0l0ZW1Jbm5lckV2ZW50cyB8fCAoaXRlbSAmJiAhaXRlbS5Jc1NlbGVjdGFibGVGb3JBY3Rpb25zKVxuICAgIC8vICAgICApO1xuICAgIC8vIH1cblxuICAgIGdldElzQWxsU2VsZWN0ZWRGb3JBY3Rpb25zKCk6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgcmVzID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNBbGxTZWxlY3RlZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudW5TZWxlY3RlZEl0ZW1zLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMudmlydHVhbFNjcm9sbGVyPy52aWV3UG9ydEl0ZW1zKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcy5zaXplID09PSB0aGlzLnRvdGFsUm93cykge1xuICAgICAgICAgICAgICAgICAgICByZXMgPSB0aGlzLmdldElzQWxsU2VsZWN0ZWQodGhpcy52aXJ0dWFsU2Nyb2xsZXIudmlld1BvcnRJdGVtcyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMuc2l6ZSA8IHRoaXMudG90YWxSb3dzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLnZpcnR1YWxTY3JvbGxlci52aWV3UG9ydEl0ZW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gJiYgdGhpcy5zZWxlY3RlZEl0ZW1zLmhhcyhpdGVtPy5VSUQudG9TdHJpbmcoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cblxuICAgIHNldElzQWxsU2VsZWN0ZWQoaXNDaGVja2VkOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvblR5cGVGb3JBY3Rpb25zID09PSAnbXVsdGknKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdEFsbENCLmNoZWNrZWQgPSBpc0NoZWNrZWQ7XG4gICAgICAgICAgICB0aGlzLmlzQWxsU2VsZWN0ZWQgPSBpc0NoZWNrZWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZWxlY3RBbGxJdGVtc0ZvckFjdGlvbnMoZTogYW55KTogdm9pZCB7XG4gICAgICAgIC8vIEZvciBtYXRlcmlhbCBjaGVja2JveCB8fCByYWRpby5cbiAgICAgICAgY29uc3QgaXNDaGVja2VkID0gZS5zb3VyY2UuY2hlY2tlZDtcblxuICAgICAgICAvLyBJbmRldGVybWluYXRlIG1vZGVcbiAgICAgICAgbGV0IGlzSW5kZXRlcm1pbmF0ZSA9IGZhbHNlO1xuICAgICAgICBjb25zdCBjdXJyZW50TGlzdCA9IHRoaXMuaXNBbGxTZWxlY3RlZFxuICAgICAgICAgICAgPyB0aGlzLnVuU2VsZWN0ZWRJdGVtc1xuICAgICAgICAgICAgOiB0aGlzLnNlbGVjdGVkSXRlbXM7XG4gICAgICAgIGlmIChjdXJyZW50TGlzdC5zaXplID4gMCkge1xuICAgICAgICAgICAgaXNJbmRldGVybWluYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuaXNBbGxTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zQ2hhbmdlLmVtaXQoMCk7XG4gICAgICAgICAgICBlLnNvdXJjZS5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMuY2xlYXIoKTtcbiAgICAgICAgdGhpcy51blNlbGVjdGVkSXRlbXMuY2xlYXIoKTtcblxuICAgICAgICBpZiAoIWlzSW5kZXRlcm1pbmF0ZSkge1xuICAgICAgICAgICAgdGhpcy5pc0FsbFNlbGVjdGVkID0gaXNDaGVja2VkO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RBbGxDbGljay5lbWl0KGlzQ2hlY2tlZCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvblR5cGVGb3JBY3Rpb25zID09PSAnbXVsdGknKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc0NoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zQ2hhbmdlLmVtaXQoMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtSWQgPSAnJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXJlZEl0ZW1zID0gdGhpcy5pdGVtcy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAoaXRlbSkgPT4gaXRlbSAmJiBpdGVtLklzU2VsZWN0YWJsZUZvckFjdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zQ2hhbmdlLmVtaXQoZmlsdGVyZWRJdGVtcy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFJlbW92ZSBhbGxcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvblR5cGVGb3JBY3Rpb25zID09PSAnbXVsdGknKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RBbGxDbGljay5lbWl0KGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJhaXNlU3RhcnRJbmRleENoYW5nZShzdGFydEluZGV4ID0gMCkge1xuICAgICAgICAvLyB0aGlzLnN0YXJ0SW5kZXggPSBzdGFydEluZGV4O1xuICAgICAgICB0aGlzLnN0YXJ0SW5kZXhDaGFuZ2UuZW1pdCh7IHN0YXJ0SW5kZXggfSk7XG4gICAgfVxuXG4gICAgZ2V0SXNJdGVtU2VsZWN0ZWQoaXRlbTogT2JqZWN0c0RhdGFSb3cpOiBib29sZWFuIHtcbiAgICAgICAgbGV0IGlzU2VsZWN0ZWQgPSBmYWxzZTtcblxuICAgICAgICBpZiAoaXRlbSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uVHlwZUZvckFjdGlvbnMgPT09ICdzaW5nbGUnKSB7XG4gICAgICAgICAgICAgICAgaXNTZWxlY3RlZCA9IHRoaXMuc2VsZWN0ZWRJdGVtSWQgPT09IHRoaXMuZ2V0VW5pcUl0ZW1JZChpdGVtLlVJRCwgaXRlbS5UeXBlLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlbGVjdGlvblR5cGVGb3JBY3Rpb25zID09PSAnbXVsdGknKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uSXNTZWxlY3RhYmxlRm9yQWN0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBpc1NlbGVjdGVkID0gKHRoaXMuaXNBbGxTZWxlY3RlZCAmJiAhdGhpcy51blNlbGVjdGVkSXRlbXMuaGFzKGl0ZW0uVUlEKSkgfHwgdGhpcy5zZWxlY3RlZEl0ZW1zLmhhcyhpdGVtLlVJRCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGlzU2VsZWN0ZWQ7XG4gICAgfVxuXG4gICAgc2VsZWN0SXRlbUZvckFjdGlvbnMoXG4gICAgICAgIGU6IGFueSxcbiAgICAgICAgaXRlbUlkOiBzdHJpbmcsXG4gICAgICAgIGlzU2VsZWN0YWJsZUZvckFjdGlvbnM6IGJvb2xlYW4sXG4gICAgICAgIGl0ZW1UeXBlID0gJydcbiAgICApOiB2b2lkIHtcbiAgICAgICAgLy8gRm9yIG1hdGVyaWFsIGNoZWNrYm94IHx8IHJhZGlvLlxuICAgICAgICBjb25zdCBpc0NoZWNrZWQgPSBlLnNvdXJjZS5jaGVja2VkO1xuICAgICAgICB0aGlzLnNldEl0ZW1DbGlja2VkKFxuICAgICAgICAgICAgaXRlbUlkLFxuICAgICAgICAgICAgaXNTZWxlY3RhYmxlRm9yQWN0aW9ucyxcbiAgICAgICAgICAgIGl0ZW1UeXBlLFxuICAgICAgICAgICAgaXNDaGVja2VkXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgaXRlbUNsaWNrZWQoZTogYW55LCBpdGVtOiBPYmplY3RzRGF0YVJvdyk6IHZvaWQge1xuICAgICAgICAvLyBTZXQgc2VsZXRlZCBpdGVtXG4gICAgICAgIGNvbnN0IGl0ZW1JZCA9IGl0ZW0/LlVJRC50b1N0cmluZygpO1xuICAgICAgICBjb25zdCBpdGVtVHlwZSA9IGl0ZW0/LlR5cGUudG9TdHJpbmcoKTtcbiAgICAgICAgbGV0IGlzQ2hlY2tlZCA9IGZhbHNlO1xuXG4gICAgICAgIGlmIChpdGVtICYmIGl0ZW0uSXNTZWxlY3RhYmxlRm9yQWN0aW9ucykge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1JZCA9IHRoaXMuZ2V0VW5pcUl0ZW1JZChpdGVtSWQsIGl0ZW1UeXBlKTtcbiAgICAgICAgICAgIGlzQ2hlY2tlZCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc1RhYmxlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25UeXBlRm9yQWN0aW9ucyA9PT0gJ3NpbmdsZScpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEl0ZW1DbGlja2VkKFxuICAgICAgICAgICAgICAgICAgICBpdGVtSWQsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uSXNTZWxlY3RhYmxlRm9yQWN0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgaXRlbVR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGlzQ2hlY2tlZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2VsZWN0aW9uVHlwZUZvckFjdGlvbnMgPT09ICdub25lJykge1xuICAgICAgICAgICAgICAgIC8vIEp1c3QgbWFyayB0aGUgcm93IGFzIGhpZ2hsaWdodGVkXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRJdGVtQ2xpY2tlZChcbiAgICAgICAgICAgICAgICAgICAgaXRlbUlkLFxuICAgICAgICAgICAgICAgICAgICBpdGVtLklzU2VsZWN0YWJsZUZvckFjdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1UeXBlLFxuICAgICAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pdGVtQ2xpY2suZW1pdCh7IHNvdXJjZTogaXRlbSwgdmlld1R5cGU6IHRoaXMudmlld1R5cGUgfSk7XG4gICAgfVxuXG4gICAgb25UYWJsZVJvd01vdXNlRW50ZXIoZXZlbnQ6IGFueSwgaXRlbUlkOiBzdHJpbmcsIGl0ZW1UeXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLmRldmljZUhhc01vdXNlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1bmlxSXRlbUlkID0gdGhpcy5nZXRVbmlxSXRlbUlkKGl0ZW1JZCwgaXRlbVR5cGUpO1xuICAgICAgICB0aGlzLmhvdmVyZWRJdGVtSWQgPSB1bmlxSXRlbUlkO1xuICAgIH1cblxuICAgIG9uVGFibGVSb3dNb3VzZUxlYXZlKGV2ZW50OiBhbnksIGl0ZW1JZDogc3RyaW5nLCBpdGVtVHlwZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaG92ZXJlZEl0ZW1JZCA9ICcnO1xuICAgIH1cblxuICAgIG9uQ2FyZE1vdXNlRW50ZXIoZXZlbnQ6IGFueSwgaXRlbUlkOiBzdHJpbmcsIGl0ZW1UeXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLmRldmljZUhhc01vdXNlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1bmlxSXRlbUlkID0gdGhpcy5nZXRVbmlxSXRlbUlkKGl0ZW1JZCwgaXRlbVR5cGUpO1xuICAgICAgICB0aGlzLmhvdmVyZWRJdGVtSWQgPSB1bmlxSXRlbUlkO1xuICAgIH1cblxuICAgIG9uQ2FyZE1vdXNlTGVhdmUoZXZlbnQ6IGFueSwgaXRlbUlkOiBzdHJpbmcsIGl0ZW1UeXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ob3ZlcmVkSXRlbUlkID0gJyc7XG4gICAgfVxuXG4gICAgLy8gdHJhY2tCeUZ1bmMoaW5kZXg6IG51bWJlciwgaXRlbTogT2JqZWN0c0RhdGFSb3cpOiBhbnkge1xuICAgIC8vICAgICByZXR1cm4gaXRlbSAmJiBpdGVtPy5VSUQgPyBpdGVtPy5VSUQgOiBpbmRleDtcbiAgICAvLyAgICAgLy8gbGV0IHJlczogc3RyaW5nID0gXCJcIjtcblxuICAgIC8vICAgICAvLyBpZiAoaXRlbSAmJiBpdGVtPy5VSUQpIHtcbiAgICAvLyAgICAgLy8gICAgcmVzID0gaXRlbT8uVUlEICsgXCJfXCIgKyB0aGlzLmxpc3RUeXBlICsgXCJfXCIgKyAodGhpcy5pc1RhYmxlID8gXCJUYWJsZVwiIDogXCJUaHVtYm5haWxzXCIpO1xuICAgIC8vICAgICAvLyB9XG4gICAgLy8gICAgIC8vIGVsc2Uge1xuICAgIC8vICAgICAvLyAgICByZXMgPSBpbmRleCArIFwiX1wiICsgdGhpcy5saXN0VHlwZSArIFwiX1wiICsgKHRoaXMuaXNUYWJsZSA/IFwiVGFibGVcIiA6IFwiVGh1bWJuYWlsc1wiKTtcbiAgICAvLyAgICAgLy8gfVxuXG4gICAgLy8gICAgIC8vIHJldHVybiByZXM7XG4gICAgLy8gfVxuXG4gICAgY2xlYXIoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2xlYW5JdGVtcygpO1xuICAgICAgICB0aGlzLl9sYXlvdXQgPSBudWxsO1xuICAgIH1cblxuICAgIHNldFNlbGVjdGVkSWRzKHNlbGVjdGVkSWRzOiBzdHJpbmdbXSwgaXRlbXMgPSBudWxsKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5jbGVhcigpO1xuICAgICAgICB0aGlzLmlzQWxsU2VsZWN0ZWQgPSBmYWxzZTtcblxuICAgICAgICBpZiAoc2VsZWN0ZWRJZHMpIHtcbiAgICAgICAgICAgIC8vIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0ZWQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc2VsZWN0ZWRJZCBvZiBzZWxlY3RlZElkcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRtcCA9IHNlbGVjdGVkSWQuc3BsaXQodGhpcy5TRVBBUkFUT1IpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRtcCAmJiB0bXAubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtSWQgPSB0bXBbMF07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1UeXBlID0gdG1wLmxlbmd0aCA+IDEgPyB0bXBbMV0gOiAnJztcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMuc2V0KFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRVbmlxSXRlbUlkKGl0ZW1JZCwgaXRlbVR5cGUpXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmlzQWxsU2VsZWN0ZWQgPSB0aGlzLmdldElzQWxsU2VsZWN0ZWQoaXRlbXMgPyBpdGVtcyA6IHRoaXMudmlydHVhbFNjcm9sbGVyPy52aWV3UG9ydEl0ZW1zKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uRGF0YUluU2Vzc2lvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgfVxuXG4gICAgc2V0U2VsZWN0aW9uRGF0YUluU2Vzc2lvbigpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcy5zaXplID4gMCkge1xuICAgICAgICAgICAgdGhpcy5zZXNzaW9uU2VydmljZS5zZXRPYmplY3QoXG4gICAgICAgICAgICAgICAgUGVwTGlzdENvbXBvbmVudC5TRUxFQ1RFRF9JVEVNU19TVEFURV9LRVksXG4gICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoWy4uLnRoaXMuc2VsZWN0ZWRJdGVtc10pXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMudW5TZWxlY3RlZEl0ZW1zLnNpemUgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnNlc3Npb25TZXJ2aWNlLnNldE9iamVjdChcbiAgICAgICAgICAgICAgICBQZXBMaXN0Q29tcG9uZW50LlVOX1NFTEVDVEVEX0lURU1TX1NUQVRFX0tFWSxcbiAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShbLi4udGhpcy51blNlbGVjdGVkSXRlbXNdKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2Vzc2lvblNlcnZpY2Uuc2V0T2JqZWN0KFxuICAgICAgICAgICAgUGVwTGlzdENvbXBvbmVudC5BTExfU0VMRUNURURfU1RBVEVfS0VZLFxuICAgICAgICAgICAgdGhpcy5pc0FsbFNlbGVjdGVkXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgaW5pdExpc3REYXRhKFxuICAgICAgICBsYXlvdXQ6IFVJQ29udHJvbCxcbiAgICAgICAgdG90YWxSb3dzOiBudW1iZXIsXG4gICAgICAgIGl0ZW1zOiBPYmplY3RzRGF0YVJvd1tdXG4gICAgKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaW5pdFZhcmlhYmxlc0Zyb21TZXNzaW9uKGl0ZW1zKTtcbiAgICAgICAgY29uc3QgY3VycmVudExpc3QgPSB0aGlzLmlzQWxsU2VsZWN0ZWRcbiAgICAgICAgICAgID8gdGhpcy51blNlbGVjdGVkSXRlbXNcbiAgICAgICAgICAgIDogdGhpcy5zZWxlY3RlZEl0ZW1zO1xuICAgICAgICBjb25zdCBjdXJyZW50TGlzdENvdW50ID0gdGhpcy5pc0FsbFNlbGVjdGVkXG4gICAgICAgICAgICA/IHRoaXMudG90YWxSb3dzIC0gY3VycmVudExpc3Quc2l6ZVxuICAgICAgICAgICAgOiBjdXJyZW50TGlzdC5zaXplO1xuICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXNDaGFuZ2UuZW1pdChjdXJyZW50TGlzdENvdW50KTtcblxuICAgICAgICB0aGlzLl9sYXlvdXQgPSBsYXlvdXQ7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtSWQgPSAnJztcbiAgICAgICAgdGhpcy50b3RhbFJvd3MgPSB0b3RhbFJvd3M7XG5cbiAgICAgICAgdGhpcy5zY3JvbGxUb1RvcChmYWxzZSk7XG4gICAgICAgIHRoaXMuY2xlYW5JdGVtcygpO1xuXG4gICAgICAgIGlmIChpdGVtcykge1xuICAgICAgICAgICAgaWYgKHRoaXMucGFnZXJUeXBlID09PSAncGFnZXMnKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgcGFnZSBpbmRleCBvdXQgb2YgYm91bmRzIC0gaW5pdCB0byAwLlxuICAgICAgICAgICAgICAgIGNvbnN0IG51bWJlck9mUGFnZXMgPSBNYXRoLmNlaWwodG90YWxSb3dzIC8gdGhpcy5wYWdlU2l6ZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wYWdlSW5kZXggPj0gbnVtYmVyT2ZQYWdlcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2VJbmRleCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQYWdlKGl0ZW1zLCB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiB0aGlzLnBhZ2VTaXplLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBudW1iZXJPZlN0YXJ0SXRlbXMgPSB0aGlzLmdldE51bWJlck9mU3RhcnRJdGVtcygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0ge1xuICAgICAgICAgICAgICAgICAgICBmcm9tSW5kZXg6IDAsXG4gICAgICAgICAgICAgICAgICAgIHRvSW5kZXg6IG51bWJlck9mU3RhcnRJdGVtcyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSXRlbXMoaXRlbXMsIGV2ZW50KTtcblxuICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRMYXlvdXQoKTtcbiAgICAgICAgdGhpcy5vbkxpc3RMb2FkKCk7XG4gICAgfVxuXG4gICAgdXBkYXRlSXRlbXMoXG4gICAgICAgIGl0ZW1zOiBPYmplY3RzRGF0YVJvd1tdLFxuICAgICAgICBldmVudDogSVBlcExpc3RMb2FkSXRlbXNFdmVudCA9IG51bGxcbiAgICApOiB2b2lkIHtcbiAgICAgICAgaWYgKCFldmVudCkge1xuICAgICAgICAgICAgcmV0dXJuOyAvLyBFdmVudCBpc24ndCBzdXBwbGllZC5cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENsZWFuIGFycmF5XG4gICAgICAgIGlmICh0aGlzLml0ZW1zQ291bnRlciArIGl0ZW1zLmxlbmd0aCA+IFBlcExpc3RDb21wb25lbnQuVE9QX0lURU1TX0FSUkFZKSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFuSXRlbXMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBldmVudC5mcm9tSW5kZXggPz8gMDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXRlbXNbaSArIHN0YXJ0SW5kZXhdKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtc1tpICsgc3RhcnRJbmRleF0gPSBpdGVtc1tpXTtcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zQ291bnRlciArPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50b2dnbGVMb2FkaW5nSXRlbXNGcm9wQXBpKGZhbHNlKTtcbiAgICB9XG5cbiAgICB1cGRhdGVQYWdlKGl0ZW1zOiBPYmplY3RzRGF0YVJvd1tdLCBldmVudDogSVBlcExpc3RMb2FkUGFnZUV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICghZXZlbnQpIHtcbiAgICAgICAgICAgIHJldHVybjsgLy8gRXZlbnQgaXNuJ3Qgc3VwcGxpZWQuXG4gICAgICAgIH1cblxuICAgICAgICAvLyBDbGVhbiBhcnJheVxuICAgICAgICBpZiAodGhpcy5pdGVtc0NvdW50ZXIgKyBpdGVtcy5sZW5ndGggPiBQZXBMaXN0Q29tcG9uZW50LlRPUF9JVEVNU19BUlJBWSkge1xuICAgICAgICAgICAgdGhpcy5jbGVhbkl0ZW1zKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjb25zdCBsb2FkSW5DaHVua3MgPSB0aGlzLml0ZW1zQ291bnRlciA9PT0gMDtcbiAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IE1hdGgubWluKGV2ZW50LnBhZ2VJbmRleCAqIGV2ZW50LnBhZ2VTaXplLCB0aGlzLnRvdGFsUm93cyk7XG4gICAgICAgIGNvbnN0IGVuZEluZGV4ID0gTWF0aC5taW4oc3RhcnRJbmRleCArIGV2ZW50LnBhZ2VTaXplLCB0aGlzLnRvdGFsUm93cyk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLml0ZW1zW2kgKyBzdGFydEluZGV4XSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXNbaSArIHN0YXJ0SW5kZXhdID0gaXRlbXNbaV07XG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtc0NvdW50ZXIgKz0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudXBkYXRlQ3VycmVudFBhZ2VJdGVtcyhzdGFydEluZGV4LCBlbmRJbmRleCk7XG4gICAgICAgIHRoaXMudG9nZ2xlTG9hZGluZ0l0ZW1zRnJvcEFwaShmYWxzZSk7XG4gICAgfVxuXG4gICAgdXBkYXRlSXRlbShkYXRhOiBPYmplY3RzRGF0YVJvdyk6IHZvaWQge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuaXRlbXMuZmluZEluZGV4KChpKSA9PiBpICYmIGk/LlVJRCA9PT0gZGF0YT8uVUlEKTtcbiAgICAgICAgaWYgKGluZGV4ID49IDAgJiYgaW5kZXggPCB0aGlzLml0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVJdGVtUHJvcGVydGllcyh0aGlzLml0ZW1zW2luZGV4XSwgZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzY3JvbGxUb0luZGV4KGluZGV4OiBudW1iZXIsIGFsaWduVG9CZWdpbm5pbmcgPSB0cnVlLCBhZGRpdGlvbmFsT2Zmc2V0ID0gMCwgYW5pbWF0aW9uTWlsbGlzZWNvbmRzOiBudW1iZXIgPSB1bmRlZmluZWQsIGFuaW1hdGlvbkNvbXBsZXRlZENhbGxiYWNrOiAoKSA9PiB2b2lkID0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMudmlydHVhbFNjcm9sbGVyPy5zY3JvbGxUb0luZGV4KGluZGV4LCBhbGlnblRvQmVnaW5uaW5nLCBhZGRpdGlvbmFsT2Zmc2V0LCBhbmltYXRpb25NaWxsaXNlY29uZHMsIGFuaW1hdGlvbkNvbXBsZXRlZENhbGxiYWNrKTtcbiAgICB9XG5cbiAgICB1cGRhdGVJdGVtUHJvcGVydGllcyhpdGVtVG9VcGRhdGU6IE9iamVjdHNEYXRhUm93LCBkYXRhOiBPYmplY3RzRGF0YVJvdykge1xuICAgICAgICBPYmplY3QuYXNzaWduKGl0ZW1Ub1VwZGF0ZSwgZGF0YSk7XG4gICAgfVxuXG4gICAgZ2V0U2VsZWN0ZWRJdGVtc0RhdGEoaXNGb3JFZGl0ID0gZmFsc2UpOiBQZXBTZWxlY3Rpb25EYXRhIHtcbiAgICAgICAgY29uc3QgcmVzID0gbmV3IFBlcFNlbGVjdGlvbkRhdGEoKTtcblxuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25UeXBlRm9yQWN0aW9ucyA9PT0gJ3NpbmdsZScpIHtcbiAgICAgICAgICAgIGNvbnN0IHRtcCA9IHRoaXMuc2VsZWN0ZWRJdGVtSWQuc3BsaXQodGhpcy5TRVBBUkFUT1IpO1xuXG4gICAgICAgICAgICByZXMuc2VsZWN0aW9uVHlwZSA9IDE7XG4gICAgICAgICAgICByZXMucm93cyA9IFt0bXBbMF1dO1xuICAgICAgICAgICAgcmVzLnJvd1R5cGVzID0gW3RtcFsxXV07XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWxlY3Rpb25UeXBlRm9yQWN0aW9ucyA9PT0gJ211bHRpJykge1xuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1UeXBlcyA9IFtdO1xuICAgICAgICAgICAgbGV0IHNlbGVjdGlvblR5cGUgPSAxO1xuICAgICAgICAgICAgbGV0IGN1cnJlbnRMaXN0ID0gW107XG5cbiAgICAgICAgICAgIC8vIEZvciBlZGl0IC0gb25seSB0aGUgc2VsZWN0ZWQgaXRlbXMuXG4gICAgICAgICAgICBpZiAoaXNGb3JFZGl0KSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzQWxsU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExpc3QgPSBBcnJheS5mcm9tKHRoaXMuc2VsZWN0ZWRJdGVtcy52YWx1ZXMoKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBpZCdzIG9mIHRoZSBpdGVtcyB0aGF0IG5vdCBmb3VuZGVkIGluIHVuU2VsZWN0ZWRJdGVtcy5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICF0aGlzLnVuU2VsZWN0ZWRJdGVtcy5oYXMoaXRlbT8uVUlELnRvU3RyaW5nKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGlzdC5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFVuaXFJdGVtSWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtPy5VSUQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0/LlR5cGUudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBGb3IgZGVsZXRlIC0gY2FuIGJlIHRoZSB1bnNlbGVjdGVkIHdpdGggc2VsZWN0X2FsbCBmdW5jdGlvbmFsaXR5LlxuICAgICAgICAgICAgICAgIGN1cnJlbnRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0FsbFNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMudW5TZWxlY3RlZEl0ZW1zLnZhbHVlcygpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHRoaXMuc2VsZWN0ZWRJdGVtcy52YWx1ZXMoKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uVHlwZSA9IHRoaXMuaXNBbGxTZWxlY3RlZCA/IDAgOiAxO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjdXJyZW50TGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdG1wID0gaXRlbS5zcGxpdCh0aGlzLlNFUEFSQVRPUik7XG5cbiAgICAgICAgICAgICAgICBpZiAodG1wLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHRtcFswXSk7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1UeXBlcy5wdXNoKHRtcFsxXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJlcy5zZWxlY3Rpb25UeXBlID0gc2VsZWN0aW9uVHlwZTtcbiAgICAgICAgICAgIHJlcy5yb3dzID0gaXRlbXM7XG4gICAgICAgICAgICByZXMucm93VHlwZXMgPSBpdGVtVHlwZXM7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cblxuICAgIGdldElzSXRlbUVkaXRhYmxlKHVpZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLml0ZW1zLmZpbHRlcigoeCkgPT4geD8uVUlELnRvU3RyaW5nKCkgPT09IHVpZCk7XG4gICAgICAgIGlmIChpdGVtLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtWzBdLklzRWRpdGFibGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRJdGVtRGF0YUJ5SUQodWlkOiBzdHJpbmcpOiBPYmplY3RzRGF0YVJvdyB7XG4gICAgICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbmQoKGl0ZW0pID0+IGl0ZW0/LlVJRC50b1N0cmluZygpID09PSB1aWQpO1xuICAgIH1cblxuICAgIHJlZnJlc2goKSB7XG4gICAgICAgIHRoaXMudmlydHVhbFNjcm9sbGVyPy5yZWZyZXNoKCk7XG4gICAgfVxuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gICAgICAgICAgICAgIEV2ZW50cyBoYW5kbGVycy5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIG9uV2luUmVzaXplKGUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG5cbiAgICAgICAgdGhpcy5jb250YWluZXJXaWR0aCA9IDA7XG4gICAgICAgIHRoaXMuc2V0TGF5b3V0KCk7XG4gICAgfVxuXG4gICAgb25MaXN0UmVzaXplU3RhcnQoZXZlbnQsIGNvbHVtbktleSk6IHZvaWQge1xuICAgICAgICB0aGlzLnByZXNzZWRDb2x1bW4gPSBjb2x1bW5LZXk7XG4gICAgICAgIHRoaXMuc3RhcnRYID0gZXZlbnQueDtcbiAgICAgICAgdGhpcy5zdGFydFdpZHRoID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJy5oZWFkZXItY29sdW1uJykub2Zmc2V0V2lkdGg7XG4gICAgICAgIHRoaXMudGFibGVTdGFydFdpZHRoID0gdGhpcy52aXJ0dWFsU2Nyb2xsZXI/LmNvbnRlbnRFbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgfVxuXG4gICAgb25MaXN0UmVzaXplKGV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnByZXNzZWRDb2x1bW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbGV0IHdpZHRoVG9BZGQgPSB0aGlzLmxheW91dFNlcnZpY2UuaXNSdGwoKSA/IHRoaXMuc3RhcnRYIC0gZXZlbnQueCA6IGV2ZW50LnggLSB0aGlzLnN0YXJ0WDtcblxuICAgICAgICAgICAgLy8gU2V0IHRoZSB3aWR0aCBvZiB0aGUgY29sdW1uIGFuZCB0aGUgY29udGFpbmVyIG9mIHRoZSB3aG9sZSBjb2x1bW5zLlxuICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRXaWR0aCArIHdpZHRoVG9BZGQgPj0gUGVwTGlzdENvbXBvbmVudC5NSU5JTVVNX0NPTFVNTl9XSURUSCB8fCB3aWR0aFRvQWRkID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuX2xheW91dC5Db250cm9sRmllbGRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBsZXQgdG90YWxDYWxjQ29sc1dpZHRoID0gMDtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdWlDb250cm9sRmllbGQ6IFVJQ29udHJvbEZpZWxkID0gdGhpcy5fbGF5b3V0XG4gICAgICAgICAgICAgICAgICAgICAgICAuQ29udHJvbEZpZWxkc1tpbmRleF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSBsZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDYWxjIHRoZSBsYXN0IGNvbHVtbiBvbmx5IGluIHBlcmNlbnRhZ2UgdHlwZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0NvbHVtbldpZHRoT2ZUeXBlUGVyY2VudGFnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjcm9sbFdpZHRoID0gdGhpcy5sYXlvdXRTZXJ2aWNlLmdldFNjcm9sbGJhcldpZHRoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGhUb0FkZCArPSBzY3JvbGxXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aUNvbnRyb2xGaWVsZC5jYWxjVGl0bGVDb2x1bW5XaWR0aFN0cmluZyA9IHVpQ29udHJvbEZpZWxkLmNhbGNDb2x1bW5XaWR0aFN0cmluZyA9ICdjYWxjKDEwMCUgLSAnICsgKHRvdGFsQ2FsY0NvbHNXaWR0aCArIHNjcm9sbFdpZHRoKSArICdweCknOyAvLyBGb3IgMTAwJVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodWlDb250cm9sRmllbGQuQXBpTmFtZSA9PT0gdGhpcy5wcmVzc2VkQ29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpQ29udHJvbEZpZWxkLmNhbGNDb2x1bW5XaWR0aCA9IHRoaXMuc3RhcnRXaWR0aCArIHdpZHRoVG9BZGQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpQ29udHJvbEZpZWxkLmNhbGNUaXRsZUNvbHVtbldpZHRoU3RyaW5nID0gdWlDb250cm9sRmllbGQuY2FsY0NvbHVtbldpZHRoICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlDb250cm9sRmllbGQuY2FsY0NvbHVtbldpZHRoU3RyaW5nID0gdWlDb250cm9sRmllbGQuY2FsY0NvbHVtbldpZHRoICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodWlDb250cm9sRmllbGQuQXBpTmFtZSA9PT0gdGhpcy5wcmVzc2VkQ29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1aUNvbnRyb2xGaWVsZC5jYWxjQ29sdW1uV2lkdGggPSB0aGlzLnN0YXJ0V2lkdGggKyB3aWR0aFRvQWRkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdWlDb250cm9sRmllbGQuY2FsY1RpdGxlQ29sdW1uV2lkdGhTdHJpbmcgPSB1aUNvbnRyb2xGaWVsZC5jYWxjQ29sdW1uV2lkdGhTdHJpbmcgPSB1aUNvbnRyb2xGaWVsZC5jYWxjQ29sdW1uV2lkdGggKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdG90YWxDYWxjQ29sc1dpZHRoICs9IHVpQ29udHJvbEZpZWxkLmNhbGNDb2x1bW5XaWR0aDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICd3aWR0aCcsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGFibGVTdGFydFdpZHRoICsgd2lkdGhUb0FkZCArICdweCdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmNoZWNrRm9yQ2hhbmdlcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25MaXN0UmVzaXplRW5kKGV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnByZXNzZWRDb2x1bW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGV2ZW50ICYmXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRQYXJlbnQoZXZlbnQuc3JjRWxlbWVudCwgJ3Jlc2l6ZS1ib3gnKS5sZW5ndGggPiAwXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRSZXNpemVEYXRhKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFNldCB0aW1lb3V0IDAgZm9yIG9uTGlzdFNvcnRpbmdDaGFuZ2Ugd2lsbCBoYXZlIHRoZSBwcmVzc2VkQ29sdW1uLlxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRSZXNpemVEYXRhKCk7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25MaXN0U29ydGluZ0NoYW5nZShzb3J0Qnk6IHN0cmluZywgaXNBc2M6IGJvb2xlYW4sIGV2ZW50ID0gbnVsbCk6IHZvaWQge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICB0aGlzLnByZXNzZWRDb2x1bW4ubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgKGV2ZW50ICYmIHRoaXMuZ2V0UGFyZW50KGV2ZW50LnNyY0VsZW1lbnQsICdyZXNpemUtYm94JykubGVuZ3RoID4gMClcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zb3J0QnkgIT09IHNvcnRCeSB8fCB0aGlzLmlzQXNjICE9PSBpc0FzYykge1xuICAgICAgICAgICAgdGhpcy5zb3J0QnkgPSBzb3J0Qnk7XG4gICAgICAgICAgICB0aGlzLmlzQXNjID0gaXNBc2M7XG4gICAgICAgICAgICB0aGlzLnNhdmVTb3J0aW5nVG9TZXNzaW9uKCk7XG5cbiAgICAgICAgICAgIHRoaXMuc29ydGluZ0NoYW5nZS5lbWl0KHsgc29ydEJ5LCBpc0FzYyB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uTGlzdEhlYWRlck1vdXNlRW50ZXIoZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgLy8gdGhpcy5oZWFkZXJJc0luRm9jdXMgPSB0cnVlO1xuICAgIH1cblxuICAgIG9uTGlzdEhlYWRlck1vdXNlTGVhdmUoZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgLy8gdGhpcy5oZWFkZXJJc0luRm9jdXMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vbkxpc3RSZXNpemVFbmQoZXZlbnQpO1xuICAgICAgICB0aGlzLmluaXRSZXNpemVEYXRhKCk7XG4gICAgfVxuXG4gICAgb25QYWdlckNoYW5nZShldmVudDogSVBlcExpc3RQYWdlckNoYW5nZUV2ZW50KTogdm9pZCB7XG4gICAgICAgIHRoaXMucGFnZUluZGV4ID0gZXZlbnQucGFnZUluZGV4O1xuXG4gICAgICAgIC8vIFNjcm9sbCB0byB0b3AuXG4gICAgICAgIHRoaXMuc2Nyb2xsVG9Ub3AoKTtcblxuICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gZXZlbnQucGFnZUluZGV4ICogZXZlbnQucGFnZVNpemU7XG4gICAgICAgIGNvbnN0IGVuZEluZGV4ID0gTWF0aC5taW4oXG4gICAgICAgICAgICBzdGFydEluZGV4ICsgZXZlbnQucGFnZVNpemUsXG4gICAgICAgICAgICB0aGlzLnRvdGFsUm93c1xuICAgICAgICApO1xuXG4gICAgICAgIGxldCBzaG91bGRHZXRJdGVtc0Zyb21BcGkgPSBmYWxzZTtcbiAgICAgICAgbGV0IGluZGV4OiBudW1iZXIgPSBzdGFydEluZGV4O1xuXG4gICAgICAgIHdoaWxlICghc2hvdWxkR2V0SXRlbXNGcm9tQXBpICYmIGluZGV4IDwgZW5kSW5kZXgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pdGVtc1tpbmRleF0pIHtcbiAgICAgICAgICAgICAgICBzaG91bGRHZXRJdGVtc0Zyb21BcGkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdldCBidWxrIGZyb20gYXBpLlxuICAgICAgICBpZiAoc2hvdWxkR2V0SXRlbXNGcm9tQXBpKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMubG9hZGluZ0l0ZW1zRnJvbUFwaSkge1xuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlTG9hZGluZ0l0ZW1zRnJvcEFwaSh0cnVlKTtcblxuICAgICAgICAgICAgICAgIHRoaXMubG9hZFBhZ2UuZW1pdCh7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogZXZlbnQucGFnZUluZGV4LFxuICAgICAgICAgICAgICAgICAgICBwYWdlU2l6ZTogZXZlbnQucGFnZVNpemUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUN1cnJlbnRQYWdlSXRlbXMoc3RhcnRJbmRleCwgZW5kSW5kZXgpO1xuICAgICAgICAgICAgfSwgdGhpcy5zY3JvbGxBbmltYXRpb25UaW1lKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uVmlydHVhbFNjcm9sbGVyQ2hhbmdlKGV2ZW50OiBJUGFnZUluZm8pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yYWlzZVN0YXJ0SW5kZXhDaGFuZ2UoZXZlbnQuc3RhcnRJbmRleCk7XG5cbiAgICAgICAgaWYgKHRoaXMucGFnZXJUeXBlID09PSAnc2Nyb2xsJykge1xuICAgICAgICAgICAgLy8gRm9yIG90aGVyIGV2ZW50cyBkbyBub3RoaW5nLlxuICAgICAgICAgICAgaWYgKHR5cGVvZiBldmVudC5zdGFydEluZGV4ID09PSAndW5kZWZpbmVkJyB8fCBldmVudC5zdGFydEluZGV4IDwgMCB8fFxuICAgICAgICAgICAgICAgIHR5cGVvZiBldmVudC5lbmRJbmRleCA9PT0gJ3VuZGVmaW5lZCcgfHwgZXZlbnQuZW5kSW5kZXggPCAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBhZGRBdFN0YXJ0ID0gZXZlbnQuc2Nyb2xsRGlyZWN0aW9uID09PSAnYmFja3dhcmQnO1xuICAgICAgICAgICAgbGV0IHNob3VsZEdldEl0ZW1zRnJvbUFwaSA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IGluZGV4T2ZNaXNzaW5nSXRlbTogbnVtYmVyO1xuXG4gICAgICAgICAgICBpZiAoYWRkQXRTdGFydCkge1xuICAgICAgICAgICAgICAgIGluZGV4T2ZNaXNzaW5nSXRlbSA9IGV2ZW50LmVuZEluZGV4O1xuICAgICAgICAgICAgICAgIHdoaWxlICghc2hvdWxkR2V0SXRlbXNGcm9tQXBpICYmIGluZGV4T2ZNaXNzaW5nSXRlbSA+PSBldmVudC5zdGFydEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pdGVtc1tpbmRleE9mTWlzc2luZ0l0ZW1dKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG91bGRHZXRJdGVtc0Zyb21BcGkgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzaG91bGRHZXRJdGVtc0Zyb21BcGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4T2ZNaXNzaW5nSXRlbS0tO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbmRleE9mTWlzc2luZ0l0ZW0gPSBldmVudC5zdGFydEluZGV4O1xuICAgICAgICAgICAgICAgIHdoaWxlICghc2hvdWxkR2V0SXRlbXNGcm9tQXBpICYmIGluZGV4T2ZNaXNzaW5nSXRlbSA8PSBldmVudC5lbmRJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXRlbXNbaW5kZXhPZk1pc3NpbmdJdGVtXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkR2V0SXRlbXNGcm9tQXBpID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICghc2hvdWxkR2V0SXRlbXNGcm9tQXBpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleE9mTWlzc2luZ0l0ZW0rKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gR2V0IGJ1bGsgZnJvbSBhcGkuXG4gICAgICAgICAgICBpZiAoc2hvdWxkR2V0SXRlbXNGcm9tQXBpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvYWRpbmdJdGVtc0Zyb21BcGkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGVMb2FkaW5nSXRlbXNGcm9wQXBpKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvcCA9IHRoaXMuZ2V0VG9wSXRlbXMoKSAtIDE7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZyb21JbmRleCA9IGFkZEF0U3RhcnQgPyBNYXRoLm1heChpbmRleE9mTWlzc2luZ0l0ZW0gLSB0b3AsIDApIDogaW5kZXhPZk1pc3NpbmdJdGVtO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0b0luZGV4ID0gYWRkQXRTdGFydCA/IGluZGV4T2ZNaXNzaW5nSXRlbSA6IE1hdGgubWluKGluZGV4T2ZNaXNzaW5nSXRlbSArIHRvcCwgdGhpcy50b3RhbFJvd3MpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEl0ZW1zLmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbUluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG9JbmRleCxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25MaXN0TG9hZCgpOiB2b2lkIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxpc3RMb2FkLmVtaXQoKTtcbiAgICAgICAgfSwgMCk7XG4gICAgfVxuXG4gICAgb25DaGlsZFJlY3RDaGFuZ2UoZXZlbnQ6IENsaWVudFJlY3QpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZWRPYmplY3RIZWlnaHQgPSBldmVudD8uaGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgfSwgMCk7XG4gICAgfVxuXG4gICAgb25WYWx1ZUNoYW5nZWQodmFsdWVDaGFuZ2U6IElQZXBGb3JtRmllbGRWYWx1ZUNoYW5nZUV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQodmFsdWVDaGFuZ2UpO1xuICAgIH1cblxuICAgIG9uQ3VzdG9taXplRmllbGRDbGljayhcbiAgICAgICAgY3VzdG9taXplRmllbGRDbGlja2VkRGF0YTogSVBlcEZvcm1GaWVsZENsaWNrRXZlbnRcbiAgICApOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmllbGRDbGljay5lbWl0KGN1c3RvbWl6ZUZpZWxkQ2xpY2tlZERhdGEpO1xuICAgIH1cbn1cbiJdfQ==
import { Component, Inject } from '@angular/core';
import { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';
// import {
//     hex2hsl,
//     hslString2hsl,
//     rgbString2hsl,
//     IPepHslColor,
//     findClosestAccessibleColor,
//     hsl2hex,
//     convertHslToStringHsl,
// } from './color-utils';
import { PepColorService } from '@pepperi-addons/ngx-lib';
var PepContrastRatioType;
(function (PepContrastRatioType) {
    PepContrastRatioType[PepContrastRatioType["AA"] = 4.5] = "AA";
    PepContrastRatioType[PepContrastRatioType["AAA"] = 7] = "AAA";
})(PepContrastRatioType || (PepContrastRatioType = {}));
export class PepColorPickerComponent {
    constructor(colorService, dialogRef, data) {
        var _a;
        this.colorService = colorService;
        this.dialogRef = dialogRef;
        this.data = data;
        this.defaultColor = '#ccc';
        this.checkAAComplient = true;
        this.currentHue = 100;
        this.currentHueMin = 0;
        this.currentHueMax = 360;
        this.currentSaturation = 50;
        this.currentSaturationMin = 0;
        this.currentSaturationMax = 100;
        this.currentLightness = 50;
        this.currentLightnessMin = 0;
        this.currentLightnessMax = 100;
        this.data.type = data ? data.type : 'any';
        this.data.showAAComplient = !data
            ? false
            : (_a = data.showAAComplient) !== null && _a !== void 0 ? _a : true;
        this.data.textColor = data && data.textColor ? data.textColor : '#fff';
        this.data.contrastRatio =
            data && data.contrastRatio
                ? data.contrastRatio
                : PepContrastRatioType.AA;
    }
    ngOnInit() {
        this.initVars();
        this.checkAAComplient = this.data.showAAComplient;
        this.convertValueStringToColor(this.data.value);
    }
    initVars() {
        if (this.data.type === 'main') {
            this.currentLightnessMax = 10;
            this.currentLightness = 5;
        }
        else if (this.data.type === 'success') {
            this.currentHueMin = 70;
            this.currentHueMax = 150;
            this.currentHue = 100;
            this.currentSaturationMin = 50;
            this.currentSaturationMax = 100;
            this.currentSaturation = 50;
            this.currentLightnessMin = 10;
            this.currentLightnessMax = 65;
            this.currentLightness = 50;
        }
        else if (this.data.type === 'caution') {
            this.currentHueMin = -20;
            this.currentHueMax = 20;
            this.currentHue = 10;
            this.currentSaturationMin = 75;
            this.currentSaturationMax = 100;
            this.currentSaturation = 75;
            this.currentLightnessMin = 25;
            this.currentLightnessMax = 75;
            this.currentLightness = 50;
        }
    }
    setCurrentHueInCss() {
        document.documentElement.style.setProperty(PepColorPickerComponent.CURRENT_HUE, this.currentHue.toString());
    }
    convertValueStringToColor(color) {
        if (color.indexOf('hsl') === 0) {
            const hsl = this.colorService.hslString2hsl(color);
            this.convertColorToValueString(hsl);
        }
        else if (color.indexOf('rgb') === 0) {
            const hsl = this.colorService.rgbString2hsl(color);
            this.convertColorToValueString(hsl);
        }
        else if (color.indexOf('#') === 0) {
            const hsl = this.colorService.hex2hsl(color);
            this.convertColorToValueString(hsl);
        }
        else {
            // Handle default.
            const hsl = this.colorService.hex2hsl(this.defaultColor);
            this.convertColorToValueString(hsl);
        }
        this.setCurrentHueInCss();
    }
    convertColorToValueString(hslColor) {
        // Regular hue
        if (hslColor.h >= this.currentHueMin &&
            hslColor.h <= this.currentHueMax) {
            this.currentHue = hslColor.h;
        }
        else if (this.currentHueMin < 0 &&
            hslColor.h >= 0 &&
            hslColor.h <= 360) {
            // For min with - (change to the other side of the circle)
            hslColor.h = hslColor.h - 360;
            if (hslColor.h >= this.currentHueMin &&
                hslColor.h <= this.currentHueMax) {
                this.currentHue = hslColor.h;
            }
        }
        this.currentSaturation =
            hslColor.s >= this.currentSaturationMin &&
                hslColor.s <= this.currentSaturationMax
                ? hslColor.s
                : this.currentSaturation;
        this.currentLightness =
            hslColor.l >= this.currentLightnessMin &&
                hslColor.l <= this.currentLightnessMax
                ? hslColor.l
                : this.currentLightness;
        // Write the value (if hue is changed to the other side of the circle return it back).
        const hsl = {
            h: this.currentHue,
            s: this.currentSaturation,
            l: this.currentLightness,
        };
        this.data.value = this.colorService.convertHslToStringHsl(hsl);
        // Check the contrast ratio - set the closest accessible color to complientColor
        // and update isUserChooseAAComplientColor.
        const adjustableColor = this.colorService.hsl2hex(hsl);
        const closestHex = this.colorService.findClosestAccessibleColor(adjustableColor, this.data.textColor, this.data.contrastRatio);
        this.isUserChooseAAComplientColor = adjustableColor === closestHex;
        this.complientColor = this.colorService.convertHslToStringHsl(this.colorService.hex2hsl(closestHex));
    }
    onHueChange(event) {
        this.convertColorToValueString({ h: event.value });
        this.setCurrentHueInCss();
    }
    onSaturationChange(event) {
        // this.currentSaturation = event.value;
        this.convertColorToValueString({ s: event.value });
    }
    onLightnessChange(event) {
        // this.currentLightness = event.value;
        this.convertColorToValueString({
            l: this.currentLightnessMax -
                event.value +
                this.currentLightnessMin,
        });
    }
    onColorValueChange(event) {
        this.convertValueStringToColor(event.value);
    }
    onSave(event) {
        const color = this.checkAAComplient
            ? this.complientColor
            : this.data.value;
        // this.notify.emit({ key: this.key, value: color });
        this.dialogRef.close(color);
    }
}
PepColorPickerComponent.CURRENT_HUE = '--pep-color-picker-current-hue';
PepColorPickerComponent.decorators = [
    { type: Component, args: [{
                template: "<div class=\"pep-color-picker-container\">\n    <pep-dialog [title]=\"'COLOR.DIALOG_TITLE' | translate\">\n        <ng-container pep-dialog-content>\n            <div class=\"color-chooser-content\">\n                <div class=\"current-color\" [ngStyle]=\"{ 'background': data?.value ? data.value : 'transparent' }\"></div>\n\n                <div class=\"slider-box current-hue\">\n                    <mat-label class=\"body-xs \">{{ 'COLOR.CHANGE_HUE' | translate}}</mat-label>\n                    <div [class]=\"data?.type\">\n                        <mat-slider [min]=\"currentHueMin\" [max]=\"currentHueMax\" step=\"1\" [value]=\"currentHue\"\n                            (change)=\"onHueChange($event)\"></mat-slider>\n                    </div>\n                </div>\n                <div class=\"slider-box current-saturation\">\n                    <mat-label class=\"body-xs \">{{ 'COLOR.CHANGE_SATURATION' | translate}}</mat-label>\n                    <div [class]=\"data?.type\">\n                        <mat-slider [min]=\"currentSaturationMin\" [max]=\"currentSaturationMax\" step=\"1\"\n                            [value]=\"currentSaturation\" (change)=\"onSaturationChange($event)\"></mat-slider>\n                    </div>\n                </div>\n                <div class=\"slider-box current-lightness\">\n                    <mat-label class=\"body-xs \">{{ 'COLOR.CHANGE_LIGHTNESS' | translate}}</mat-label>\n                    <div [class]=\"data?.type\">\n                        <mat-slider [min]=\"currentLightnessMin\" [max]=\"currentLightnessMax\" step=\"1\"\n                            [value]=\"currentLightnessMax - currentLightness + currentLightnessMin\"\n                            (change)=\"onLightnessChange($event)\"></mat-slider>\n                    </div>\n                </div>\n            </div>\n            <div class=\"color-value-content\">\n                <div class=\"color-value\" [ngClass]=\"{ 'with-complient': checkAAComplient }\">\n                    <pep-textbox [key]=\"'colorValue'\" [label]=\"'COLOR.ADD_VALUE_HERE' | translate \"\n                        [formattedValue]=\"data?.value\" [value]=\"data?.value\" (valueChange)=\"onColorValueChange($event)\">\n                    </pep-textbox>\n                </div>\n                <div *ngIf=\"checkAAComplient\" class=\"color-complient-container\">\n                    <pep-field-title [label]=\"'COLOR.AA_COMPLIENT' | translate \">\n                    </pep-field-title>\n                    <div class=\"color-complient\" [ngStyle]=\"{ 'background': complientColor }\">\n                        <mat-icon *ngIf=\"isUserChooseAAComplientColor\">\n                            <pep-icon name=\"system_ok\">\n                            </pep-icon>\n                        </mat-icon>\n                    </div>\n                </div>\n            </div>\n        </ng-container>\n        <ng-container pep-dialog-actions>\n            <div class=\"color-actions pep-spacing-element-negative\">\n                <mat-checkbox *ngIf=\"data.showAAComplient\" class=\"pep-spacing-element\" type=\"checkbox\"\n                    id=\"checkAAComplient\" (change)=\"checkAAComplient = !checkAAComplient\" [checked]=\"checkAAComplient\">\n                    <span class=\"body-xs ellipsis\">{{ 'COLOR.AA_COMPLIENT' | translate }}</span>\n                </mat-checkbox>\n                <div>\n                    <button mat-button [mat-dialog-close]=\"null\" class=\"pep-spacing-element pep-button md weak\">\n                        {{'ACTIONS.CANCEL' | translate}}\n                    </button>\n                    <button mat-button class=\"pep-spacing-element pep-button md strong\" (click)=\"onSave($event)\">\n                        {{'ACTIONS.OK' | translate}}\n                    </button>\n                </div>\n            </div>\n        </ng-container>\n    </pep-dialog>\n</div>",
                styles: [".mat-slider-horizontal .mat-slider-track-fill,.mat-slider-track-background{display:none}.pep-color-picker-container ::ng-deep.mat-dialog-content,.pepperi-color-picker-container ::ng-deep.mat-dialog-content{padding:.5rem .5rem 0;padding:var(--pep-spacing-sm,.5rem) var(--pep-spacing-sm,.5rem) 0}.pep-color-picker-container .color-chooser-content,.pepperi-color-picker-container .color-chooser-content{display:-ms-grid;display:grid;grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(3,1fr);grid-column-gap:1.5rem;grid-column-gap:var(--pep-spacing-xl,1.5rem);grid-row-gap:.5rem;grid-row-gap:var(--pep-spacing-sm,.5rem);margin-top:.5rem;margin-top:var(--pep-spacing-sm,.5rem)}.pep-color-picker-container .color-chooser-content .current-color,.pepperi-color-picker-container .color-chooser-content .current-color{grid-row:1/span 3;grid-column:6/span 4;border-radius:.25rem;border-radius:var(--pep-border-radius-md,.25rem);width:9.25rem;height:9.25rem}.pep-color-picker-container .color-chooser-content .slider-box,.pepperi-color-picker-container .color-chooser-content .slider-box{grid-column:1/span 5}.pep-color-picker-container .color-value-content,.pepperi-color-picker-container .color-value-content{display:-ms-grid;display:grid;grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(1,1fr);grid-column-gap:1.5rem;grid-column-gap:var(--pep-spacing-xl,1.5rem);grid-row-gap:.5rem;grid-row-gap:var(--pep-spacing-sm,.5rem);margin-top:1.5rem}.pep-color-picker-container .color-value-content .color-value,.pepperi-color-picker-container .color-value-content .color-value{grid-row:1/span 1;grid-column:1/span 9}.pep-color-picker-container .color-value-content .color-value.with-complient,.pepperi-color-picker-container .color-value-content .color-value.with-complient{grid-column:1/span 5}.pep-color-picker-container .color-value-content .color-complient-container,.pepperi-color-picker-container .color-value-content .color-complient-container{grid-column:6/span 4}.pep-color-picker-container .color-value-content .color-complient-container .color-complient,.pepperi-color-picker-container .color-value-content .color-complient-container .color-complient{display:flex;justify-content:center;align-items:center;border-radius:.25rem;border-radius:var(--pep-border-radius-md,.25rem);height:2.5rem;height:var(--pep-form-field-height,2.5rem);width:9.25rem}.pep-color-picker-container ::ng-deep.mat-dialog-actions,.pepperi-color-picker-container ::ng-deep.mat-dialog-actions{display:block}.pep-color-picker-container ::ng-deep.mat-dialog-actions .color-actions,.pepperi-color-picker-container ::ng-deep.mat-dialog-actions .color-actions{display:flex;justify-content:space-between;align-items:center}"]
            },] }
];
PepColorPickerComponent.ctorParameters = () => [
    { type: PepColorService },
    { type: MatDialogRef },
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1saWIvY29sb3IvY29sb3ItcGlja2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRCxPQUFPLEVBQUUsWUFBWSxFQUFFLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3pFLFdBQVc7QUFDWCxlQUFlO0FBQ2YscUJBQXFCO0FBQ3JCLHFCQUFxQjtBQUNyQixvQkFBb0I7QUFDcEIsa0NBQWtDO0FBQ2xDLGVBQWU7QUFDZiw2QkFBNkI7QUFDN0IsMEJBQTBCO0FBQzFCLE9BQU8sRUFBRSxlQUFlLEVBQWdCLE1BQU0seUJBQXlCLENBQUM7QUFJeEUsSUFBSyxvQkFHSjtBQUhELFdBQUssb0JBQW9CO0lBQ3JCLDZEQUFRLENBQUE7SUFDUiw2REFBTyxDQUFBO0FBQ1gsQ0FBQyxFQUhJLG9CQUFvQixLQUFwQixvQkFBb0IsUUFHeEI7QUFjRCxNQUFNLE9BQU8sdUJBQXVCO0lBTWhDLFlBQ1ksWUFBNkIsRUFDN0IsU0FBZ0QsRUFDeEIsSUFBK0I7O1FBRnZELGlCQUFZLEdBQVosWUFBWSxDQUFpQjtRQUM3QixjQUFTLEdBQVQsU0FBUyxDQUF1QztRQUN4QixTQUFJLEdBQUosSUFBSSxDQUEyQjtRQVBsRCxpQkFBWSxHQUFHLE1BQU0sQ0FBQztRQUV2QyxxQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFrQnhCLGVBQVUsR0FBRyxHQUFHLENBQUM7UUFDakIsa0JBQWEsR0FBRyxDQUFDLENBQUM7UUFDbEIsa0JBQWEsR0FBRyxHQUFHLENBQUM7UUFFcEIsc0JBQWlCLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLHlCQUFvQixHQUFHLENBQUMsQ0FBQztRQUN6Qix5QkFBb0IsR0FBRyxHQUFHLENBQUM7UUFFM0IscUJB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TSxDQUFDLEtBQUs7UUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsZ0JBQWdCO1lBQy9CLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYztZQUNyQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFdEIscURBQXFEO1FBQ3JELElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2hDLENBQUM7O0FBNUxNLG1DQUFXLEdBQUcsZ0NBQWdDLENBQUM7O1lBTHpELFNBQVMsU0FBQztnQkFDUCxxMkhBQTRDOzthQUUvQzs7O1lBcEJRLGVBQWU7WUFWZixZQUFZOzRDQXdDWixNQUFNLFNBQUMsZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1hdERpYWxvZ1JlZiwgTUFUX0RJQUxPR19EQVRBIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcbi8vIGltcG9ydCB7XG4vLyAgICAgaGV4MmhzbCxcbi8vICAgICBoc2xTdHJpbmcyaHNsLFxuLy8gICAgIHJnYlN0cmluZzJoc2wsXG4vLyAgICAgSVBlcEhzbENvbG9yLFxuLy8gICAgIGZpbmRDbG9zZXN0QWNjZXNzaWJsZUNvbG9yLFxuLy8gICAgIGhzbDJoZXgsXG4vLyAgICAgY29udmVydEhzbFRvU3RyaW5nSHNsLFxuLy8gfSBmcm9tICcuL2NvbG9yLXV0aWxzJztcbmltcG9ydCB7IFBlcENvbG9yU2VydmljZSwgSVBlcEhzbENvbG9yIH0gZnJvbSAnQHBlcHBlcmktYWRkb25zL25neC1saWInO1xuXG5pbXBvcnQgeyBQZXBDb2xvclR5cGUgfSBmcm9tICcuL2NvbG9yLm1vZGVsJztcblxuZW51bSBQZXBDb250cmFzdFJhdGlvVHlwZSB7XG4gICAgQUEgPSA0LjUsXG4gICAgQUFBID0gNyxcbn1cblxuaW50ZXJmYWNlIElQZXBDb2xvclBpY2tlckRpYWxvZ0RhdGEge1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgdHlwZTogUGVwQ29sb3JUeXBlO1xuICAgIHNob3dBQUNvbXBsaWVudDogYm9vbGVhbjtcbiAgICB0ZXh0Q29sb3I6IHN0cmluZztcbiAgICBjb250cmFzdFJhdGlvOiBQZXBDb250cmFzdFJhdGlvVHlwZTtcbn1cblxuQENvbXBvbmVudCh7XG4gICAgdGVtcGxhdGVVcmw6ICcuL2NvbG9yLXBpY2tlci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vY29sb3ItcGlja2VyLmNvbXBvbmVudC5zY3NzJ10sXG59KVxuZXhwb3J0IGNsYXNzIFBlcENvbG9yUGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBzdGF0aWMgQ1VSUkVOVF9IVUUgPSAnLS1wZXAtY29sb3ItcGlja2VyLWN1cnJlbnQtaHVlJztcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRlZmF1bHRDb2xvciA9ICcjY2NjJztcblxuICAgIGNoZWNrQUFDb21wbGllbnQgPSB0cnVlO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgY29sb3JTZXJ2aWNlOiBQZXBDb2xvclNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8UGVwQ29sb3JQaWNrZXJDb21wb25lbnQ+LFxuICAgICAgICBASW5qZWN0KE1BVF9ESUFMT0dfREFUQSkgcHVibGljIGRhdGE6IElQZXBDb2xvclBpY2tlckRpYWxvZ0RhdGFcbiAgICApIHtcbiAgICAgICAgdGhpcy5kYXRhLnR5cGUgPSBkYXRhID8gZGF0YS50eXBlIDogJ2FueSc7XG4gICAgICAgIHRoaXMuZGF0YS5zaG93QUFDb21wbGllbnQgPSAhZGF0YVxuICAgICAgICAgICAgPyBmYWxzZVxuICAgICAgICAgICAgOiBkYXRhLnNob3dBQUNvbXBsaWVudCA/PyB0cnVlO1xuICAgICAgICB0aGlzLmRhdGEudGV4dENvbG9yID0gZGF0YSAmJiBkYXRhLnRleHRDb2xvciA/IGRhdGEudGV4dENvbG9yIDogJyNmZmYnO1xuICAgICAgICB0aGlzLmRhdGEuY29udHJhc3RSYXRpbyA9XG4gICAgICAgICAgICBkYXRhICYmIGRhdGEuY29udHJhc3RSYXRpb1xuICAgICAgICAgICAgICAgID8gZGF0YS5jb250cmFzdFJhdGlvXG4gICAgICAgICAgICAgICAgOiBQZXBDb250cmFzdFJhdGlvVHlwZS5BQTtcbiAgICB9XG5cbiAgICBjdXJyZW50SHVlID0gMTAwO1xuICAgIGN1cnJlbnRIdWVNaW4gPSAwO1xuICAgIGN1cnJlbnRIdWVNYXggPSAzNjA7XG5cbiAgICBjdXJyZW50U2F0dXJhdGlvbiA9IDUwO1xuICAgIGN1cnJlbnRTYXR1cmF0aW9uTWluID0gMDtcbiAgICBjdXJyZW50U2F0dXJhdGlvbk1heCA9IDEwMDtcblxuICAgIGN1cnJlbnRMaWdodG5lc3MgPSA1MDtcbiAgICBjdXJyZW50TGlnaHRuZXNzTWluID0gMDtcbiAgICBjdXJyZW50TGlnaHRuZXNzTWF4ID0gMTAwO1xuXG4gICAgY29tcGxpZW50Q29sb3I6IHN0cmluZztcbiAgICBpc1VzZXJDaG9vc2VBQUNvbXBsaWVudENvbG9yOiBib29sZWFuO1xuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaW5pdFZhcnMoKTtcbiAgICAgICAgdGhpcy5jaGVja0FBQ29tcGxpZW50ID0gdGhpcy5kYXRhLnNob3dBQUNvbXBsaWVudDtcbiAgICAgICAgdGhpcy5jb252ZXJ0VmFsdWVTdHJpbmdUb0NvbG9yKHRoaXMuZGF0YS52YWx1ZSk7XG4gICAgfVxuXG4gICAgaW5pdFZhcnMoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmRhdGEudHlwZSA9PT0gJ21haW4nKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMaWdodG5lc3NNYXggPSAxMDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudExpZ2h0bmVzcyA9IDU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhLnR5cGUgPT09ICdzdWNjZXNzJykge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50SHVlTWluID0gNzA7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRIdWVNYXggPSAxNTA7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRIdWUgPSAxMDA7XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNhdHVyYXRpb25NaW4gPSA1MDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNhdHVyYXRpb25NYXggPSAxMDA7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTYXR1cmF0aW9uID0gNTA7XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudExpZ2h0bmVzc01pbiA9IDEwO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50TGlnaHRuZXNzTWF4ID0gNjU7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMaWdodG5lc3MgPSA1MDtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmRhdGEudHlwZSA9PT0gJ2NhdXRpb24nKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRIdWVNaW4gPSAtMjA7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRIdWVNYXggPSAyMDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEh1ZSA9IDEwO1xuXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTYXR1cmF0aW9uTWluID0gNzU7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTYXR1cmF0aW9uTWF4ID0gMTAwO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50U2F0dXJhdGlvbiA9IDc1O1xuXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMaWdodG5lc3NNaW4gPSAyNTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudExpZ2h0bmVzc01heCA9IDc1O1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50TGlnaHRuZXNzID0gNTA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRDdXJyZW50SHVlSW5Dc3MoKTogdm9pZCB7XG4gICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShcbiAgICAgICAgICAgIFBlcENvbG9yUGlja2VyQ29tcG9uZW50LkNVUlJFTlRfSFVFLFxuICAgICAgICAgICAgdGhpcy5jdXJyZW50SHVlLnRvU3RyaW5nKClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBjb252ZXJ0VmFsdWVTdHJpbmdUb0NvbG9yKGNvbG9yKTogdm9pZCB7XG4gICAgICAgIGlmIChjb2xvci5pbmRleE9mKCdoc2wnKSA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgaHNsID0gdGhpcy5jb2xvclNlcnZpY2UuaHNsU3RyaW5nMmhzbChjb2xvcik7XG4gICAgICAgICAgICB0aGlzLmNvbnZlcnRDb2xvclRvVmFsdWVTdHJpbmcoaHNsKTtcbiAgICAgICAgfSBlbHNlIGlmIChjb2xvci5pbmRleE9mKCdyZ2InKSA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgaHNsID0gdGhpcy5jb2xvclNlcnZpY2UucmdiU3RyaW5nMmhzbChjb2xvcik7XG4gICAgICAgICAgICB0aGlzLmNvbnZlcnRDb2xvclRvVmFsdWVTdHJpbmcoaHNsKTtcbiAgICAgICAgfSBlbHNlIGlmIChjb2xvci5pbmRleE9mKCcjJykgPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGhzbCA9IHRoaXMuY29sb3JTZXJ2aWNlLmhleDJoc2woY29sb3IpO1xuICAgICAgICAgICAgdGhpcy5jb252ZXJ0Q29sb3JUb1ZhbHVlU3RyaW5nKGhzbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBIYW5kbGUgZGVmYXVsdC5cbiAgICAgICAgICAgIGNvbnN0IGhzbCA9IHRoaXMuY29sb3JTZXJ2aWNlLmhleDJoc2wodGhpcy5kZWZhdWx0Q29sb3IpO1xuICAgICAgICAgICAgdGhpcy5jb252ZXJ0Q29sb3JUb1ZhbHVlU3RyaW5nKGhzbCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldEN1cnJlbnRIdWVJbkNzcygpO1xuICAgIH1cblxuICAgIGNvbnZlcnRDb2xvclRvVmFsdWVTdHJpbmcoaHNsQ29sb3I6IElQZXBIc2xDb2xvcik6IHZvaWQge1xuICAgICAgICAvLyBSZWd1bGFyIGh1ZVxuICAgICAgICBpZiAoXG4gICAgICAgICAgICBoc2xDb2xvci5oID49IHRoaXMuY3VycmVudEh1ZU1pbiAmJlxuICAgICAgICAgICAgaHNsQ29sb3IuaCA8PSB0aGlzLmN1cnJlbnRIdWVNYXhcbiAgICAgICAgKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRIdWUgPSBoc2xDb2xvci5oO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgdGhpcy5jdXJyZW50SHVlTWluIDwgMCAmJlxuICAgICAgICAgICAgaHNsQ29sb3IuaCA+PSAwICYmXG4gICAgICAgICAgICBoc2xDb2xvci5oIDw9IDM2MFxuICAgICAgICApIHtcbiAgICAgICAgICAgIC8vIEZvciBtaW4gd2l0aCAtIChjaGFuZ2UgdG8gdGhlIG90aGVyIHNpZGUgb2YgdGhlIGNpcmNsZSlcbiAgICAgICAgICAgIGhzbENvbG9yLmggPSBoc2xDb2xvci5oIC0gMzYwO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgaHNsQ29sb3IuaCA+PSB0aGlzLmN1cnJlbnRIdWVNaW4gJiZcbiAgICAgICAgICAgICAgICBoc2xDb2xvci5oIDw9IHRoaXMuY3VycmVudEh1ZU1heFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SHVlID0gaHNsQ29sb3IuaDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY3VycmVudFNhdHVyYXRpb24gPVxuICAgICAgICAgICAgaHNsQ29sb3IucyA+PSB0aGlzLmN1cnJlbnRTYXR1cmF0aW9uTWluICYmXG4gICAgICAgICAgICBoc2xDb2xvci5zIDw9IHRoaXMuY3VycmVudFNhdHVyYXRpb25NYXhcbiAgICAgICAgICAgICAgICA/IGhzbENvbG9yLnNcbiAgICAgICAgICAgICAgICA6IHRoaXMuY3VycmVudFNhdHVyYXRpb247XG5cbiAgICAgICAgdGhpcy5jdXJyZW50TGlnaHRuZXNzID1cbiAgICAgICAgICAgIGhzbENvbG9yLmwgPj0gdGhpcy5jdXJyZW50TGlnaHRuZXNzTWluICYmXG4gICAgICAgICAgICBoc2xDb2xvci5sIDw9IHRoaXMuY3VycmVudExpZ2h0bmVzc01heFxuICAgICAgICAgICAgICAgID8gaHNsQ29sb3IubFxuICAgICAgICAgICAgICAgIDogdGhpcy5jdXJyZW50TGlnaHRuZXNzO1xuXG4gICAgICAgIC8vIFdyaXRlIHRoZSB2YWx1ZSAoaWYgaHVlIGlzIGNoYW5nZWQgdG8gdGhlIG90aGVyIHNpZGUgb2YgdGhlIGNpcmNsZSByZXR1cm4gaXQgYmFjaykuXG4gICAgICAgIGNvbnN0IGhzbCA9IHtcbiAgICAgICAgICAgIGg6IHRoaXMuY3VycmVudEh1ZSxcbiAgICAgICAgICAgIHM6IHRoaXMuY3VycmVudFNhdHVyYXRpb24sXG4gICAgICAgICAgICBsOiB0aGlzLmN1cnJlbnRMaWdodG5lc3MsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGF0YS52YWx1ZSA9IHRoaXMuY29sb3JTZXJ2aWNlLmNvbnZlcnRIc2xUb1N0cmluZ0hzbChoc2wpO1xuXG4gICAgICAgIC8vIENoZWNrIHRoZSBjb250cmFzdCByYXRpbyAtIHNldCB0aGUgY2xvc2VzdCBhY2Nlc3NpYmxlIGNvbG9yIHRvIGNvbXBsaWVudENvbG9yXG4gICAgICAgIC8vIGFuZCB1cGRhdGUgaXNVc2VyQ2hvb3NlQUFDb21wbGllbnRDb2xvci5cbiAgICAgICAgY29uc3QgYWRqdXN0YWJsZUNvbG9yID0gdGhpcy5jb2xvclNlcnZpY2UuaHNsMmhleChoc2wpO1xuICAgICAgICBjb25zdCBjbG9zZXN0SGV4ID0gdGhpcy5jb2xvclNlcnZpY2UuZmluZENsb3Nlc3RBY2Nlc3NpYmxlQ29sb3IoXG4gICAgICAgICAgICBhZGp1c3RhYmxlQ29sb3IsXG4gICAgICAgICAgICB0aGlzLmRhdGEudGV4dENvbG9yLFxuICAgICAgICAgICAgdGhpcy5kYXRhLmNvbnRyYXN0UmF0aW9cbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLmlzVXNlckNob29zZUFBQ29tcGxpZW50Q29sb3IgPSBhZGp1c3RhYmxlQ29sb3IgPT09IGNsb3Nlc3RIZXg7XG4gICAgICAgIHRoaXMuY29tcGxpZW50Q29sb3IgPSB0aGlzLmNvbG9yU2VydmljZS5jb252ZXJ0SHNsVG9TdHJpbmdIc2woXG4gICAgICAgICAgICB0aGlzLmNvbG9yU2VydmljZS5oZXgyaHNsKGNsb3Nlc3RIZXgpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgb25IdWVDaGFuZ2UoZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jb252ZXJ0Q29sb3JUb1ZhbHVlU3RyaW5nKHsgaDogZXZlbnQudmFsdWUgfSk7XG4gICAgICAgIHRoaXMuc2V0Q3VycmVudEh1ZUluQ3NzKCk7XG4gICAgfVxuXG4gICAgb25TYXR1cmF0aW9uQ2hhbmdlKGV2ZW50KTogdm9pZCB7XG4gICAgICAgIC8vIHRoaXMuY3VycmVudFNhdHVyYXRpb24gPSBldmVudC52YWx1ZTtcbiAgICAgICAgdGhpcy5jb252ZXJ0Q29sb3JUb1ZhbHVlU3RyaW5nKHsgczogZXZlbnQudmFsdWUgfSk7XG4gICAgfVxuXG4gICAgb25MaWdodG5lc3NDaGFuZ2UoZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgLy8gdGhpcy5jdXJyZW50TGlnaHRuZXNzID0gZXZlbnQudmFsdWU7XG4gICAgICAgIHRoaXMuY29udmVydENvbG9yVG9WYWx1ZVN0cmluZyh7XG4gICAgICAgICAgICBsOlxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudExpZ2h0bmVzc01heCAtXG4gICAgICAgICAgICAgICAgZXZlbnQudmFsdWUgK1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudExpZ2h0bmVzc01pbixcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25Db2xvclZhbHVlQ2hhbmdlKGV2ZW50KTogdm9pZCB7XG4gICAgICAgIHRoaXMuY29udmVydFZhbHVlU3RyaW5nVG9Db2xvcihldmVudC52YWx1ZSk7XG4gICAgfVxuXG4gICAgb25TYXZlKGV2ZW50KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGNvbG9yID0gdGhpcy5jaGVja0FBQ29tcGxpZW50XG4gICAgICAgICAgICA/IHRoaXMuY29tcGxpZW50Q29sb3JcbiAgICAgICAgICAgIDogdGhpcy5kYXRhLnZhbHVlO1xuXG4gICAgICAgIC8vIHRoaXMubm90aWZ5LmVtaXQoeyBrZXk6IHRoaXMua2V5LCB2YWx1ZTogY29sb3IgfSk7XG4gICAgICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKGNvbG9yKTtcbiAgICB9XG59XG4iXX0=
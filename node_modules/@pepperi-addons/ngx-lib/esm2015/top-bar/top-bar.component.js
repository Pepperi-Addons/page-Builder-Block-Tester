import { ChangeDetectorRef, ContentChild, ViewChild, } from '@angular/core';
import { Component, EventEmitter, Input, Output, } from '@angular/core';
import { PepCustomizationService, PepLayoutService, PepScreenSizeType, } from '@pepperi-addons/ngx-lib';
import { PepSearchComponent } from '@pepperi-addons/ngx-lib/search';
import { PepListActionsComponent, PepListChooserComponent, PepListSortingComponent, PepListTotalComponent, PepListViewsComponent, } from '@pepperi-addons/ngx-lib/list';
export class PepTopBarComponent {
    constructor(customizationService, layoutService, cdRef) {
        this.customizationService = customizationService;
        this.layoutService = layoutService;
        this.cdRef = cdRef;
        this.inline = false;
        this.title = null;
        this.footerStateChange = new EventEmitter();
        this.hasFooterContent = null;
        this.isHidden = true;
        this.searchIsOpenAndSmallDevice = false;
        this.PepScreenSizeType = PepScreenSizeType;
    }
    ngAfterViewInit() {
        var _a, _b, _c, _d, _e, _f;
        if (!this.inline) {
            this.hasFooterContent =
                ((_c = (_b = (_a = this.footerStartContent) === null || _a === void 0 ? void 0 : _a.nativeElement) === null || _b === void 0 ? void 0 : _b.children) === null || _c === void 0 ? void 0 : _c.length) > 0 ||
                    ((_f = (_e = (_d = this.footerEndContent) === null || _d === void 0 ? void 0 : _d.nativeElement) === null || _e === void 0 ? void 0 : _e.children) === null || _f === void 0 ? void 0 : _f.length) > 0;
        }
        this.layoutService.onResize$.subscribe((size) => {
            this.screenSize = size;
            this.setSearchIsOpenAndSmallDevice();
            if (!this.inline) {
                this.setFooterState();
            }
        });
        this.isHidden = false;
        this.cdRef.detectChanges();
    }
    ngAfterContentInit() {
        if (this.searchComp) {
            this.searchComp.stateChange
                .subscribe((searchStateChangeEvent) => {
                this.searchState = searchStateChangeEvent.state;
                this.setSearchIsOpenAndSmallDevice();
            })
                .unsubscribe();
        }
    }
    ngOnDestroy() {
        if (this.customizationService) {
            this.customizationService.hideFooter();
        }
    }
    setSearchIsOpenAndSmallDevice() {
        // check if search is open and the device size is small or extra small
        this.searchIsOpenAndSmallDevice =
            this.screenSize > PepScreenSizeType.SM &&
                this.searchState === 'open';
    }
    setFooterState() {
        const newFooterState = this.hasFooterContent && this.screenSize >= PepScreenSizeType.MD
            ? 'visible'
            : 'hidden';
        if (this.footerState !== newFooterState) {
            this.footerState = newFooterState;
            this.cdRef.detectChanges();
            this.footerStateChange.emit({ state: this.footerState });
            if (this.footerState === 'visible') {
                this.customizationService.showFooter();
            }
            else {
                this.customizationService.hideFooter();
            }
        }
    }
}
PepTopBarComponent.decorators = [
    { type: Component, args: [{
                selector: 'pep-top-bar',
                template: "<div pepRtlDirection [hidden]=\"isHidden\" class=\"pep-top-bar-container\" [ngClass]=\"{ inline: inline }\">\n    <div class=\"header-content\">\n        <div class=\"main-layout\">\n            <div class=\"content pep-border-bottom\">\n                <div class=\"left-container pep-spacing-element-negative\">\n                    <ng-container *ngTemplateOutlet=\"listActionsTemplate\"></ng-container>\n                    <ng-container *ngTemplateOutlet=\"titleTemplate\"></ng-container>\n                    <ng-container *ngTemplateOutlet=\"listChooserTemplate\"></ng-container>\n                    <ng-container *ngTemplateOutlet=\"leftContentTemplate\"></ng-container>\n                    <ng-container *ngTemplateOutlet=\"listTotalTemplate\"></ng-container>\n                </div>\n                <div class=\"pep-spacing-element\"></div>\n                <div class=\"right-container pep-spacing-element-negative\">\n                    <ng-container *ngTemplateOutlet=\"searchTemplate\"></ng-container>\n                    <ng-container *ngTemplateOutlet=\"sortingTemplate\"></ng-container>\n                    <ng-container *ngTemplateOutlet=\"viewsTemplate\"></ng-container>\n                    <ng-container *ngTemplateOutlet=\"rightContentTemplate\"></ng-container>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- hasFooterContent === null is for the first load to see if there is data in the (footer-start-content || footer-end-content). -->\n    <div *ngIf=\"hasFooterContent === null || (hasFooterContent && footerState === 'visible')\" class=\"footer\"\n        [style.height.rem]=\"customizationService.footerHeight\">\n        <div class=\"content pep-border-top\">\n            <div #footerStartContent class=\"left-container pep-spacing-element-negative flex-wrapper\">\n                <ng-content select=\"[footer-start-content]\"></ng-content>\n            </div>\n            <div #footerEndContent class=\"right-container pep-spacing-element-negative flex-wrapper\">\n                <ng-content select=\"[footer-end-content]\"></ng-content>\n            </div>\n        </div>\n        <!-- <ng-container *ngIf=\"showFooter && screenSize >= PepScreenSizeType.MD; then footerBlock; else noFooterBlock\">\n        </ng-container>\n        <ng-template #footerBlock>\n            {{ customizationService.showFooter() }}\n        </ng-template>\n        <ng-template #noFooterBlock>\n            {{ customizationService.hideFooter() }}\n        </ng-template> -->\n    </div>\n\n</div>\n\n<!-- Left side templates -->\n<ng-template #listActionsTemplate>\n    <div class=\"list-actions-wrapper\">\n        <ng-content *ngIf=\"!searchIsOpenAndSmallDevice\" select=\"pep-list-actions\"></ng-content>\n    </div>\n</ng-template>\n\n<ng-template #titleTemplate>\n    <div *ngIf=\"title?.length > 0\" class=\"pep-spacing-element title {{ inline ? 'title-md' : 'title-lg' }}\">\n        <span [title]=\"title\">{{ title }}</span>\n    </div>\n</ng-template>\n\n<ng-template #listChooserTemplate>\n    <div *ngIf=\"!searchIsOpenAndSmallDevice\" [ngClass]=\"{ 'pep-spacing-element': listChooserComp }\">\n        <ng-content select=\"pep-list-chooser\"></ng-content>\n    </div>\n</ng-template>\n\n<ng-template #leftContentTemplate>\n    <div *ngIf=\"!searchIsOpenAndSmallDevice\" class=\"flex-wrapper\">\n        <ng-content select=\"[header-start-content]\"></ng-content>\n    </div>\n</ng-template>\n\n<ng-template #listTotalTemplate>\n    <div *ngIf=\"!searchIsOpenAndSmallDevice\" [ngClass]=\"{ 'pep-spacing-element': listTotalComp }\">\n        <ng-content select=\"pep-list-total\"></ng-content>\n    </div>\n</ng-template>\n\n<!-- Right side templates -->\n<ng-template #searchTemplate>\n    <div [ngClass]=\"{ 'pep-spacing-element': searchComp }\">\n        <ng-content select=\"pep-search\"></ng-content>\n    </div>\n</ng-template>\n\n<ng-template #sortingTemplate>\n    <div *ngIf=\"!searchIsOpenAndSmallDevice\" [ngClass]=\"{ 'pep-spacing-element': listSortingComp }\">\n        <ng-content select=\"pep-list-sorting\"></ng-content>\n    </div>\n</ng-template>\n\n<ng-template #viewsTemplate>\n    <div *ngIf=\"!searchIsOpenAndSmallDevice\" [ngClass]=\"{ 'pep-spacing-element': listViewsComp }\" class=\"flex-wrapper\">\n        <ng-content select=\"pep-list-views\"></ng-content>\n    </div>\n</ng-template>\n\n<ng-template #rightContentTemplate>\n    <div *ngIf=\"!searchIsOpenAndSmallDevice\" class=\"flex-wrapper\">\n        <ng-content select=\"[header-end-content]\"></ng-content>\n    </div>\n</ng-template>",
                styles: [".pep-top-bar-container{display:grid;height:calc(1.5rem + .5rem + 2.5rem);height:calc(var(--pep-top-bar-spacing-top, 1.5rem) + var(--pep-top-bar-spacing-bottom, .5rem) + var(--pep-top-bar-field-height, 2.5rem));z-index:101}.pep-top-bar-container .title{display:inline-flex!important;align-items:center;justify-content:center}.pep-top-bar-container .header-content{height:calc(.5rem + 2.5rem);height:calc(var(--pep-top-bar-spacing-bottom, .5rem) + var(--pep-top-bar-field-height, 2.5rem));margin-top:1.5rem;margin-top:var(--pep-top-bar-spacing-top,1.5rem)}.pep-top-bar-container .header-content .main-layout{width:inherit;height:inherit;padding:0}.pep-top-bar-container .header-content .main-layout .content{display:flex;justify-content:space-between;height:inherit}.pep-top-bar-container .header-content .main-layout .content .left-container,.pep-top-bar-container .header-content .main-layout .content .right-container{height:inherit}.pep-top-bar-container .footer{position:fixed;bottom:0;left:0;right:0;height:4.5rem;height:var(--pep-footer-bar-height,4.5rem)}.pep-top-bar-container .footer .content{display:flex;justify-content:space-between;margin-inline:calc(1rem * 2);margin-inline:calc(var(--pep-spacing-lg, 1rem) * 2);padding-top:.75rem;padding-top:var(--pep-footer-bar-spacing-top,.75rem)}@media (max-width:599px){.pep-top-bar-container .footer .content{margin-inline:1rem;margin-inline:var(--pep-spacing-lg,1rem)}}.pep-top-bar-container .left-container{display:flex}.pep-top-bar-container .right-container{display:flex;justify-content:flex-end}.pep-top-bar-container .flex-wrapper ::ng-deep>*{display:flex}.pep-top-bar-container .list-actions-wrapper ::ng-deep.pep-button{margin-right:.25rem;margin-right:var(--pep-spacing-xs,.25rem);margin-left:.25rem;margin-left:var(--pep-spacing-xs,.25rem)}.pep-top-bar-container:not(.inline) .pep-button,.pep-top-bar-container:not(.inline) .pepperi-button,.pep-top-bar-container:not(.inline) ::ng-deep .pep-button,.pep-top-bar-container:not(.inline) ::ng-deep .pepperi-button{height:2.5rem;height:var(--pep-top-bar-field-height,2.5rem);line-height:2.5rem;line-height:var(--pep-top-bar-field-height,2.5rem)}.pep-top-bar-container.inline{position:inherit;height:calc(.5rem + 2.5rem);height:calc(var(--pep-top-bar-spacing-bottom, .5rem) + var(--pep-top-bar-field-height, 2.5rem));width:100%}.pep-top-bar-container.inline .header-content{margin-top:0;height:2.5rem;height:var(--pep-top-bar-field-height,2.5rem);padding:0;position:inherit;width:inherit}.pep-top-bar-container.inline .header-content .main-layout{width:inherit;height:inherit;padding:0}.pep-top-bar-container.inline .header-content .main-layout .content{height:inherit;margin:0}"]
            },] }
];
PepTopBarComponent.ctorParameters = () => [
    { type: PepCustomizationService },
    { type: PepLayoutService },
    { type: ChangeDetectorRef }
];
PepTopBarComponent.propDecorators = {
    inline: [{ type: Input }],
    title: [{ type: Input }],
    footerStateChange: [{ type: Output }],
    footerStartContent: [{ type: ViewChild, args: ['footerStartContent',] }],
    footerEndContent: [{ type: ViewChild, args: ['footerEndContent',] }],
    searchComp: [{ type: ContentChild, args: [PepSearchComponent,] }],
    listActionsComp: [{ type: ContentChild, args: [PepListActionsComponent,] }],
    listChooserComp: [{ type: ContentChild, args: [PepListChooserComponent,] }],
    listTotalComp: [{ type: ContentChild, args: [PepListTotalComponent,] }],
    listSortingComp: [{ type: ContentChild, args: [PepListSortingComponent,] }],
    listViewsComp: [{ type: ContentChild, args: [PepListViewsComponent,] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9wLWJhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtbGliL3RvcC1iYXIvdG9wLWJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVILGlCQUFpQixFQUNqQixZQUFZLEVBR1osU0FBUyxHQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFFSCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEdBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNILHVCQUF1QixFQUN2QixnQkFBZ0IsRUFDaEIsaUJBQWlCLEdBQ3BCLE1BQU0seUJBQXlCLENBQUM7QUFDakMsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDcEUsT0FBTyxFQUNILHVCQUF1QixFQUN2Qix1QkFBdUIsRUFDdkIsdUJBQXVCLEVBQ3ZCLHFCQUFxQixFQUNyQixxQkFBcUIsR0FDeEIsTUFBTSw4QkFBOEIsQ0FBQztBQWdCdEMsTUFBTSxPQUFPLGtCQUFrQjtJQTZCM0IsWUFDVyxvQkFBNkMsRUFDN0MsYUFBK0IsRUFDOUIsS0FBd0I7UUFGekIseUJBQW9CLEdBQXBCLG9CQUFvQixDQUF5QjtRQUM3QyxrQkFBYSxHQUFiLGFBQWEsQ0FBa0I7UUFDOUIsVUFBSyxHQUFMLEtBQUssQ0FBbUI7UUEvQjNCLFdBQU0sR0FBRyxLQUFLLENBQUM7UUFDZixVQUFLLEdBQVcsSUFBSSxDQUFDO1FBRzlCLHNCQUFpQixHQUE2QyxJQUFJLFlBQVksRUFBOEIsQ0FBQztRQWU3RyxxQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFDeEIsYUFBUSxHQUFHLElBQUksQ0FBQztRQUloQiwrQkFBMEIsR0FBRyxLQUFLLENBQUM7UUFFbkMsc0JBQWlCLEdBQUcsaUJBQWlCLENBQUM7SUFNbEMsQ0FBQztJQUVMLGVBQWU7O1FBQ1gsSUFBSSxDQUFDLElB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QyxxQkFBcUI7OEJBQ2xDLFlBQVksU0FBQyx1QkFBdUI7NEJBRXBDLFlBQVksU0FBQyxxQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEFmdGVyQ29udGVudEluaXQsXG4gICAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgQ29udGVudENoaWxkLFxuICAgIEVsZW1lbnRSZWYsXG4gICAgT25EZXN0cm95LFxuICAgIFZpZXdDaGlsZCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICAgIEFmdGVyVmlld0luaXQsXG4gICAgQ29tcG9uZW50LFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBJbnB1dCxcbiAgICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBQZXBDdXN0b21pemF0aW9uU2VydmljZSxcbiAgICBQZXBMYXlvdXRTZXJ2aWNlLFxuICAgIFBlcFNjcmVlblNpemVUeXBlLFxufSBmcm9tICdAcGVwcGVyaS1hZGRvbnMvbmd4LWxpYic7XG5pbXBvcnQgeyBQZXBTZWFyY2hDb21wb25lbnQgfSBmcm9tICdAcGVwcGVyaS1hZGRvbnMvbmd4LWxpYi9zZWFyY2gnO1xuaW1wb3J0IHtcbiAgICBQZXBMaXN0QWN0aW9uc0NvbXBvbmVudCxcbiAgICBQZXBMaXN0Q2hvb3NlckNvbXBvbmVudCxcbiAgICBQZXBMaXN0U29ydGluZ0NvbXBvbmVudCxcbiAgICBQZXBMaXN0VG90YWxDb21wb25lbnQsXG4gICAgUGVwTGlzdFZpZXdzQ29tcG9uZW50LFxufSBmcm9tICdAcGVwcGVyaS1hZGRvbnMvbmd4LWxpYi9saXN0JztcbmltcG9ydCB7IFBlcE1lbnVTdGF0ZVR5cGUgfSBmcm9tICdAcGVwcGVyaS1hZGRvbnMvbmd4LWxpYi9tZW51JztcbmltcG9ydCB7XG4gICAgSVBlcFNlYXJjaFN0YXRlQ2hhbmdlRXZlbnQsXG4gICAgUGVwU2VhcmNoU3RhdGVUeXBlLFxufSBmcm9tICdAcGVwcGVyaS1hZGRvbnMvbmd4LWxpYi9zZWFyY2gnO1xuaW1wb3J0IHtcbiAgICBJUGVwRm9vdGVyU3RhdGVDaGFuZ2VFdmVudCxcbiAgICBQZXBGb290ZXJTdGF0ZVR5cGUsXG59IGZyb20gJy4vdG9wLWJhci5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAncGVwLXRvcC1iYXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi90b3AtYmFyLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi90b3AtYmFyLmNvbXBvbmVudC5zY3NzJ10sXG59KVxuZXhwb3J0IGNsYXNzIFBlcFRvcEJhckNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveSB7XG4gICAgQElucHV0KCkgaW5saW5lID0gZmFsc2U7XG4gICAgQElucHV0KCkgdGl0bGU6IHN0cmluZyA9IG51bGw7XG5cbiAgICBAT3V0cHV0KClcbiAgICBmb290ZXJTdGF0ZUNoYW5nZTogRXZlbnRFbWl0dGVyPElQZXBGb290ZXJTdGF0ZUNoYW5nZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8SVBlcEZvb3RlclN0YXRlQ2hhbmdlRXZlbnQ+KCk7XG5cbiAgICBAVmlld0NoaWxkKCdmb290ZXJTdGFydENvbnRlbnQnKSBmb290ZXJTdGFydENvbnRlbnQ6IEVsZW1lbnRSZWY7XG4gICAgQFZpZXdDaGlsZCgnZm9vdGVyRW5kQ29udGVudCcpIGZvb3RlckVuZENvbnRlbnQ6IEVsZW1lbnRSZWY7XG5cbiAgICBAQ29udGVudENoaWxkKFBlcFNlYXJjaENvbXBvbmVudCkgc2VhcmNoQ29tcDogUGVwU2VhcmNoQ29tcG9uZW50O1xuICAgIEBDb250ZW50Q2hpbGQoUGVwTGlzdEFjdGlvbnNDb21wb25lbnQpXG4gICAgbGlzdEFjdGlvbnNDb21wOiBQZXBMaXN0QWN0aW9uc0NvbXBvbmVudDtcbiAgICBAQ29udGVudENoaWxkKFBlcExpc3RDaG9vc2VyQ29tcG9uZW50KVxuICAgIGxpc3RDaG9vc2VyQ29tcDogUGVwTGlzdENob29zZXJDb21wb25lbnQ7XG4gICAgQENvbnRlbnRDaGlsZChQZXBMaXN0VG90YWxDb21wb25lbnQpIGxpc3RUb3RhbENvbXA6IFBlcExpc3RUb3RhbENvbXBvbmVudDtcbiAgICBAQ29udGVudENoaWxkKFBlcExpc3RTb3J0aW5nQ29tcG9uZW50KVxuICAgIGxpc3RTb3J0aW5nQ29tcDogUGVwTGlzdFNvcnRpbmdDb21wb25lbnQ7XG4gICAgQENvbnRlbnRDaGlsZChQZXBMaXN0Vmlld3NDb21wb25lbnQpIGxpc3RWaWV3c0NvbXA6IFBlcExpc3RWaWV3c0NvbXBvbmVudDtcblxuICAgIGhhc0Zvb3RlckNvbnRlbnQgPSBudWxsO1xuICAgIGlzSGlkZGVuID0gdHJ1ZTtcbiAgICBzY3JlZW5TaXplOiBQZXBTY3JlZW5TaXplVHlwZTtcbiAgICAvLyBsaXN0QWN0aW9uc0lzVmlzaWJsZSA9IGZhbHNlO1xuICAgIHNlYXJjaFN0YXRlOiBQZXBTZWFyY2hTdGF0ZVR5cGU7XG4gICAgc2VhcmNoSXNPcGVuQW5kU21hbGxEZXZpY2UgPSBmYWxzZTtcbiAgICBmb290ZXJTdGF0ZTogUGVwRm9vdGVyU3RhdGVUeXBlO1xuICAgIFBlcFNjcmVlblNpemVUeXBlID0gUGVwU2NyZWVuU2l6ZVR5cGU7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHVibGljIGN1c3RvbWl6YXRpb25TZXJ2aWNlOiBQZXBDdXN0b21pemF0aW9uU2VydmljZSxcbiAgICAgICAgcHVibGljIGxheW91dFNlcnZpY2U6IFBlcExheW91dFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgY2RSZWY6IENoYW5nZURldGVjdG9yUmVmXG4gICAgKSB7IH1cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLmlubGluZSkge1xuICAgICAgICAgICAgdGhpcy5oYXNGb290ZXJDb250ZW50ID1cbiAgICAgICAgICAgICAgICB0aGlzLmZvb3RlclN0YXJ0Q29udGVudD8ubmF0aXZlRWxlbWVudD8uY2hpbGRyZW4/Lmxlbmd0aCA+IDAgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmZvb3RlckVuZENvbnRlbnQ/Lm5hdGl2ZUVsZW1lbnQ/LmNoaWxkcmVuPy5sZW5ndGggPiAwO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sYXlvdXRTZXJ2aWNlLm9uUmVzaXplJC5zdWJzY3JpYmUoKHNpemU6IFBlcFNjcmVlblNpemVUeXBlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNjcmVlblNpemUgPSBzaXplO1xuICAgICAgICAgICAgdGhpcy5zZXRTZWFyY2hJc09wZW5BbmRTbWFsbERldmljZSgpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuaW5saW5lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGb290ZXJTdGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmlzSGlkZGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2RSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoQ29tcCkge1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hDb21wLnN0YXRlQ2hhbmdlXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAgICAgKHNlYXJjaFN0YXRlQ2hhbmdlRXZlbnQ6IElQZXBTZWFyY2hTdGF0ZUNoYW5nZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFN0YXRlID0gc2VhcmNoU3RhdGVDaGFuZ2VFdmVudC5zdGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U2VhcmNoSXNPcGVuQW5kU21hbGxEZXZpY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5jdXN0b21pemF0aW9uU2VydmljZSkge1xuICAgICAgICAgICAgdGhpcy5jdXN0b21pemF0aW9uU2VydmljZS5oaWRlRm9vdGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFNlYXJjaElzT3BlbkFuZFNtYWxsRGV2aWNlKCk6IHZvaWQge1xuICAgICAgICAvLyBjaGVjayBpZiBzZWFyY2ggaXMgb3BlbiBhbmQgdGhlIGRldmljZSBzaXplIGlzIHNtYWxsIG9yIGV4dHJhIHNtYWxsXG4gICAgICAgIHRoaXMuc2VhcmNoSXNPcGVuQW5kU21hbGxEZXZpY2UgPVxuICAgICAgICAgICAgdGhpcy5zY3JlZW5TaXplID4gUGVwU2NyZWVuU2l6ZVR5cGUuU00gJiZcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoU3RhdGUgPT09ICdvcGVuJztcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldEZvb3RlclN0YXRlKCkge1xuICAgICAgICBjb25zdCBuZXdGb290ZXJTdGF0ZTogUGVwRm9vdGVyU3RhdGVUeXBlID1cbiAgICAgICAgICAgIHRoaXMuaGFzRm9vdGVyQ29udGVudCAmJiB0aGlzLnNjcmVlblNpemUgPj0gUGVwU2NyZWVuU2l6ZVR5cGUuTURcbiAgICAgICAgICAgICAgICA/ICd2aXNpYmxlJ1xuICAgICAgICAgICAgICAgIDogJ2hpZGRlbic7XG5cbiAgICAgICAgaWYgKHRoaXMuZm9vdGVyU3RhdGUgIT09IG5ld0Zvb3RlclN0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLmZvb3RlclN0YXRlID0gbmV3Rm9vdGVyU3RhdGU7XG4gICAgICAgICAgICB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgICAgIHRoaXMuZm9vdGVyU3RhdGVDaGFuZ2UuZW1pdCh7IHN0YXRlOiB0aGlzLmZvb3RlclN0YXRlIH0pO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5mb290ZXJTdGF0ZSA9PT0gJ3Zpc2libGUnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXN0b21pemF0aW9uU2VydmljZS5zaG93Rm9vdGVyKClcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXN0b21pemF0aW9uU2VydmljZS5oaWRlRm9vdGVyKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
import { Injectable, Optional } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { distinctUntilChanged } from 'rxjs/operators';
import { TranslateService } from '@ngx-translate/core';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
// Const BIDI_RTL_LANGS Array
// BIDI_RTL_LANGS ref: http://en.wikipedia.org/wiki/Right-to-left
// Table of scripts in Unicode: https://en.wikipedia.org/wiki/Script_(Unicode)
const _BIDI_RTL_LANGS = [
    'ae' /* Avestan */,
    'ar' /* 'العربية', Arabic */,
    'arc' /* Aramaic */,
    'bcc' /* 'بلوچی مکرانی', Southern Balochi */,
    'bqi' /* 'بختياري', Bakthiari */,
    'ckb' /* 'Soranî / کوردی', Sorani */,
    'dv' /* Dhivehi */,
    'fa' /* 'فارسی', Persian */,
    'glk' /* 'گیلکی', Gilaki */,
    'he' /* 'עברית', Hebrew */,
    'ku' /* 'Kurdî / كوردی', Kurdish */,
    'mzn' /* 'مازِرونی', Mazanderani */,
    'nqo' /* N'Ko */,
    'pnb' /* 'پنجابی', Western Punjabi */,
    'ps' /* 'پښتو', Pashto, */,
    'sd' /* 'سنڌي', Sindhi */,
    'ug' /* 'Uyghurche / ئۇيغۇرچە', Uyghur */,
    'ur' /* 'اردو', Urdu */,
    'yi' /* 'ייִדיש', Yiddish */,
];
export var PepScreenSizeType;
(function (PepScreenSizeType) {
    PepScreenSizeType[PepScreenSizeType["XL"] = 0] = "XL";
    PepScreenSizeType[PepScreenSizeType["LG"] = 1] = "LG";
    PepScreenSizeType[PepScreenSizeType["MD"] = 2] = "MD";
    PepScreenSizeType[PepScreenSizeType["SM"] = 3] = "SM";
    PepScreenSizeType[PepScreenSizeType["XS"] = 4] = "XS";
})(PepScreenSizeType || (PepScreenSizeType = {}));
// export type PepScreenSizeType = 'xl' | 'lg' | 'md' | 'sm' | 'xs';
export class PepLayoutService {
    constructor(translate = null) {
        this.translate = translate;
        this.documentMouseoverListener = (event) => {
            this.deviceHasMouseSubject.next(true);
            this.deviceHasMouseSubject.complete();
            document.removeEventListener('mouseover', this.documentMouseoverListener, false);
        };
        this.resizeSubject = new BehaviorSubject(PepScreenSizeType.LG);
        this.deviceHasMouseSubject = new BehaviorSubject(false);
        document.addEventListener('mouseover', this.documentMouseoverListener, false);
        // document.addEventListener('touchstart', this._documentTouchstartListener, false);
    }
    get onResize$() {
        return this.resizeSubject.asObservable().pipe(distinctUntilChanged());
    }
    get onMouseOver$() {
        return this.deviceHasMouseSubject
            .asObservable()
            .pipe(distinctUntilChanged());
    }
    // private _documentTouchstartListener = (event: TouchEvent) => {
    //     debugger;
    //     this.isTouchDevice = true;
    //     document.removeEventListener('touchstart', this._documentTouchstartListener, false);
    // }
    /**
     * Set the current screen size.
     * @param size The size to change to.
     */
    onResize(size) {
        this.resizeSubject.next(size);
    }
    getDeviceHasMouse() {
        return this.deviceHasMouseSubject.getValue();
    }
    getOrintation() {
        if (window.innerHeight > window.innerWidth) {
            return 'portrait';
        }
        else {
            return 'landscape';
        }
    }
    getScreenWidth() {
        let retVal = 250.0;
        switch (this.resizeSubject.getValue()) {
            case PepScreenSizeType.XS: {
                retVal = this.getOrintation() === 'landscape' ? 130.0 : 65.0;
                break;
            }
            case PepScreenSizeType.SM:
            case PepScreenSizeType.MD: {
                retVal = this.getOrintation() === 'landscape' ? 220.0 : 140.0;
                break;
            }
            case PepScreenSizeType.LG:
            case PepScreenSizeType.XL: {
                retVal = this.getOrintation() === 'landscape' ? 400.0 : 250.0;
                break;
            }
        }
        return retVal;
    }
    getScreenHeight() {
        let retVal = 250.0;
        switch (this.resizeSubject.getValue()) {
            case PepScreenSizeType.XS: {
                retVal = this.getOrintation() === 'landscape' ? 65.0 : 130.0;
                break;
            }
            case PepScreenSizeType.SM:
            case PepScreenSizeType.MD: {
                retVal = this.getOrintation() === 'landscape' ? 140.0 : 220.0;
                break;
            }
            case PepScreenSizeType.LG:
            case PepScreenSizeType.XL: {
                retVal = this.getOrintation() === 'landscape' ? 250.0 : 400.0;
                break;
            }
        }
        return retVal;
    }
    getScreenHeightPx() {
        return (window.innerHeight ||
            document.documentElement.clientHeight ||
            document.body.clientHeight);
    }
    getScreenWidthPx() {
        return (window.innerWidth ||
            document.documentElement.clientWidth ||
            document.body.clientWidth);
    }
    getScrollbarWidth() {
        // Creating invisible container
        const outer = document.createElement('div');
        outer.style.visibility = 'hidden';
        outer.style.overflow = 'scroll'; // forcing scrollbar to appear
        // outer.style.msOverflowStyle = 'scrollbar'; // needed for WinJS apps
        document.body.appendChild(outer);
        // Creating inner element and placing it in the container
        const inner = document.createElement('div');
        outer.appendChild(inner);
        // Calculating difference between container's full width and the child width
        const scrollbarWidth = (outer.offsetWidth - inner.offsetWidth);
        // Removing temporary elements from the DOM
        outer.parentNode.removeChild(outer);
        return scrollbarWidth;
    }
    getCurrentLanguage() {
        var _a;
        return ((_a = this.translate) === null || _a === void 0 ? void 0 : _a.getBrowserCultureLang()) || navigator.language;
    }
    isRtl() {
        const userLang = this.getCurrentLanguage();
        const isRtl = _BIDI_RTL_LANGS.indexOf(userLang) >= 0;
        return isRtl;
    }
}
PepLayoutService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PepLayoutService_Factory() { return new PepLayoutService(i0.ɵɵinject(i1.TranslateService, 8)); }, token: PepLayoutService, providedIn: "root" });
PepLayoutService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
PepLayoutService.ctorParameters = () => [
    { type: TranslateService, decorators: [{ type: Optional }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF5b3V0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtbGliL3NyYy9jb3JlL2xheW91dC9sYXlvdXQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQWMsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDOzs7QUFFdkQsNkJBQTZCO0FBQzdCLGlFQUFpRTtBQUNqRSw4RUFBOEU7QUFDOUUsTUFBTSxlQUFlLEdBQUc7SUFDcEIsSUFBSSxDQUFDLGFBQWE7SUFDbEIsSUFBSSxDQUFDLHVCQUF1QjtJQUM1QixLQUFLLENBQUMsYUFBYTtJQUNuQixLQUFLLENBQUMsc0NBQXNDO0lBQzVDLEtBQUssQ0FBQywwQkFBMEI7SUFDaEMsS0FBSyxDQUFDLDhCQUE4QjtJQUNwQyxJQUFJLENBQUMsYUFBYTtJQUNsQixJQUFJLENBQUMsc0JBQXNCO0lBQzNCLEtBQUssQ0FBQyxxQkFBcUI7SUFDM0IsSUFBSSxDQUFDLHFCQUFxQjtJQUMxQixJQUFJLENBQUMsOEJBQThCO0lBQ25DLEtBQUssQ0FBQyw2QkFBNkI7SUFDbkMsS0FBSyxDQUFDLFVBQVU7SUFDaEIsS0FBSyxDQUFDLCtCQUErQjtJQUNyQyxJQUFJLENBQUMscUJBQXFCO0lBQzFCLElBQUksQ0FBQyxvQkFBb0I7SUFDekIsSUFBSSxDQUFDLG9DQUFvQztJQUN6QyxJQUFJLENBQUMsa0JBQWtCO0lBQ3ZCLElBQUksQ0FBQyx1QkFBdUI7Q0FDL0IsQ0FBQztBQUlGLE1BQU0sQ0FBTixJQUFZLGlCQU1YO0FBTkQsV0FBWSxpQkFBaUI7SUFDekIscURBQUUsQ0FB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OlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGlzdGluY3RVbnRpbENoYW5nZWQgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5cbi8vIENvbnN0IEJJRElfUlRMX0xBTkdTIEFycmF5XG4vLyBCSURJX1JUTF9MQU5HUyByZWY6IGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUmlnaHQtdG8tbGVmdFxuLy8gVGFibGUgb2Ygc2NyaXB0cyBpbiBVbmljb2RlOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TY3JpcHRfKFVuaWNvZGUpXG5jb25zdCBfQklESV9SVExfTEFOR1MgPSBbXG4gICAgJ2FlJyAvKiBBdmVzdGFuICovLFxuICAgICdhcicgLyogJ9in2YTYudix2KjZitipJywgQXJhYmljICovLFxuICAgICdhcmMnIC8qIEFyYW1haWMgKi8sXG4gICAgJ2JjYycgLyogJ9io2YTZiNqG24wg2YXaqdix2KfZhtuMJywgU291dGhlcm4gQmFsb2NoaSAqLyxcbiAgICAnYnFpJyAvKiAn2KjYrtiq2YrYp9ix2YonLCBCYWt0aGlhcmkgKi8sXG4gICAgJ2NrYicgLyogJ1NvcmFuw64gLyDaqdmI2LHYr9uMJywgU29yYW5pICovLFxuICAgICdkdicgLyogRGhpdmVoaSAqLyxcbiAgICAnZmEnIC8qICfZgdin2LHYs9uMJywgUGVyc2lhbiAqLyxcbiAgICAnZ2xrJyAvKiAn2q/bjNmE2qnbjCcsIEdpbGFraSAqLyxcbiAgICAnaGUnIC8qICfXoteR16jXmdeqJywgSGVicmV3ICovLFxuICAgICdrdScgLyogJ0t1cmTDriAvINmD2YjYsdiv24wnLCBLdXJkaXNoICovLFxuICAgICdtem4nIC8qICfZhdin2LLZkNix2YjZhtuMJywgTWF6YW5kZXJhbmkgKi8sXG4gICAgJ25xbycgLyogTidLbyAqLyxcbiAgICAncG5iJyAvKiAn2b7Zhtis2KfYqNuMJywgV2VzdGVybiBQdW5qYWJpICovLFxuICAgICdwcycgLyogJ9m+2prYqtmIJywgUGFzaHRvLCAqLyxcbiAgICAnc2QnIC8qICfYs9mG2ozZiicsIFNpbmRoaSAqLyxcbiAgICAndWcnIC8qICdVeWdodXJjaGUgLyDYptuH2YrYutuH2LHahtuVJywgVXlnaHVyICovLFxuICAgICd1cicgLyogJ9in2LHYr9mIJywgVXJkdSAqLyxcbiAgICAneWknIC8qICfXmdeZ1rTXk9eZ16knLCBZaWRkaXNoICovLFxuXTtcblxuZXhwb3J0IHR5cGUgUGVwT3JpZW50YXRpb25UeXBlID0gJ2xhbmRzY2FwZScgfCAncG9ydHJhaXQnO1xuXG5leHBvcnQgZW51bSBQZXBTY3JlZW5TaXplVHlwZSB7XG4gICAgWEwsXG4gICAgTEcsXG4gICAgTUQsXG4gICAgU00sXG4gICAgWFMsXG59XG4vLyBleHBvcnQgdHlwZSBQZXBTY3JlZW5TaXplVHlwZSA9ICd4bCcgfCAnbGcnIHwgJ21kJyB8ICdzbScgfCAneHMnO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBQZXBMYXlvdXRTZXJ2aWNlIHtcbiAgICBwcml2YXRlIHJlc2l6ZVN1YmplY3Q6IEJlaGF2aW9yU3ViamVjdDxQZXBTY3JlZW5TaXplVHlwZT47XG4gICAgcHJpdmF0ZSBkZXZpY2VIYXNNb3VzZVN1YmplY3Q6IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPjtcblxuICAgIGdldCBvblJlc2l6ZSQoKTogT2JzZXJ2YWJsZTxQZXBTY3JlZW5TaXplVHlwZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXNpemVTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpLnBpcGUoZGlzdGluY3RVbnRpbENoYW5nZWQoKSk7XG4gICAgfVxuXG4gICAgZ2V0IG9uTW91c2VPdmVyJCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGV2aWNlSGFzTW91c2VTdWJqZWN0XG4gICAgICAgICAgICAuYXNPYnNlcnZhYmxlKClcbiAgICAgICAgICAgIC5waXBlKGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkpO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlID0gbnVsbCkge1xuICAgICAgICB0aGlzLnJlc2l6ZVN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KFBlcFNjcmVlblNpemVUeXBlLkxHKTtcblxuICAgICAgICB0aGlzLmRldmljZUhhc01vdXNlU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3QoZmFsc2UpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgJ21vdXNlb3ZlcicsXG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50TW91c2VvdmVyTGlzdGVuZXIsXG4gICAgICAgICAgICBmYWxzZVxuICAgICAgICApO1xuICAgICAgICAvLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5fZG9jdW1lbnRUb3VjaHN0YXJ0TGlzdGVuZXIsIGZhbHNlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGRvY3VtZW50TW91c2VvdmVyTGlzdGVuZXIgPSAoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgdGhpcy5kZXZpY2VIYXNNb3VzZVN1YmplY3QubmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5kZXZpY2VIYXNNb3VzZVN1YmplY3QuY29tcGxldGUoKTtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICdtb3VzZW92ZXInLFxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudE1vdXNlb3Zlckxpc3RlbmVyLFxuICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgLy8gcHJpdmF0ZSBfZG9jdW1lbnRUb3VjaHN0YXJ0TGlzdGVuZXIgPSAoZXZlbnQ6IFRvdWNoRXZlbnQpID0+IHtcbiAgICAvLyAgICAgZGVidWdnZXI7XG4gICAgLy8gICAgIHRoaXMuaXNUb3VjaERldmljZSA9IHRydWU7XG4gICAgLy8gICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLl9kb2N1bWVudFRvdWNoc3RhcnRMaXN0ZW5lciwgZmFsc2UpO1xuICAgIC8vIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgY3VycmVudCBzY3JlZW4gc2l6ZS5cbiAgICAgKiBAcGFyYW0gc2l6ZSBUaGUgc2l6ZSB0byBjaGFuZ2UgdG8uXG4gICAgICovXG4gICAgb25SZXNpemUoc2l6ZTogUGVwU2NyZWVuU2l6ZVR5cGUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yZXNpemVTdWJqZWN0Lm5leHQoc2l6ZSk7XG4gICAgfVxuXG4gICAgZ2V0RGV2aWNlSGFzTW91c2UoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRldmljZUhhc01vdXNlU3ViamVjdC5nZXRWYWx1ZSgpO1xuICAgIH1cblxuICAgIGdldE9yaW50YXRpb24oKTogUGVwT3JpZW50YXRpb25UeXBlIHtcbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCA+IHdpbmRvdy5pbm5lcldpZHRoKSB7XG4gICAgICAgICAgICByZXR1cm4gJ3BvcnRyYWl0JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAnbGFuZHNjYXBlJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFNjcmVlbldpZHRoKCk6IG51bWJlciB7XG4gICAgICAgIGxldCByZXRWYWwgPSAyNTAuMDtcbiAgICAgICAgc3dpdGNoICh0aGlzLnJlc2l6ZVN1YmplY3QuZ2V0VmFsdWUoKSkge1xuICAgICAgICAgICAgY2FzZSBQZXBTY3JlZW5TaXplVHlwZS5YUzoge1xuICAgICAgICAgICAgICAgIHJldFZhbCA9IHRoaXMuZ2V0T3JpbnRhdGlvbigpID09PSAnbGFuZHNjYXBlJyA/IDEzMC4wIDogNjUuMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgUGVwU2NyZWVuU2l6ZVR5cGUuU006XG4gICAgICAgICAgICBjYXNlIFBlcFNjcmVlblNpemVUeXBlLk1EOiB7XG4gICAgICAgICAgICAgICAgcmV0VmFsID0gdGhpcy5nZXRPcmludGF0aW9uKCkgPT09ICdsYW5kc2NhcGUnID8gMjIwLjAgOiAxNDAuMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgUGVwU2NyZWVuU2l6ZVR5cGUuTEc6XG4gICAgICAgICAgICBjYXNlIFBlcFNjcmVlblNpemVUeXBlLlhMOiB7XG4gICAgICAgICAgICAgICAgcmV0VmFsID0gdGhpcy5nZXRPcmludGF0aW9uKCkgPT09ICdsYW5kc2NhcGUnID8gNDAwLjAgOiAyNTAuMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0VmFsO1xuICAgIH1cblxuICAgIGdldFNjcmVlbkhlaWdodCgpOiBudW1iZXIge1xuICAgICAgICBsZXQgcmV0VmFsID0gMjUwLjA7XG4gICAgICAgIHN3aXRjaCAodGhpcy5yZXNpemVTdWJqZWN0LmdldFZhbHVlKCkpIHtcbiAgICAgICAgICAgIGNhc2UgUGVwU2NyZWVuU2l6ZVR5cGUuWFM6IHtcbiAgICAgICAgICAgICAgICByZXRWYWwgPSB0aGlzLmdldE9yaW50YXRpb24oKSA9PT0gJ2xhbmRzY2FwZScgPyA2NS4wIDogMTMwLjA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFBlcFNjcmVlblNpemVUeXBlLlNNOlxuICAgICAgICAgICAgY2FzZSBQZXBTY3JlZW5TaXplVHlwZS5NRDoge1xuICAgICAgICAgICAgICAgIHJldFZhbCA9IHRoaXMuZ2V0T3JpbnRhdGlvbigpID09PSAnbGFuZHNjYXBlJyA/IDE0MC4wIDogMjIwLjA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFBlcFNjcmVlblNpemVUeXBlLkxHOlxuICAgICAgICAgICAgY2FzZSBQZXBTY3JlZW5TaXplVHlwZS5YTDoge1xuICAgICAgICAgICAgICAgIHJldFZhbCA9IHRoaXMuZ2V0T3JpbnRhdGlvbigpID09PSAnbGFuZHNjYXBlJyA/IDI1MC4wIDogNDAwLjA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldFZhbDtcbiAgICB9XG5cbiAgICBnZXRTY3JlZW5IZWlnaHRQeCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgd2luZG93LmlubmVySGVpZ2h0IHx8XG4gICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGdldFNjcmVlbldpZHRoUHgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIHdpbmRvdy5pbm5lcldpZHRoIHx8XG4gICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHxcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGhcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRTY3JvbGxiYXJXaWR0aCgpIHtcbiAgICAgICAgLy8gQ3JlYXRpbmcgaW52aXNpYmxlIGNvbnRhaW5lclxuICAgICAgICBjb25zdCBvdXRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBvdXRlci5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XG4gICAgICAgIG91dGVyLnN0eWxlLm92ZXJmbG93ID0gJ3Njcm9sbCc7IC8vIGZvcmNpbmcgc2Nyb2xsYmFyIHRvIGFwcGVhclxuICAgICAgICAvLyBvdXRlci5zdHlsZS5tc092ZXJmbG93U3R5bGUgPSAnc2Nyb2xsYmFyJzsgLy8gbmVlZGVkIGZvciBXaW5KUyBhcHBzXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3V0ZXIpO1xuXG4gICAgICAgIC8vIENyZWF0aW5nIGlubmVyIGVsZW1lbnQgYW5kIHBsYWNpbmcgaXQgaW4gdGhlIGNvbnRhaW5lclxuICAgICAgICBjb25zdCBpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBvdXRlci5hcHBlbmRDaGlsZChpbm5lcik7XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRpbmcgZGlmZmVyZW5jZSBiZXR3ZWVuIGNvbnRhaW5lcidzIGZ1bGwgd2lkdGggYW5kIHRoZSBjaGlsZCB3aWR0aFxuICAgICAgICBjb25zdCBzY3JvbGxiYXJXaWR0aCA9IChvdXRlci5vZmZzZXRXaWR0aCAtIGlubmVyLm9mZnNldFdpZHRoKTtcblxuICAgICAgICAvLyBSZW1vdmluZyB0ZW1wb3JhcnkgZWxlbWVudHMgZnJvbSB0aGUgRE9NXG4gICAgICAgIG91dGVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob3V0ZXIpO1xuXG4gICAgICAgIHJldHVybiBzY3JvbGxiYXJXaWR0aDtcbiAgICB9XG5cbiAgICBnZXRDdXJyZW50TGFuZ3VhZ2UoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlPy5nZXRCcm93c2VyQ3VsdHVyZUxhbmcoKSB8fCBuYXZpZ2F0b3IubGFuZ3VhZ2U7XG4gICAgfVxuXG4gICAgaXNSdGwoKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IHVzZXJMYW5nID0gdGhpcy5nZXRDdXJyZW50TGFuZ3VhZ2UoKTtcbiAgICAgICAgY29uc3QgaXNSdGwgPSBfQklESV9SVExfTEFOR1MuaW5kZXhPZih1c2VyTGFuZykgPj0gMDtcblxuICAgICAgICByZXR1cm4gaXNSdGw7XG4gICAgfVxufVxuIl19
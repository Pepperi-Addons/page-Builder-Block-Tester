import { Component } from '@angular/core';
import { BaseFilterComponent } from '../common/model/base-filter-component';
import { PepSmartFilterOperators, PepSmartFilterOperatorUnits, } from '../common/model/operator';
import { Validators } from '@angular/forms';
export class PepDateFilterComponent extends BaseFilterComponent {
    constructor() {
        super(...arguments);
        this.PepSmartFilterOperators = PepSmartFilterOperators;
        this.chooseTimeOptions = [];
        this.chooseTimeUnitOptions = [];
    }
    // Override
    getDefaultOperator() {
        return PepSmartFilterOperators.InTheLast;
    }
    // Override
    getDefaultOperatorUnit() {
        if (this.operator === PepSmartFilterOperators.InTheLast ||
            this.operator === PepSmartFilterOperators.NotInTheLast ||
            this.operator === PepSmartFilterOperators.DueIn ||
            this.operator === PepSmartFilterOperators.NotDueIn) {
            return PepSmartFilterOperatorUnits.Months;
        }
        else {
            return undefined;
        }
    }
    // Override
    getFilterValue() {
        const filterValue = {
            first: this.firstControl.value,
        };
        if (this.operator === PepSmartFilterOperators.DateRange) {
            filterValue['second'] = this.secondControl.value;
        }
        return filterValue;
    }
    // Override
    loadOperatorsOptions() {
        this.chooseTimeOptions = this.operators.map((operator) => {
            return {
                key: operator.id,
                value: this.translate.instant(`${this.OPERATORS_TRANSLATION_PREFIX}.${operator.name}`),
            };
        });
        this.chooseTimeUnitOptions = this.operatorUnits.map((operatorUnit) => {
            return {
                key: operatorUnit.id,
                value: this.translate.instant(`${this.OPERATOR_UNITS_TRANSLATION_PREFIX}.${operatorUnit.name}`),
            };
        });
    }
    // Override
    setFieldsStateAndValidators() {
        this.firstControl.enable();
        if (this.operator === PepSmartFilterOperators.DateRange) {
            this.firstControl.setValidators(Validators.required);
            this.secondControl.enable();
            this.secondControl.setValidators(Validators.required);
        }
        else if (this.operator === PepSmartFilterOperators.InTheLast ||
            this.operator === PepSmartFilterOperators.NotInTheLast ||
            this.operator === PepSmartFilterOperators.DueIn ||
            this.operator === PepSmartFilterOperators.NotDueIn) {
            this.firstControl.setValidators([
                Validators.required,
                this.validator.numberValidator(),
            ]);
            this.secondControl.disable();
        }
        else {
            // Disable 'first' field.
            if (this.operator === PepSmartFilterOperators.Today ||
                this.operator === PepSmartFilterOperators.ThisWeek ||
                this.operator === PepSmartFilterOperators.ThisMonth ||
                this.operator === PepSmartFilterOperators.IsEmpty ||
                this.operator === PepSmartFilterOperators.IsNotEmpty) {
                this.firstControl.disable();
            }
            // Default disable 'second' field.
            super.setFieldsStateAndValidators();
        }
    }
    onOperatorChanged(value) {
        const operator = Object.values(PepSmartFilterOperators).find((operator) => operator.id === value);
        this.operator = operator;
        this.operatorUnit = this.getDefaultOperatorUnit();
    }
    onTimeUnitChanged(value) {
        const operatorUnit = Object.values(PepSmartFilterOperatorUnits).find((operatorUnit) => operatorUnit.id === value);
        this.operatorUnit = operatorUnit;
    }
}
PepDateFilterComponent.decorators = [
    { type: Component, args: [{
                selector: 'pep-date-filter',
                template: "<div [formGroup]=\"form\">\n    <ng-container>\n        <pep-select [key]=\"'timeOperator'\" [value]=\"operator.id\" [label]=\"'SMART_FILTERS.CHOOSE_TIME' | translate\"\n            [emptyOption]=\"false\" [options]=\"chooseTimeOptions\" (valueChange)=\"onOperatorChanged($event)\">\n        </pep-select>\n    </ng-container>\n\n    <div *ngIf=\"operator === PepSmartFilterOperators.InTheLast ||\n                operator === PepSmartFilterOperators.NotInTheLast ||\n                operator === PepSmartFilterOperators.DueIn ||\n                operator === PepSmartFilterOperators.NotDueIn\" fxLayout=\"row\" fxLayout.xs=\"column\" fxLayoutGap=\"1rem\">\n        <!-- Amount -->\n        <pep-textbox [form]=\"form\" [key]=\"firstControlKey\" [label]=\"'SMART_FILTERS.AMOUNT' | translate\"\n            [renderError]=\"false\" fxFlex=\"50%\" [type]=\"'int'\" [formattedValue]=\"firstControl.value\"\n            [value]=\"firstControl.value\">\n        </pep-textbox>\n        <!-- Time unit -->\n        <pep-select [form]=\"form\" [key]=\"'timeUnit'\" [value]=\"operatorUnit?.id\"\n            [label]=\"'SMART_FILTERS.TIME_UNIT' | translate\" fxFlex=\"50%\" [emptyOption]=\"false\"\n            [options]=\"chooseTimeUnitOptions\" (valueChange)=\"onTimeUnitChanged($event)\">\n        </pep-select>\n    </div>\n    <div pepRtlDirection *ngIf=\"operator === PepSmartFilterOperators.DateRange\" fxLayout=\"row\" fxLayout.xs=\"column\"\n        fxLayoutGap=\"1rem\">\n        <!-- Start date -->\n        <pep-date [form]=\"form\" [key]=\"firstControlKey\" [label]=\"'SMART_FILTERS.START_DATE' | translate\"\n            [renderError]=\"false\" fxFlex=\"50%\" [type]=\"field.type === 'date' ? 'date' : 'datetime'\"\n            [value]=\"firstControl.value\" [maxDateValue]=\"secondControl.value\">\n        </pep-date>\n        <!-- End date -->\n        <pep-date [form]=\"form\" [key]=\"secondControlKey\" [label]=\"'SMART_FILTERS.END_DATE' | translate\"\n            [renderError]=\"false\" fxFlex=\"50%\" [type]=\"field.type === 'date' ? 'date' : 'datetime'\"\n            [value]=\"secondControl.value\" [minDateValue]=\"firstControl.value\">\n        </pep-date>\n    </div>\n    <ng-container *ngIf=\"operator === PepSmartFilterOperators.On\">\n        <!-- Choose a date -->\n        <pep-date [form]=\"form\" [key]=\"firstControlKey\" [label]=\"'SMART_FILTERS.CHOOSE_DATE' | translate\"\n            [renderError]=\"false\" [type]=\"field.type === 'date' ? 'date' : 'datetime'\" [value]=\"firstControl.value\">\n        </pep-date>\n    </ng-container>\n</div>",
                styles: [""]
            },] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1maWx0ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWxpYi9zbWFydC1maWx0ZXJzL2RhdGUtZmlsdGVyL2RhdGUtZmlsdGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQzVFLE9BQU8sRUFHSCx1QkFBdUIsRUFDdkIsMkJBQTJCLEdBQzlCLE1BQU0sMEJBQTBCLENBQUM7QUFFbEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBUTVDLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxtQkFBbUI7SUFML0Q7O1FBTUksNEJBQXVCLEdBQUcsdUJBQXVCLENBQUM7UUFDbEQsc0JBQWlCLEdBQXNCLEVBQUUsQ0FBQztRQUMxQywwQkFBcUIsR0FBc0IsRUFBRSxDQUFDO0lBd0dsRCxDQUFDO0lBdEdHLFdBQVc7SUFDWCxrQkFBa0I7UUFDZCxPQUFPLHVCQUF1QixDQUFDLFNBQVMsQ0FBQztJQUM3QyxDQUFDO0lBRUQsV0FBVztJQUNYLHNCQUFzQjtRQUNsQixJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssdUJBQXVCLENBQUMsU0FBUztZQUNuRCxJQUFJLENBQUMsUUFBUSxLQUFLLHVCQUF1QixDQUFDLFlBQVk7WUFDdEQsSUFBSSxDQUFDLFFBQVEsS0FBSyx1QkFBdUIsQ0FBQyxLQUFLO1lBQy9DLElBQUksQ0FBQyxRQUFRLEtBQUssdUJBQXVCLENBQUMsUUFBUSxFQUFFO1lBQ3BELE9BQU8sMkJBQTJCLENBQUMsTUFBTSxDQUFDO1NBQzdDO2FBQU07WUFDSCxPQUFPLFNBQVMsQ0FBQztTQUNwQjtJQUNMLENBQUM7SUFFRCxXQUFXO0lBQ1gsY0FBYztRQUNWLE1BQU0sV0FBVyxHQUFH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QUN4RCxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsS0FBSyxLQUFLLENBQ3RDLENBQUM7UUFFRixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUN6QixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0lBQ3RELENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxLQUFhO1FBQzNCLE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxJQUFJLENBQ2hFLENBQUMsWUFBWSxFQUFFLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBRSxLQUFLLEtBQUssQ0FDOUMsQ0FBQztRQUNGLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO0lBQ3JDLENBQUM7OztZQS9HSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGlCQUFpQjtnQkFDM0IsMGhGQUEyQzs7YUFFOUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJhc2VGaWx0ZXJDb21wb25lbnQgfSBmcm9tICcuLi9jb21tb24vbW9kZWwvYmFzZS1maWx0ZXItY29tcG9uZW50JztcbmltcG9ydCB7XG4gICAgSVBlcFNtYXJ0RmlsdGVyT3BlcmF0b3IsXG4gICAgSVBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JVbml0LFxuICAgIFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JzLFxuICAgIFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JVbml0cyxcbn0gZnJvbSAnLi4vY29tbW9uL21vZGVsL29wZXJhdG9yJztcbmltcG9ydCB7IElQZXBTbWFydEZpbHRlckRhdGFWYWx1ZSB9IGZyb20gJy4uL2NvbW1vbi9tb2RlbC9maWx0ZXInO1xuaW1wb3J0IHsgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IElQZXBPcHRpb24gfSBmcm9tICdAcGVwcGVyaS1hZGRvbnMvbmd4LWxpYic7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAncGVwLWRhdGUtZmlsdGVyJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vZGF0ZS1maWx0ZXIuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2RhdGUtZmlsdGVyLmNvbXBvbmVudC5zY3NzJ10sXG59KVxuZXhwb3J0IGNsYXNzIFBlcERhdGVGaWx0ZXJDb21wb25lbnQgZXh0ZW5kcyBCYXNlRmlsdGVyQ29tcG9uZW50IHtcbiAgICBQZXBTbWFydEZpbHRlck9wZXJhdG9ycyA9IFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JzO1xuICAgIGNob29zZVRpbWVPcHRpb25zOiBBcnJheTxJUGVwT3B0aW9uPiA9IFtdO1xuICAgIGNob29zZVRpbWVVbml0T3B0aW9uczogQXJyYXk8SVBlcE9wdGlvbj4gPSBbXTtcblxuICAgIC8vIE92ZXJyaWRlXG4gICAgZ2V0RGVmYXVsdE9wZXJhdG9yKCk6IElQZXBTbWFydEZpbHRlck9wZXJhdG9yIHtcbiAgICAgICAgcmV0dXJuIFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JzLkluVGhlTGFzdDtcbiAgICB9XG5cbiAgICAvLyBPdmVycmlkZVxuICAgIGdldERlZmF1bHRPcGVyYXRvclVuaXQoKTogSVBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JVbml0IHtcbiAgICAgICAgaWYgKHRoaXMub3BlcmF0b3IgPT09IFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JzLkluVGhlTGFzdCB8fFxuICAgICAgICAgICAgdGhpcy5vcGVyYXRvciA9PT0gUGVwU21hcnRGaWx0ZXJPcGVyYXRvcnMuTm90SW5UaGVMYXN0IHx8XG4gICAgICAgICAgICB0aGlzLm9wZXJhdG9yID09PSBQZXBTbWFydEZpbHRlck9wZXJhdG9ycy5EdWVJbiB8fFxuICAgICAgICAgICAgdGhpcy5vcGVyYXRvciA9PT0gUGVwU21hcnRGaWx0ZXJPcGVyYXRvcnMuTm90RHVlSW4pIHtcbiAgICAgICAgICAgIHJldHVybiBQZXBTbWFydEZpbHRlck9wZXJhdG9yVW5pdHMuTW9udGhzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIE92ZXJyaWRlXG4gICAgZ2V0RmlsdGVyVmFsdWUoKTogSVBlcFNtYXJ0RmlsdGVyRGF0YVZhbHVlIHtcbiAgICAgICAgY29uc3QgZmlsdGVyVmFsdWUgPSB7XG4gICAgICAgICAgICBmaXJzdDogdGhpcy5maXJzdENvbnRyb2wudmFsdWUsXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHRoaXMub3BlcmF0b3IgPT09IFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JzLkRhdGVSYW5nZSkge1xuICAgICAgICAgICAgZmlsdGVyVmFsdWVbJ3NlY29uZCddID0gdGhpcy5zZWNvbmRDb250cm9sLnZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZpbHRlclZhbHVlO1xuICAgIH1cblxuICAgIC8vIE92ZXJyaWRlXG4gICAgbG9hZE9wZXJhdG9yc09wdGlvbnMoKSB7XG4gICAgICAgIHRoaXMuY2hvb3NlVGltZU9wdGlvbnMgPSB0aGlzLm9wZXJhdG9ycy5tYXAoKG9wZXJhdG9yKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGtleTogb3BlcmF0b3IuaWQsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoXG4gICAgICAgICAgICAgICAgICAgIGAke3RoaXMuT1BFUkFUT1JTX1RSQU5TTEFUSU9OX1BSRUZJWH0uJHtvcGVyYXRvci5uYW1lfWBcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5jaG9vc2VUaW1lVW5pdE9wdGlvbnMgPSB0aGlzLm9wZXJhdG9yVW5pdHMubWFwKChvcGVyYXRvclVuaXQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAga2V5OiBvcGVyYXRvclVuaXQuaWQsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoXG4gICAgICAgICAgICAgICAgICAgIGAke3RoaXMuT1BFUkFUT1JfVU5JVFNfVFJBTlNMQVRJT05fUFJFRklYfS4ke29wZXJhdG9yVW5pdC5uYW1lfWBcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gT3ZlcnJpZGVcbiAgICBzZXRGaWVsZHNTdGF0ZUFuZFZhbGlkYXRvcnMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZmlyc3RDb250cm9sLmVuYWJsZSgpO1xuXG4gICAgICAgIGlmICh0aGlzLm9wZXJhdG9yID09PSBQZXBTbWFydEZpbHRlck9wZXJhdG9ycy5EYXRlUmFuZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RDb250cm9sLnNldFZhbGlkYXRvcnMoVmFsaWRhdG9ycy5yZXF1aXJlZCk7XG4gICAgICAgICAgICB0aGlzLnNlY29uZENvbnRyb2wuZW5hYmxlKCk7XG4gICAgICAgICAgICB0aGlzLnNlY29uZENvbnRyb2wuc2V0VmFsaWRhdG9ycyhWYWxpZGF0b3JzLnJlcXVpcmVkKTtcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgIHRoaXMub3BlcmF0b3IgPT09IFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JzLkluVGhlTGFzdCB8fFxuICAgICAgICAgICAgdGhpcy5vcGVyYXRvciA9PT0gUGVwU21hcnRGaWx0ZXJPcGVyYXRvcnMuTm90SW5UaGVMYXN0IHx8XG4gICAgICAgICAgICB0aGlzLm9wZXJhdG9yID09PSBQZXBTbWFydEZpbHRlck9wZXJhdG9ycy5EdWVJbiB8fFxuICAgICAgICAgICAgdGhpcy5vcGVyYXRvciA9PT0gUGVwU21hcnRGaWx0ZXJPcGVyYXRvcnMuTm90RHVlSW5cbiAgICAgICAgKSB7XG4gICAgICAgICAgICB0aGlzLmZpcnN0Q29udHJvbC5zZXRWYWxpZGF0b3JzKFtcbiAgICAgICAgICAgICAgICBWYWxpZGF0b3JzLnJlcXVpcmVkLFxuICAgICAgICAgICAgICAgIHRoaXMudmFsaWRhdG9yLm51bWJlclZhbGlkYXRvcigpLFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB0aGlzLnNlY29uZENvbnRyb2wuZGlzYWJsZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gRGlzYWJsZSAnZmlyc3QnIGZpZWxkLlxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIHRoaXMub3BlcmF0b3IgPT09IFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JzLlRvZGF5IHx8XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVyYXRvciA9PT0gUGVwU21hcnRGaWx0ZXJPcGVyYXRvcnMuVGhpc1dlZWsgfHxcbiAgICAgICAgICAgICAgICB0aGlzLm9wZXJhdG9yID09PSBQZXBTbWFydEZpbHRlck9wZXJhdG9ycy5UaGlzTW9udGggfHxcbiAgICAgICAgICAgICAgICB0aGlzLm9wZXJhdG9yID09PSBQZXBTbWFydEZpbHRlck9wZXJhdG9ycy5Jc0VtcHR5IHx8XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVyYXRvciA9PT0gUGVwU21hcnRGaWx0ZXJPcGVyYXRvcnMuSXNOb3RFbXB0eVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJzdENvbnRyb2wuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEZWZhdWx0IGRpc2FibGUgJ3NlY29uZCcgZmllbGQuXG4gICAgICAgICAgICBzdXBlci5zZXRGaWVsZHNTdGF0ZUFuZFZhbGlkYXRvcnMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uT3BlcmF0b3JDaGFuZ2VkKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgb3BlcmF0b3IgPSBPYmplY3QudmFsdWVzKFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JzKS5maW5kKFxuICAgICAgICAgICAgKG9wZXJhdG9yKSA9PiBvcGVyYXRvci5pZCA9PT0gdmFsdWVcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLm9wZXJhdG9yID0gb3BlcmF0b3I7XG4gICAgICAgIHRoaXMub3BlcmF0b3JVbml0ID0gdGhpcy5nZXREZWZhdWx0T3BlcmF0b3JVbml0KCk7XG4gICAgfVxuXG4gICAgb25UaW1lVW5pdENoYW5nZWQodmFsdWU6IHN0cmluZykge1xuICAgICAgICBjb25zdCBvcGVyYXRvclVuaXQgPSBPYmplY3QudmFsdWVzKFBlcFNtYXJ0RmlsdGVyT3BlcmF0b3JVbml0cykuZmluZChcbiAgICAgICAgICAgIChvcGVyYXRvclVuaXQpID0+IG9wZXJhdG9yVW5pdC5pZCA9PT0gdmFsdWVcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5vcGVyYXRvclVuaXQgPSBvcGVyYXRvclVuaXQ7XG4gICAgfVxufVxuIl19
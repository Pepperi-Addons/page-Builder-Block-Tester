{"version":3,"file":"pepperi-addons-ngx-lib-attachment.umd.js","sources":["../../../projects/ngx-lib/attachment/attachment.component.ts","../../../projects/ngx-lib/attachment/attachment.module.ts","../../../projects/ngx-lib/attachment/public-api.ts","../../../projects/ngx-lib/attachment/pepperi-addons-ngx-lib-attachment.ts"],"sourcesContent":["import {\n    Component,\n    OnInit,\n    OnChanges,\n    Input,\n    Output,\n    EventEmitter,\n    ChangeDetectionStrategy,\n    ElementRef,\n    Renderer2,\n    OnDestroy,\n} from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport {\n    PepFileService,\n    PepCustomizationService,\n    PepLayoutType,\n    PepHorizontalAlignment,\n    DEFAULT_HORIZONTAL_ALIGNMENT,\n    IPepFieldClickEvent,\n    PepAttachmentField,\n} from '@pepperi-addons/ngx-lib';\n\n@Component({\n    selector: 'pep-attachment',\n    templateUrl: './attachment.component.html',\n    styleUrls: ['./attachment.component.scss'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class PepAttachmentComponent implements OnInit, OnChanges, OnDestroy {\n    /**\n     * The attachment key.\n     *\n     * @memberof PepAttachmentComponent\n     */\n    @Input() key = '';\n\n    private _src = '';\n    /**\n     * The src of the attachment.\n     *\n     * @memberof PepAttachmentComponent\n     */\n    @Input()\n    set src(value: string) {\n        if (!value) {\n            value = '';\n        }\n\n        this._src = value;\n        if (this._src.length > 0) {\n            // Empty dataURI.\n            this.dataURI = null;\n        }\n    }\n    get src(): string {\n        return this._src;\n    }\n\n    /**\n     * The title of the attachment.\n     *\n     * @memberof PepAttachmentComponent\n     */\n    @Input() label = '';\n\n    /**\n     * If the attachment is mandatory\n     *\n     * @memberof PepAttachmentComponent\n     */\n    @Input() mandatory = false;\n\n    /**\n     * If the attachment is disabled\n     *\n     * @memberof PepAttachmentComponent\n     */\n    @Input() disabled = false;\n\n    /**\n     * If the attachment is readonly\n     *\n     * @memberof PepAttachmentComponent\n     */\n    @Input() readonly = false;\n\n    /**\n     * The horizontal alignment of the attachment\n     *\n     * @type {PepHorizontalAlignment}\n     * @memberof PepAttachmentComponent\n     */\n    @Input() xAlignment: PepHorizontalAlignment = DEFAULT_HORIZONTAL_ALIGNMENT;\n\n    private _rowSpan = 1;\n    @Input()\n    set rowSpan(value) {\n        this._rowSpan = value;\n        this.setFieldHeight();\n    }\n    get rowSpan(): number {\n        return this._rowSpan;\n    }\n\n    private _visible = true;\n    @Input()\n    set visible(visible: boolean) {\n        this._visible = visible;\n        if (visible) {\n            this.renderer.removeClass(\n                this.element.nativeElement,\n                'hidden-element'\n            );\n        } else {\n            this.renderer.addClass(\n                this.element.nativeElement,\n                'hidden-element'\n            );\n        }\n    }\n    get visible(): boolean {\n        return this._visible;\n    }\n\n    controlType = 'attachment';\n\n    @Input() form: FormGroup = null;\n    @Input() showTitle = true;\n\n    private _layoutType: PepLayoutType = 'form';\n    @Input()\n    set layoutType(value: PepLayoutType) {\n        this._layoutType = value;\n        this.setFieldHeight();\n    }\n    get layoutType(): PepLayoutType {\n        return this._layoutType;\n    }\n\n    @Input() isActive = false;\n\n    @Output()\n    fileChange: EventEmitter<any> = new EventEmitter<any>();\n\n    @Output()\n    elementClick: EventEmitter<IPepFieldClickEvent> = new EventEmitter<IPepFieldClickEvent>();\n\n    fieldHeight = '';\n    standAlone = false;\n    dataURI = null;\n\n    acceptAttachmentType =\n        'application/pdf,application/json,text/csv,text/csv-schema,application/msword,application/vnd.ms-excel,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,image/bmp,image/jpg, image/jpeg, image/png, image/tif, image/tiff, txt, json';\n\n    constructor(\n        private customizationService: PepCustomizationService,\n        private renderer: Renderer2,\n        public element: ElementRef,\n        private fileService: PepFileService\n    ) { }\n\n    private setFieldHeight(): void {\n        this.fieldHeight = this.customizationService.calculateFieldHeight(\n            this.layoutType,\n            this.rowSpan,\n            this.standAlone\n        );\n    }\n\n    private setDefaultForm(): void {\n        const pepField = new PepAttachmentField({\n            key: this.key,\n            value: this.src,\n            mandatory: this.mandatory,\n            readonly: this.readonly,\n            disabled: this.disabled,\n        });\n        this.form = this.customizationService.getDefaultFromGroup(pepField);\n    }\n\n    ngOnDestroy(): void {\n        //\n    }\n\n    ngOnInit(): void {\n        if (this.form === null) {\n            this.standAlone = true;\n            this.setFieldHeight();\n            this.setDefaultForm();\n\n            this.renderer.addClass(\n                this.element.nativeElement,\n                PepCustomizationService.STAND_ALONE_FIELD_CLASS_NAME\n            );\n        }\n    }\n\n    ngOnChanges(changes: any): void {\n        if (this.standAlone) {\n            this.setDefaultForm();\n        }\n        // Moved to src input\n        // if (changes.src && changes.src.currentValue.length > 0) {\n        //     // Empty dataURI if there is change in the src.\n        //     this.dataURI = null;\n        // }\n    }\n\n    onFileChanged(fileData: any): void {\n        // const tmp = value.length > 0 ? JSON.parse(value) : null;\n        // set this.dataURI after this.src cause it initialize in the src setter.\n        this.src = fileData ? fileData.fileStr : '';\n        this.dataURI = fileData;\n\n        this.customizationService.updateFormFieldValue(\n            this.form,\n            this.key,\n            this.dataURI ? this.dataURI.fileExt : ''\n        );\n        // this.valueChange.emit({\n        //     key: this.key,\n        //     value,\n        // });\n\n        this.fileChange.emit(fileData);\n        // this.fileChange.emit(value.length > 0 ? JSON.parse(value) : value);\n    }\n\n    onFileClicked(event: IPepFieldClickEvent): void {\n        if (this.dataURI != null) {\n            const fileStrArr = this.dataURI.fileStr.split(';');\n            if (fileStrArr.length === 2) {\n                const win = window.open('', '_blank');\n                const contentType = fileStrArr[0].split(':')[1];\n                const base64 = fileStrArr[1].split(',')[1];\n                const blob = this.fileService.convertFromb64toBlob(\n                    base64,\n                    contentType\n                );\n                const url = URL.createObjectURL(blob);\n                win.location.href = url;\n            }\n        } else {\n            if (this.fileService.isValidUrl(this.src)) {\n                const win = window.open('', '_blank');\n                win.location.href = this.src;\n            }\n        }\n\n        this.elementClick.emit(event);\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule } from '@angular/forms';\n\nimport { MatCommonModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\n\nimport { PepNgxLibModule } from '@pepperi-addons/ngx-lib';\nimport { PepFieldTitleModule } from '@pepperi-addons/ngx-lib/field-title';\nimport { PepFilesUploaderModule } from '@pepperi-addons/ngx-lib/files-uploader';\n\nimport { PepAttachmentComponent } from './attachment.component';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        ReactiveFormsModule,\n        // Material modules\n        MatCommonModule,\n        MatFormFieldModule,\n        // ngx-lib modules\n        PepNgxLibModule,\n        PepFieldTitleModule,\n        PepFilesUploaderModule,\n    ],\n    exports: [PepAttachmentComponent],\n    declarations: [PepAttachmentComponent],\n})\nexport class PepAttachmentModule {}\n","/*\n * Public API Surface of ngx-lib/attachment\n */\nexport * from './attachment.module';\nexport * from './attachment.component';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["DEFAULT_HORIZONTAL_ALIGNMENT","EventEmitter","PepAttachmentField","PepCustomizationService","Component","ChangeDetectionStrategy","Renderer2","ElementRef","PepFileService","Input","Output","NgModule","CommonModule","ReactiveFormsModule","MatCommonModule","MatFormFieldModule","PepNgxLibModule","PepFieldTitleModule","PepFilesUploaderModule"],"mappings":"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"}